
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>redis-22-configuration | 一线攻城狮</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Lee Hong">
    

    
    <meta name="description" content="为深入学习了解redis, 本文将对redis5.0.0源码包目录下的redis.conf配置文件进行完整翻译学习, 翻译顺序与配置文件保持一致;">
<meta property="og:type" content="article">
<meta property="og:title" content="redis-22-configuration">
<meta property="og:url" content="http://researchlab.github.io/2018/10/26/redis-22-configuration/index.html">
<meta property="og:site_name" content="一线攻城狮">
<meta property="og:description" content="为深入学习了解redis, 本文将对redis5.0.0源码包目录下的redis.conf配置文件进行完整翻译学习, 翻译顺序与配置文件保持一致;">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-10-31T07:32:10.831Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis-22-configuration">
<meta name="twitter:description" content="为深入学习了解redis, 本文将对redis5.0.0源码包目录下的redis.conf配置文件进行完整翻译学习, 翻译顺序与配置文件保持一致;">

    
    <link rel="alternative" href="/atom.xml" title="一线攻城狮" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="一线攻城狮">一线攻城狮</a></h1>
				<h2 class="blog-motto">十年磨一剑，一步一步脚踏实地的耕种</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/reading">书单</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:researchlab.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/10/26/redis-22-configuration/" title="redis-22-configuration" itemprop="url">redis-22-configuration</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Lee Hong" target="_blank" itemprop="author">Lee Hong</a>
		
 <p class="article-time">
    <time datetime="2018-10-26T06:06:46.000Z" itemprop="datePublished"> 发表于 2018-10-26</time>
   &nbsp&nbsp热度&nbsp<span id="busuanzi_value_page_pv"></span>° 
  </p>
</header>

	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#INCLUDES"><span class="toc-number">1.</span> <span class="toc-text">INCLUDES</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MODULES"><span class="toc-number">2.</span> <span class="toc-text">MODULES</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NETWORK"><span class="toc-number">3.</span> <span class="toc-text">NETWORK</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#GENERAL"><span class="toc-number">4.</span> <span class="toc-text">GENERAL</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#To-enable-logging-to-the-system-logger-just-set-‘syslog-enabled’-to-yes"><span class="toc-number"></span> <span class="toc-text">To enable logging to the system logger, just set ‘syslog-enabled’ to yes,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-optionally-update-the-other-syslog-parameters-to-suit-your-needs"><span class="toc-number"></span> <span class="toc-text">and optionally update the other syslog parameters to suit your needs.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#syslog-enabled-no"><span class="toc-number"></span> <span class="toc-text">syslog-enabled no</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Specify-the-syslog-identity"><span class="toc-number"></span> <span class="toc-text">Specify the syslog identity.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#syslog-ident-redis"><span class="toc-number"></span> <span class="toc-text">syslog-ident redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Specify-the-syslog-facility-Must-be-USER-or-between-LOCAL0-LOCAL7"><span class="toc-number"></span> <span class="toc-text">Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#syslog-facility-local0"><span class="toc-number"></span> <span class="toc-text">syslog-facility local0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-the-number-of-databases-The-default-database-is-DB-0-you-can-select"><span class="toc-number"></span> <span class="toc-text">Set the number of databases. The default database is DB 0, you can select</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-different-one-on-a-per-connection-basis-using-SELECT-where"><span class="toc-number"></span> <span class="toc-text">a different one on a per-connection basis using SELECT  where</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dbid-is-a-number-between-0-and-‘databases’-1"><span class="toc-number"></span> <span class="toc-text">dbid is a number between 0 and ‘databases’-1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-Redis-shows-an-ASCII-art-logo-only-when-started-to-log-to-the"><span class="toc-number"></span> <span class="toc-text">By default Redis shows an ASCII art logo only when started to log to the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#standard-output-and-if-the-standard-output-is-a-TTY-Basically-this-means"><span class="toc-number"></span> <span class="toc-text">standard output and if the standard output is a TTY. Basically this means</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-normally-a-logo-is-displayed-only-in-interactive-sessions"><span class="toc-number"></span> <span class="toc-text">that normally a logo is displayed only in interactive sessions.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-it-is-possible-to-force-the-pre-4-0-behavior-and-always-show-a"><span class="toc-number"></span> <span class="toc-text">However it is possible to force the pre-4.0 behavior and always show a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ASCII-art-logo-in-startup-logs-by-setting-the-following-option-to-yes"><span class="toc-number"></span> <span class="toc-text">ASCII art logo in startup logs by setting the following option to yes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Save-the-DB-on-disk"><span class="toc-number"></span> <span class="toc-text">Save the DB on disk:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#save"><span class="toc-number"></span> <span class="toc-text">save  </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Will-save-the-DB-if-both-the-given-number-of-seconds-and-the-given"><span class="toc-number"></span> <span class="toc-text">Will save the DB if both the given number of seconds and the given</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#number-of-write-operations-against-the-DB-occurred"><span class="toc-number"></span> <span class="toc-text">number of write operations against the DB occurred.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-the-example-below-the-behaviour-will-be-to-save"><span class="toc-number"></span> <span class="toc-text">In the example below the behaviour will be to save:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#after-900-sec-15-min-if-at-least-1-key-changed"><span class="toc-number"></span> <span class="toc-text">after 900 sec (15 min) if at least 1 key changed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#after-300-sec-5-min-if-at-least-10-keys-changed"><span class="toc-number"></span> <span class="toc-text">after 300 sec (5 min) if at least 10 keys changed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#after-60-sec-if-at-least-10000-keys-changed"><span class="toc-number"></span> <span class="toc-text">after 60 sec if at least 10000 keys changed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-you-can-disable-saving-completely-by-commenting-out-all-“save”-lines"><span class="toc-number"></span> <span class="toc-text">Note: you can disable saving completely by commenting out all “save” lines.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-also-possible-to-remove-all-the-previously-configured-save"><span class="toc-number"></span> <span class="toc-text">It is also possible to remove all the previously configured save</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#points-by-adding-a-save-directive-with-a-single-empty-string-argument"><span class="toc-number"></span> <span class="toc-text">points by adding a save directive with a single empty string argument</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#like-in-the-following-example"><span class="toc-number"></span> <span class="toc-text">like in the following example:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#save-“”"><span class="toc-number"></span> <span class="toc-text">save “”</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-Redis-will-stop-accepting-writes-if-RDB-snapshots-are-enabled"><span class="toc-number"></span> <span class="toc-text">By default Redis will stop accepting writes if RDB snapshots are enabled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#at-least-one-save-point-and-the-latest-background-save-failed"><span class="toc-number"></span> <span class="toc-text">(at least one save point) and the latest background save failed.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-will-make-the-user-aware-in-a-hard-way-that-data-is-not-persisting"><span class="toc-number"></span> <span class="toc-text">This will make the user aware (in a hard way) that data is not persisting</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#on-disk-properly-otherwise-chances-are-that-no-one-will-notice-and-some"><span class="toc-number"></span> <span class="toc-text">on disk properly, otherwise chances are that no one will notice and some</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#disaster-will-happen"><span class="toc-number"></span> <span class="toc-text">disaster will happen.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-background-saving-process-will-start-working-again-Redis-will"><span class="toc-number"></span> <span class="toc-text">If the background saving process will start working again Redis will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#automatically-allow-writes-again"><span class="toc-number"></span> <span class="toc-text">automatically allow writes again.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-if-you-have-setup-your-proper-monitoring-of-the-Redis-server"><span class="toc-number"></span> <span class="toc-text">However if you have setup your proper monitoring of the Redis server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-persistence-you-may-want-to-disable-this-feature-so-that-Redis-will"><span class="toc-number"></span> <span class="toc-text">and persistence, you may want to disable this feature so that Redis will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#continue-to-work-as-usual-even-if-there-are-problems-with-disk"><span class="toc-number"></span> <span class="toc-text">continue to work as usual even if there are problems with disk,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#permissions-and-so-forth"><span class="toc-number"></span> <span class="toc-text">permissions, and so forth.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compress-string-objects-using-LZF-when-dump-rdb-databases"><span class="toc-number"></span> <span class="toc-text">Compress string objects using LZF when dump .rdb databases?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-default-that’s-set-to-‘yes’-as-it’s-almost-always-a-win"><span class="toc-number"></span> <span class="toc-text">For default that’s set to ‘yes’ as it’s almost always a win.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-you-want-to-save-some-CPU-in-the-saving-child-set-it-to-‘no’-but"><span class="toc-number"></span> <span class="toc-text">If you want to save some CPU in the saving child set it to ‘no’ but</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-dataset-will-likely-be-bigger-if-you-have-compressible-values-or-keys"><span class="toc-number"></span> <span class="toc-text">the dataset will likely be bigger if you have compressible values or keys.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Since-version-5-of-RDB-a-CRC64-checksum-is-placed-at-the-end-of-the-file"><span class="toc-number"></span> <span class="toc-text">Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-makes-the-format-more-resistant-to-corruption-but-there-is-a-performance"><span class="toc-number"></span> <span class="toc-text">This makes the format more resistant to corruption but there is a performance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hit-to-pay-around-10-when-saving-and-loading-RDB-files-so-you-can-disable-it"><span class="toc-number"></span> <span class="toc-text">hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-maximum-performances"><span class="toc-number"></span> <span class="toc-text">for maximum performances.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RDB-files-created-with-checksum-disabled-have-a-checksum-of-zero-that-will"><span class="toc-number"></span> <span class="toc-text">RDB files created with checksum disabled have a checksum of zero that will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tell-the-loading-code-to-skip-the-check"><span class="toc-number"></span> <span class="toc-text">tell the loading code to skip the check.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-filename-where-to-dump-the-DB"><span class="toc-number"></span> <span class="toc-text">The filename where to dump the DB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-working-directory"><span class="toc-number"></span> <span class="toc-text">The working directory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-DB-will-be-written-inside-this-directory-with-the-filename-specified"><span class="toc-number"></span> <span class="toc-text">The DB will be written inside this directory, with the filename specified</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#above-using-the-‘dbfilename’-configuration-directive"><span class="toc-number"></span> <span class="toc-text">above using the ‘dbfilename’ configuration directive.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Append-Only-File-will-also-be-created-inside-this-directory"><span class="toc-number"></span> <span class="toc-text">The Append Only File will also be created inside this directory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-that-you-must-specify-a-directory-here-not-a-file-name"><span class="toc-number"></span> <span class="toc-text">Note that you must specify a directory here, not a file name.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Master-Replica-replication-Use-replicaof-to-make-a-Redis-instance-a-copy-of"><span class="toc-number"></span> <span class="toc-text">Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#another-Redis-server-A-few-things-to-understand-ASAP-about-Redis-replication"><span class="toc-number"></span> <span class="toc-text">another Redis server. A few things to understand ASAP about Redis replication.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——————-—————"><span class="toc-number"></span> <span class="toc-text">+——————+      +—————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Master-—-gt-Replica"><span class="toc-number"></span> <span class="toc-text">|      Master      | —&gt; |    Replica    |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#receive-writes-exact-copy"><span class="toc-number"></span> <span class="toc-text">| (receive writes) |      |  (exact copy) |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——————-—————-1"><span class="toc-number"></span> <span class="toc-text">+——————+      +—————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Redis-replication-is-asynchronous-but-you-can-configure-a-master-to"><span class="toc-number"></span> <span class="toc-text">1) Redis replication is asynchronous, but you can configure a master to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#stop-accepting-writes-if-it-appears-to-be-not-connected-with-at-least"><span class="toc-number"></span> <span class="toc-text">stop accepting writes if it appears to be not connected with at least</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-given-number-of-replicas"><span class="toc-number"></span> <span class="toc-text">a given number of replicas.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Redis-replicas-are-able-to-perform-a-partial-resynchronization-with-the"><span class="toc-number"></span> <span class="toc-text">2) Redis replicas are able to perform a partial resynchronization with the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master-if-the-replication-link-is-lost-for-a-relatively-small-amount-of"><span class="toc-number"></span> <span class="toc-text">master if the replication link is lost for a relatively small amount of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#time-You-may-want-to-configure-the-replication-backlog-size-see-the-next"><span class="toc-number"></span> <span class="toc-text">time. You may want to configure the replication backlog size (see the next</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sections-of-this-file-with-a-sensible-value-depending-on-your-needs"><span class="toc-number"></span> <span class="toc-text">sections of this file) with a sensible value depending on your needs.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Replication-is-automatic-and-does-not-need-user-intervention-After-a"><span class="toc-number"></span> <span class="toc-text">3) Replication is automatic and does not need user intervention. After a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#network-partition-replicas-automatically-try-to-reconnect-to-masters"><span class="toc-number"></span> <span class="toc-text">network partition replicas automatically try to reconnect to masters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-resynchronize-with-them"><span class="toc-number"></span> <span class="toc-text">and resynchronize with them.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replicaof"><span class="toc-number"></span> <span class="toc-text">replicaof  </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-master-is-password-protected-using-the-“requirepass”-configuration"><span class="toc-number"></span> <span class="toc-text">If the master is password protected (using the “requirepass” configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#directive-below-it-is-possible-to-tell-the-replica-to-authenticate-before"><span class="toc-number"></span> <span class="toc-text">directive below) it is possible to tell the replica to authenticate before</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#starting-the-replication-synchronization-process-otherwise-the-master-will"><span class="toc-number"></span> <span class="toc-text">starting the replication synchronization process, otherwise the master will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#refuse-the-replica-request"><span class="toc-number"></span> <span class="toc-text">refuse the replica request.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#masterauth"><span class="toc-number"></span> <span class="toc-text">masterauth </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-a-replica-loses-its-connection-with-the-master-or-when-the-replication"><span class="toc-number"></span> <span class="toc-text">When a replica loses its connection with the master, or when the replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-still-in-progress-the-replica-can-act-in-two-different-ways"><span class="toc-number"></span> <span class="toc-text">is still in progress, the replica can act in two different ways:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-if-replica-serve-stale-data-is-set-to-‘yes’-the-default-the-replica-will"><span class="toc-number"></span> <span class="toc-text">1) if replica-serve-stale-data is set to ‘yes’ (the default) the replica will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#still-reply-to-client-requests-possibly-with-out-of-date-data-or-the"><span class="toc-number"></span> <span class="toc-text">still reply to client requests, possibly with out of date data, or the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#data-set-may-just-be-empty-if-this-is-the-first-synchronization"><span class="toc-number"></span> <span class="toc-text">data set may just be empty if this is the first synchronization.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-if-replica-serve-stale-data-is-set-to-‘no’-the-replica-will-reply-with"><span class="toc-number"></span> <span class="toc-text">2) if replica-serve-stale-data is set to ‘no’ the replica will reply with</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#an-error-“SYNC-with-master-in-progress”-to-all-the-kind-of-commands"><span class="toc-number"></span> <span class="toc-text">an error “SYNC with master in progress” to all the kind of commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#but-to-INFO-replicaOF-AUTH-PING-SHUTDOWN-REPLCONF-ROLE-CONFIG"><span class="toc-number"></span> <span class="toc-text">but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SUBSCRIBE-UNSUBSCRIBE-PSUBSCRIBE-PUNSUBSCRIBE-PUBLISH-PUBSUB"><span class="toc-number"></span> <span class="toc-text">SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#COMMAND-POST-HOST-and-LATENCY"><span class="toc-number"></span> <span class="toc-text">COMMAND, POST, HOST: and LATENCY.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#You-can-configure-a-replica-instance-to-accept-writes-or-not-Writing-against"><span class="toc-number"></span> <span class="toc-text">You can configure a replica instance to accept writes or not. Writing against</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-replica-instance-may-be-useful-to-store-some-ephemeral-data-because-data"><span class="toc-number"></span> <span class="toc-text">a replica instance may be useful to store some ephemeral data (because data</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#written-on-a-replica-will-be-easily-deleted-after-resync-with-the-master-but"><span class="toc-number"></span> <span class="toc-text">written on a replica will be easily deleted after resync with the master) but</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#may-also-cause-problems-if-clients-are-writing-to-it-because-of-a"><span class="toc-number"></span> <span class="toc-text">may also cause problems if clients are writing to it because of a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#misconfiguration"><span class="toc-number"></span> <span class="toc-text">misconfiguration.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Since-Redis-2-6-by-default-replicas-are-read-only"><span class="toc-number"></span> <span class="toc-text">Since Redis 2.6 by default replicas are read-only.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-read-only-replicas-are-not-designed-to-be-exposed-to-untrusted-clients"><span class="toc-number"></span> <span class="toc-text">Note: read only replicas are not designed to be exposed to untrusted clients</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#on-the-internet-It’s-just-a-protection-layer-against-misuse-of-the-instance"><span class="toc-number"></span> <span class="toc-text">on the internet. It’s just a protection layer against misuse of the instance.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Still-a-read-only-replica-exports-by-default-all-the-administrative-commands"><span class="toc-number"></span> <span class="toc-text">Still a read only replica exports by default all the administrative commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#such-as-CONFIG-DEBUG-and-so-forth-To-a-limited-extent-you-can-improve"><span class="toc-number"></span> <span class="toc-text">such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#security-of-read-only-replicas-using-‘rename-command’-to-shadow-all-the"><span class="toc-number"></span> <span class="toc-text">security of read only replicas using ‘rename-command’ to shadow all the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#administrative-dangerous-commands"><span class="toc-number"></span> <span class="toc-text">administrative / dangerous commands.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Replication-SYNC-strategy-disk-or-socket"><span class="toc-number"></span> <span class="toc-text">Replication SYNC strategy: disk or socket.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——————————————————"><span class="toc-number"></span> <span class="toc-text">——————————————————-</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WARNING-DISKLESS-REPLICATION-IS-EXPERIMENTAL-CURRENTLY"><span class="toc-number"></span> <span class="toc-text">WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——————————————————-1"><span class="toc-number"></span> <span class="toc-text">——————————————————-</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#New-replicas-and-reconnecting-replicas-that-are-not-able-to-continue-the-replication"><span class="toc-number"></span> <span class="toc-text">New replicas and reconnecting replicas that are not able to continue the replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#process-just-receiving-differences-need-to-do-what-is-called-a-“full"><span class="toc-number"></span> <span class="toc-text">process just receiving differences, need to do what is called a “full</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#synchronization”-An-RDB-file-is-transmitted-from-the-master-to-the-replicas"><span class="toc-number"></span> <span class="toc-text">synchronization”. An RDB file is transmitted from the master to the replicas.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-transmission-can-happen-in-two-different-ways"><span class="toc-number"></span> <span class="toc-text">The transmission can happen in two different ways:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Disk-backed-The-Redis-master-creates-a-new-process-that-writes-the-RDB"><span class="toc-number"></span> <span class="toc-text">1) Disk-backed: The Redis master creates a new process that writes the RDB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#file-on-disk-Later-the-file-is-transferred-by-the-parent"><span class="toc-number"></span> <span class="toc-text">file on disk. Later the file is transferred by the parent</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#process-to-the-replicas-incrementally"><span class="toc-number"></span> <span class="toc-text">process to the replicas incrementally.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Diskless-The-Redis-master-creates-a-new-process-that-directly-writes-the"><span class="toc-number"></span> <span class="toc-text">2) Diskless: The Redis master creates a new process that directly writes the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RDB-file-to-replica-sockets-without-touching-the-disk-at-all"><span class="toc-number"></span> <span class="toc-text">RDB file to replica sockets, without touching the disk at all.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#With-disk-backed-replication-while-the-RDB-file-is-generated-more-replicas"><span class="toc-number"></span> <span class="toc-text">With disk-backed replication, while the RDB file is generated, more replicas</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#can-be-queued-and-served-with-the-RDB-file-as-soon-as-the-current-child-producing"><span class="toc-number"></span> <span class="toc-text">can be queued and served with the RDB file as soon as the current child producing</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-RDB-file-finishes-its-work-With-diskless-replication-instead-once"><span class="toc-number"></span> <span class="toc-text">the RDB file finishes its work. With diskless replication instead once</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-transfer-starts-new-replicas-arriving-will-be-queued-and-a-new-transfer"><span class="toc-number"></span> <span class="toc-text">the transfer starts, new replicas arriving will be queued and a new transfer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-start-when-the-current-one-terminates"><span class="toc-number"></span> <span class="toc-text">will start when the current one terminates.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-diskless-replication-is-used-the-master-waits-a-configurable-amount-of"><span class="toc-number"></span> <span class="toc-text">When diskless replication is used, the master waits a configurable amount of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#time-in-seconds-before-starting-the-transfer-in-the-hope-that-multiple-replicas"><span class="toc-number"></span> <span class="toc-text">time (in seconds) before starting the transfer in the hope that multiple replicas</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-arrive-and-the-transfer-can-be-parallelized"><span class="toc-number"></span> <span class="toc-text">will arrive and the transfer can be parallelized.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#With-slow-disks-and-fast-large-bandwidth-networks-diskless-replication"><span class="toc-number"></span> <span class="toc-text">With slow disks and fast (large bandwidth) networks, diskless replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#works-better"><span class="toc-number"></span> <span class="toc-text">works better.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-diskless-replication-is-enabled-it-is-possible-to-configure-the-delay"><span class="toc-number"></span> <span class="toc-text">When diskless replication is enabled, it is possible to configure the delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-server-waits-in-order-to-spawn-the-child-that-transfers-the-RDB-via-socket"><span class="toc-number"></span> <span class="toc-text">the server waits in order to spawn the child that transfers the RDB via socket</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-the-replicas"><span class="toc-number"></span> <span class="toc-text">to the replicas.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-is-important-since-once-the-transfer-starts-it-is-not-possible-to-serve"><span class="toc-number"></span> <span class="toc-text">This is important since once the transfer starts, it is not possible to serve</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#new-replicas-arriving-that-will-be-queued-for-the-next-RDB-transfer-so-the-server"><span class="toc-number"></span> <span class="toc-text">new replicas arriving, that will be queued for the next RDB transfer, so the server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#waits-a-delay-in-order-to-let-more-replicas-arrive"><span class="toc-number"></span> <span class="toc-text">waits a delay in order to let more replicas arrive.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-delay-is-specified-in-seconds-and-by-default-is-5-seconds-To-disable"><span class="toc-number"></span> <span class="toc-text">The delay is specified in seconds, and by default is 5 seconds. To disable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#it-entirely-just-set-it-to-0-seconds-and-the-transfer-will-start-ASAP"><span class="toc-number"></span> <span class="toc-text">it entirely just set it to 0 seconds and the transfer will start ASAP.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Replicas-send-PINGs-to-server-in-a-predefined-interval-It’s-possible-to-change"><span class="toc-number"></span> <span class="toc-text">Replicas send PINGs to server in a predefined interval. It’s possible to change</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-interval-with-the-repl-ping-replica-period-option-The-default-value-is-10"><span class="toc-number"></span> <span class="toc-text">this interval with the repl_ping_replica_period option. The default value is 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seconds"><span class="toc-number"></span> <span class="toc-text">seconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#repl-ping-replica-period-10"><span class="toc-number"></span> <span class="toc-text">repl-ping-replica-period 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-following-option-sets-the-replication-timeout-for"><span class="toc-number"></span> <span class="toc-text">The following option sets the replication timeout for:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Bulk-transfer-I-O-during-SYNC-from-the-point-of-view-of-replica"><span class="toc-number"></span> <span class="toc-text">1) Bulk transfer I/O during SYNC, from the point of view of replica.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Master-timeout-from-the-point-of-view-of-replicas-data-pings"><span class="toc-number"></span> <span class="toc-text">2) Master timeout from the point of view of replicas (data, pings).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Replica-timeout-from-the-point-of-view-of-masters-REPLCONF-ACK-pings"><span class="toc-number"></span> <span class="toc-text">3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-important-to-make-sure-that-this-value-is-greater-than-the-value"><span class="toc-number"></span> <span class="toc-text">It is important to make sure that this value is greater than the value</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#specified-for-repl-ping-replica-period-otherwise-a-timeout-will-be-detected"><span class="toc-number"></span> <span class="toc-text">specified for repl-ping-replica-period otherwise a timeout will be detected</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#every-time-there-is-low-traffic-between-the-master-and-the-replica"><span class="toc-number"></span> <span class="toc-text">every time there is low traffic between the master and the replica.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#repl-timeout-60"><span class="toc-number"></span> <span class="toc-text">repl-timeout 60</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Disable-TCP-NODELAY-on-the-replica-socket-after-SYNC"><span class="toc-number"></span> <span class="toc-text">Disable TCP_NODELAY on the replica socket after SYNC?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-you-select-“yes”-Redis-will-use-a-smaller-number-of-TCP-packets-and"><span class="toc-number"></span> <span class="toc-text">If you select “yes” Redis will use a smaller number of TCP packets and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#less-bandwidth-to-send-data-to-replicas-But-this-can-add-a-delay-for"><span class="toc-number"></span> <span class="toc-text">less bandwidth to send data to replicas. But this can add a delay for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-data-to-appear-on-the-replica-side-up-to-40-milliseconds-with"><span class="toc-number"></span> <span class="toc-text">the data to appear on the replica side, up to 40 milliseconds with</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-kernels-using-a-default-configuration"><span class="toc-number"></span> <span class="toc-text">Linux kernels using a default configuration.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-you-select-“no”-the-delay-for-data-to-appear-on-the-replica-side-will"><span class="toc-number"></span> <span class="toc-text">If you select “no” the delay for data to appear on the replica side will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#be-reduced-but-more-bandwidth-will-be-used-for-replication"><span class="toc-number"></span> <span class="toc-text">be reduced but more bandwidth will be used for replication.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-we-optimize-for-low-latency-but-in-very-high-traffic-conditions"><span class="toc-number"></span> <span class="toc-text">By default we optimize for low latency, but in very high traffic conditions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#or-when-the-master-and-replicas-are-many-hops-away-turning-this-to-“yes”-may"><span class="toc-number"></span> <span class="toc-text">or when the master and replicas are many hops away, turning this to “yes” may</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#be-a-good-idea"><span class="toc-number"></span> <span class="toc-text">be a good idea.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-the-replication-backlog-size-The-backlog-is-a-buffer-that-accumulates"><span class="toc-number"></span> <span class="toc-text">Set the replication backlog size. The backlog is a buffer that accumulates</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-data-when-replicas-are-disconnected-for-some-time-so-that-when-a-replica"><span class="toc-number"></span> <span class="toc-text">replica data when replicas are disconnected for some time, so that when a replica</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wants-to-reconnect-again-often-a-full-resync-is-not-needed-but-a-partial"><span class="toc-number"></span> <span class="toc-text">wants to reconnect again, often a full resync is not needed, but a partial</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#resync-is-enough-just-passing-the-portion-of-data-the-replica-missed-while"><span class="toc-number"></span> <span class="toc-text">resync is enough, just passing the portion of data the replica missed while</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#disconnected"><span class="toc-number"></span> <span class="toc-text">disconnected.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-bigger-the-replication-backlog-the-longer-the-time-the-replica-can-be"><span class="toc-number"></span> <span class="toc-text">The bigger the replication backlog, the longer the time the replica can be</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#disconnected-and-later-be-able-to-perform-a-partial-resynchronization"><span class="toc-number"></span> <span class="toc-text">disconnected and later be able to perform a partial resynchronization.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-backlog-is-only-allocated-once-there-is-at-least-a-replica-connected"><span class="toc-number"></span> <span class="toc-text">The backlog is only allocated once there is at least a replica connected.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#repl-backlog-size-1mb"><span class="toc-number"></span> <span class="toc-text">repl-backlog-size 1mb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#After-a-master-has-no-longer-connected-replicas-for-some-time-the-backlog"><span class="toc-number"></span> <span class="toc-text">After a master has no longer connected replicas for some time, the backlog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-be-freed-The-following-option-configures-the-amount-of-seconds-that"><span class="toc-number"></span> <span class="toc-text">will be freed. The following option configures the amount of seconds that</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#need-to-elapse-starting-from-the-time-the-last-replica-disconnected-for"><span class="toc-number"></span> <span class="toc-text">need to elapse, starting from the time the last replica disconnected, for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-backlog-buffer-to-be-freed"><span class="toc-number"></span> <span class="toc-text">the backlog buffer to be freed.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-that-replicas-never-free-the-backlog-for-timeout-since-they-may-be"><span class="toc-number"></span> <span class="toc-text">Note that replicas never free the backlog for timeout, since they may be</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#promoted-to-masters-later-and-should-be-able-to-correctly-“partially"><span class="toc-number"></span> <span class="toc-text">promoted to masters later, and should be able to correctly “partially</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#resynchronize”-with-the-replicas-hence-they-should-always-accumulate-backlog"><span class="toc-number"></span> <span class="toc-text">resynchronize” with the replicas: hence they should always accumulate backlog.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-value-of-0-means-to-never-release-the-backlog"><span class="toc-number"></span> <span class="toc-text">A value of 0 means to never release the backlog.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#repl-backlog-ttl-3600"><span class="toc-number"></span> <span class="toc-text">repl-backlog-ttl 3600</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-replica-priority-is-an-integer-number-published-by-Redis-in-the-INFO-output"><span class="toc-number"></span> <span class="toc-text">The replica priority is an integer number published by Redis in the INFO output.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-used-by-Redis-Sentinel-in-order-to-select-a-replica-to-promote-into-a"><span class="toc-number"></span> <span class="toc-text">It is used by Redis Sentinel in order to select a replica to promote into a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master-if-the-master-is-no-longer-working-correctly"><span class="toc-number"></span> <span class="toc-text">master if the master is no longer working correctly.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-replica-with-a-low-priority-number-is-considered-better-for-promotion-so"><span class="toc-number"></span> <span class="toc-text">A replica with a low priority number is considered better for promotion, so</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-instance-if-there-are-three-replicas-with-priority-10-100-25-Sentinel-will"><span class="toc-number"></span> <span class="toc-text">for instance if there are three replicas with priority 10, 100, 25 Sentinel will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pick-the-one-with-priority-10-that-is-the-lowest"><span class="toc-number"></span> <span class="toc-text">pick the one with priority 10, that is the lowest.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-a-special-priority-of-0-marks-the-replica-as-not-able-to-perform-the"><span class="toc-number"></span> <span class="toc-text">However a special priority of 0 marks the replica as not able to perform the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#role-of-master-so-a-replica-with-priority-of-0-will-never-be-selected-by"><span class="toc-number"></span> <span class="toc-text">role of master, so a replica with priority of 0 will never be selected by</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-Sentinel-for-promotion"><span class="toc-number"></span> <span class="toc-text">Redis Sentinel for promotion.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-the-priority-is-100"><span class="toc-number"></span> <span class="toc-text">By default the priority is 100.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-possible-for-a-master-to-stop-accepting-writes-if-there-are-less-than"><span class="toc-number"></span> <span class="toc-text">It is possible for a master to stop accepting writes if there are less than</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#N-replicas-connected-having-a-lag-less-or-equal-than-M-seconds"><span class="toc-number"></span> <span class="toc-text">N replicas connected, having a lag less or equal than M seconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-N-replicas-need-to-be-in-“online”-state"><span class="toc-number"></span> <span class="toc-text">The N replicas need to be in “online” state.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-lag-in-seconds-that-must-be-lt-the-specified-value-is-calculated-from"><span class="toc-number"></span> <span class="toc-text">The lag in seconds, that must be &lt;= the specified value, is calculated from</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-last-ping-received-from-the-replica-that-is-usually-sent-every-second"><span class="toc-number"></span> <span class="toc-text">the last ping received from the replica, that is usually sent every second.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-option-does-not-GUARANTEE-that-N-replicas-will-accept-the-write-but"><span class="toc-number"></span> <span class="toc-text">This option does not GUARANTEE that N replicas will accept the write, but</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-limit-the-window-of-exposure-for-lost-writes-in-case-not-enough-replicas"><span class="toc-number"></span> <span class="toc-text">will limit the window of exposure for lost writes in case not enough replicas</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#are-available-to-the-specified-number-of-seconds"><span class="toc-number"></span> <span class="toc-text">are available, to the specified number of seconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-example-to-require-at-least-3-replicas-with-a-lag-lt-10-seconds-use"><span class="toc-number"></span> <span class="toc-text">For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#min-replicas-to-write-3"><span class="toc-number"></span> <span class="toc-text">min-replicas-to-write 3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#min-replicas-max-lag-10"><span class="toc-number"></span> <span class="toc-text">min-replicas-max-lag 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Setting-one-or-the-other-to-0-disables-the-feature"><span class="toc-number"></span> <span class="toc-text">Setting one or the other to 0 disables the feature.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-min-replicas-to-write-is-set-to-0-feature-disabled-and"><span class="toc-number"></span> <span class="toc-text">By default min-replicas-to-write is set to 0 (feature disabled) and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#min-replicas-max-lag-is-set-to-10"><span class="toc-number"></span> <span class="toc-text">min-replicas-max-lag is set to 10.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-Redis-master-is-able-to-list-the-address-and-port-of-the-attached"><span class="toc-number"></span> <span class="toc-text">A Redis master is able to list the address and port of the attached</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replicas-in-different-ways-For-example-the-“INFO-replication”-section"><span class="toc-number"></span> <span class="toc-text">replicas in different ways. For example the “INFO replication” section</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#offers-this-information-which-is-used-among-other-tools-by"><span class="toc-number"></span> <span class="toc-text">offers this information, which is used, among other tools, by</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-Sentinel-in-order-to-discover-replica-instances"><span class="toc-number"></span> <span class="toc-text">Redis Sentinel in order to discover replica instances.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Another-place-where-this-info-is-available-is-in-the-output-of-the"><span class="toc-number"></span> <span class="toc-text">Another place where this info is available is in the output of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#“ROLE”-command-of-a-master"><span class="toc-number"></span> <span class="toc-text">“ROLE” command of a master.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-listed-IP-and-address-normally-reported-by-a-replica-is-obtained"><span class="toc-number"></span> <span class="toc-text">The listed IP and address normally reported by a replica is obtained</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-the-following-way"><span class="toc-number"></span> <span class="toc-text">in the following way:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IP-The-address-is-auto-detected-by-checking-the-peer-address"><span class="toc-number"></span> <span class="toc-text">IP: The address is auto detected by checking the peer address</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-the-socket-used-by-the-replica-to-connect-with-the-master"><span class="toc-number"></span> <span class="toc-text">of the socket used by the replica to connect with the master.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Port-The-port-is-communicated-by-the-replica-during-the-replication"><span class="toc-number"></span> <span class="toc-text">Port: The port is communicated by the replica during the replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#handshake-and-is-normally-the-port-that-the-replica-is-using-to"><span class="toc-number"></span> <span class="toc-text">handshake, and is normally the port that the replica is using to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#listen-for-connections"><span class="toc-number"></span> <span class="toc-text">listen for connections.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-when-port-forwarding-or-Network-Address-Translation-NAT-is"><span class="toc-number"></span> <span class="toc-text">However when port forwarding or Network Address Translation (NAT) is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#used-the-replica-may-be-actually-reachable-via-different-IP-and-port"><span class="toc-number"></span> <span class="toc-text">used, the replica may be actually reachable via different IP and port</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pairs-The-following-two-options-can-be-used-by-a-replica-in-order-to"><span class="toc-number"></span> <span class="toc-text">pairs. The following two options can be used by a replica in order to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#report-to-its-master-a-specific-set-of-IP-and-port-so-that-both-INFO"><span class="toc-number"></span> <span class="toc-text">report to its master a specific set of IP and port, so that both INFO</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-ROLE-will-report-those-values"><span class="toc-number"></span> <span class="toc-text">and ROLE will report those values.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#There-is-no-need-to-use-both-the-options-if-you-need-to-override-just"><span class="toc-number"></span> <span class="toc-text">There is no need to use both the options if you need to override just</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-port-or-the-IP-address"><span class="toc-number"></span> <span class="toc-text">the port or the IP address.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-announce-ip-5-5-5-5"><span class="toc-number"></span> <span class="toc-text">replica-announce-ip 5.5.5.5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-announce-port-1234"><span class="toc-number"></span> <span class="toc-text">replica-announce-port 1234</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Require-clients-to-issue-AUTH-before-processing-any-other"><span class="toc-number"></span> <span class="toc-text">Require clients to issue AUTH  before processing any other</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#commands-This-might-be-useful-in-environments-in-which-you-do-not-trust"><span class="toc-number"></span> <span class="toc-text">commands.  This might be useful in environments in which you do not trust</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#others-with-access-to-the-host-running-redis-server"><span class="toc-number"></span> <span class="toc-text">others with access to the host running redis-server.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-should-stay-commented-out-for-backward-compatibility-and-because-most"><span class="toc-number"></span> <span class="toc-text">This should stay commented out for backward compatibility and because most</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#people-do-not-need-auth-e-g-they-run-their-own-servers"><span class="toc-number"></span> <span class="toc-text">people do not need auth (e.g. they run their own servers).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Warning-since-Redis-is-pretty-fast-an-outside-user-can-try-up-to"><span class="toc-number"></span> <span class="toc-text">Warning: since Redis is pretty fast an outside user can try up to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#150k-passwords-per-second-against-a-good-box-This-means-that-you-should"><span class="toc-number"></span> <span class="toc-text">150k passwords per second against a good box. This means that you should</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#use-a-very-strong-password-otherwise-it-will-be-very-easy-to-break"><span class="toc-number"></span> <span class="toc-text">use a very strong password otherwise it will be very easy to break.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#requirepass-foobared"><span class="toc-number"></span> <span class="toc-text">requirepass foobared</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Command-renaming"><span class="toc-number"></span> <span class="toc-text">Command renaming.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-possible-to-change-the-name-of-dangerous-commands-in-a-shared"><span class="toc-number"></span> <span class="toc-text">It is possible to change the name of dangerous commands in a shared</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#environment-For-instance-the-CONFIG-command-may-be-renamed-into-something"><span class="toc-number"></span> <span class="toc-text">environment. For instance the CONFIG command may be renamed into something</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hard-to-guess-so-that-it-will-still-be-available-for-internal-use-tools"><span class="toc-number"></span> <span class="toc-text">hard to guess so that it will still be available for internal-use tools</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#but-not-available-for-general-clients"><span class="toc-number"></span> <span class="toc-text">but not available for general clients.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example"><span class="toc-number"></span> <span class="toc-text">Example:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rename-command-CONFIG-b840fc02d524045429941cc15f59e41cb7be6c52"><span class="toc-number"></span> <span class="toc-text">rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-also-possible-to-completely-kill-a-command-by-renaming-it-into"><span class="toc-number"></span> <span class="toc-text">It is also possible to completely kill a command by renaming it into</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#an-empty-string"><span class="toc-number"></span> <span class="toc-text">an empty string:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rename-command-CONFIG-“”"><span class="toc-number"></span> <span class="toc-text">rename-command CONFIG “”</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Please-note-that-changing-the-name-of-commands-that-are-logged-into-the"><span class="toc-number"></span> <span class="toc-text">Please note that changing the name of commands that are logged into the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOF-file-or-transmitted-to-replicas-may-cause-problems"><span class="toc-number"></span> <span class="toc-text">AOF file or transmitted to replicas may cause problems.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-the-max-number-of-connected-clients-at-the-same-time-By-default"><span class="toc-number"></span> <span class="toc-text">Set the max number of connected clients at the same time. By default</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-limit-is-set-to-10000-clients-however-if-the-Redis-server-is-not"><span class="toc-number"></span> <span class="toc-text">this limit is set to 10000 clients, however if the Redis server is not</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#able-to-configure-the-process-file-limit-to-allow-for-the-specified-limit"><span class="toc-number"></span> <span class="toc-text">able to configure the process file limit to allow for the specified limit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-max-number-of-allowed-clients-is-set-to-the-current-file-limit"><span class="toc-number"></span> <span class="toc-text">the max number of allowed clients is set to the current file limit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#minus-32-as-Redis-reserves-a-few-file-descriptors-for-internal-uses"><span class="toc-number"></span> <span class="toc-text">minus 32 (as Redis reserves a few file descriptors for internal uses).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Once-the-limit-is-reached-Redis-will-close-all-the-new-connections-sending"><span class="toc-number"></span> <span class="toc-text">Once the limit is reached Redis will close all the new connections sending</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#an-error-‘max-number-of-clients-reached’"><span class="toc-number"></span> <span class="toc-text">an error ‘max number of clients reached’.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maxclients-10000"><span class="toc-number"></span> <span class="toc-text">maxclients 10000</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-a-memory-usage-limit-to-the-specified-amount-of-bytes"><span class="toc-number"></span> <span class="toc-text">Set a memory usage limit to the specified amount of bytes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-the-memory-limit-is-reached-Redis-will-try-to-remove-keys"><span class="toc-number"></span> <span class="toc-text">When the memory limit is reached Redis will try to remove keys</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#according-to-the-eviction-policy-selected-see-maxmemory-policy"><span class="toc-number"></span> <span class="toc-text">according to the eviction policy selected (see maxmemory-policy).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-Redis-can’t-remove-keys-according-to-the-policy-or-if-the-policy-is"><span class="toc-number"></span> <span class="toc-text">If Redis can’t remove keys according to the policy, or if the policy is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set-to-‘noeviction’-Redis-will-start-to-reply-with-errors-to-commands"><span class="toc-number"></span> <span class="toc-text">set to ‘noeviction’, Redis will start to reply with errors to commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-would-use-more-memory-like-SET-LPUSH-and-so-on-and-will-continue"><span class="toc-number"></span> <span class="toc-text">that would use more memory, like SET, LPUSH, and so on, and will continue</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-reply-to-read-only-commands-like-GET"><span class="toc-number"></span> <span class="toc-text">to reply to read-only commands like GET.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-option-is-usually-useful-when-using-Redis-as-an-LRU-or-LFU-cache-or-to"><span class="toc-number"></span> <span class="toc-text">This option is usually useful when using Redis as an LRU or LFU cache, or to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set-a-hard-memory-limit-for-an-instance-using-the-‘noeviction’-policy"><span class="toc-number"></span> <span class="toc-text">set a hard memory limit for an instance (using the ‘noeviction’ policy).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WARNING-If-you-have-replicas-attached-to-an-instance-with-maxmemory-on"><span class="toc-number"></span> <span class="toc-text">WARNING: If you have replicas attached to an instance with maxmemory on,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-size-of-the-output-buffers-needed-to-feed-the-replicas-are-subtracted"><span class="toc-number"></span> <span class="toc-text">the size of the output buffers needed to feed the replicas are subtracted</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#from-the-used-memory-count-so-that-network-problems-resyncs-will"><span class="toc-number"></span> <span class="toc-text">from the used memory count, so that network problems / resyncs will</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#not-trigger-a-loop-where-keys-are-evicted-and-in-turn-the-output"><span class="toc-number"></span> <span class="toc-text">not trigger a loop where keys are evicted, and in turn the output</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#buffer-of-replicas-is-full-with-DELs-of-keys-evicted-triggering-the-deletion"><span class="toc-number"></span> <span class="toc-text">buffer of replicas is full with DELs of keys evicted triggering the deletion</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-more-keys-and-so-forth-until-the-database-is-completely-emptied"><span class="toc-number"></span> <span class="toc-text">of more keys, and so forth until the database is completely emptied.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-short…-if-you-have-replicas-attached-it-is-suggested-that-you-set-a-lower"><span class="toc-number"></span> <span class="toc-text">In short… if you have replicas attached it is suggested that you set a lower</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#limit-for-maxmemory-so-that-there-is-some-free-RAM-on-the-system-for-replica"><span class="toc-number"></span> <span class="toc-text">limit for maxmemory so that there is some free RAM on the system for replica</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#output-buffers-but-this-is-not-needed-if-the-policy-is-‘noeviction’"><span class="toc-number"></span> <span class="toc-text">output buffers (but this is not needed if the policy is ‘noeviction’).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maxmemory"><span class="toc-number"></span> <span class="toc-text">maxmemory </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MAXMEMORY-POLICY-how-Redis-will-select-what-to-remove-when-maxmemory"><span class="toc-number"></span> <span class="toc-text">MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-reached-You-can-select-among-five-behaviors"><span class="toc-number"></span> <span class="toc-text">is reached. You can select among five behaviors:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#volatile-lru-gt-Evict-using-approximated-LRU-among-the-keys-with-an-expire-set"><span class="toc-number"></span> <span class="toc-text">volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#allkeys-lru-gt-Evict-any-key-using-approximated-LRU"><span class="toc-number"></span> <span class="toc-text">allkeys-lru -&gt; Evict any key using approximated LRU.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#volatile-lfu-gt-Evict-using-approximated-LFU-among-the-keys-with-an-expire-set"><span class="toc-number"></span> <span class="toc-text">volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#allkeys-lfu-gt-Evict-any-key-using-approximated-LFU"><span class="toc-number"></span> <span class="toc-text">allkeys-lfu -&gt; Evict any key using approximated LFU.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#volatile-random-gt-Remove-a-random-key-among-the-ones-with-an-expire-set"><span class="toc-number"></span> <span class="toc-text">volatile-random -&gt; Remove a random key among the ones with an expire set.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#allkeys-random-gt-Remove-a-random-key-any-key"><span class="toc-number"></span> <span class="toc-text">allkeys-random -&gt; Remove a random key, any key.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#volatile-ttl-gt-Remove-the-key-with-the-nearest-expire-time-minor-TTL"><span class="toc-number"></span> <span class="toc-text">volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#noeviction-gt-Don’t-evict-anything-just-return-an-error-on-write-operations"><span class="toc-number"></span> <span class="toc-text">noeviction -&gt; Don’t evict anything, just return an error on write operations.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LRU-means-Least-Recently-Used"><span class="toc-number"></span> <span class="toc-text">LRU means Least Recently Used</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LFU-means-Least-Frequently-Used"><span class="toc-number"></span> <span class="toc-text">LFU means Least Frequently Used</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Both-LRU-LFU-and-volatile-ttl-are-implemented-using-approximated"><span class="toc-number"></span> <span class="toc-text">Both LRU, LFU and volatile-ttl are implemented using approximated</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#randomized-algorithms"><span class="toc-number"></span> <span class="toc-text">randomized algorithms.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-with-any-of-the-above-policies-Redis-will-return-an-error-on-write"><span class="toc-number"></span> <span class="toc-text">Note: with any of the above policies, Redis will return an error on write</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#operations-when-there-are-no-suitable-keys-for-eviction"><span class="toc-number"></span> <span class="toc-text">operations, when there are no suitable keys for eviction.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#At-the-date-of-writing-these-commands-are-set-setnx-setex-append"><span class="toc-number"></span> <span class="toc-text">At the date of writing these commands are: set setnx setex append</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#incr-decr-rpush-lpush-rpushx-lpushx-linsert-lset-rpoplpush-sadd"><span class="toc-number"></span> <span class="toc-text">incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sinter-sinterstore-sunion-sunionstore-sdiff-sdiffstore-zadd-zincrby"><span class="toc-number"></span> <span class="toc-text">sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#zunionstore-zinterstore-hset-hsetnx-hmset-hincrby-incrby-decrby"><span class="toc-number"></span> <span class="toc-text">zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#getset-mset-msetnx-exec-sort"><span class="toc-number"></span> <span class="toc-text">getset mset msetnx exec sort</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-is"><span class="toc-number"></span> <span class="toc-text">The default is:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maxmemory-policy-noeviction"><span class="toc-number"></span> <span class="toc-text">maxmemory-policy noeviction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LRU-LFU-and-minimal-TTL-algorithms-are-not-precise-algorithms-but-approximated"><span class="toc-number"></span> <span class="toc-text">LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#algorithms-in-order-to-save-memory-so-you-can-tune-it-for-speed-or"><span class="toc-number"></span> <span class="toc-text">algorithms (in order to save memory), so you can tune it for speed or</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#accuracy-For-default-Redis-will-check-five-keys-and-pick-the-one-that-was"><span class="toc-number"></span> <span class="toc-text">accuracy. For default Redis will check five keys and pick the one that was</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#used-less-recently-you-can-change-the-sample-size-using-the-following"><span class="toc-number"></span> <span class="toc-text">used less recently, you can change the sample size using the following</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#configuration-directive"><span class="toc-number"></span> <span class="toc-text">configuration directive.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-of-5-produces-good-enough-results-10-Approximates-very-closely"><span class="toc-number"></span> <span class="toc-text">The default of 5 produces good enough results. 10 Approximates very closely</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#true-LRU-but-costs-more-CPU-3-is-faster-but-not-very-accurate"><span class="toc-number"></span> <span class="toc-text">true LRU but costs more CPU. 3 is faster but not very accurate.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maxmemory-samples-5"><span class="toc-number"></span> <span class="toc-text">maxmemory-samples 5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Starting-from-Redis-5-by-default-a-replica-will-ignore-its-maxmemory-setting"><span class="toc-number"></span> <span class="toc-text">Starting from Redis 5, by default a replica will ignore its maxmemory setting</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unless-it-is-promoted-to-master-after-a-failover-or-manually-It-means"><span class="toc-number"></span> <span class="toc-text">(unless it is promoted to master after a failover or manually). It means</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-the-eviction-of-keys-will-be-just-handled-by-the-master-sending-the"><span class="toc-number"></span> <span class="toc-text">that the eviction of keys will be just handled by the master, sending the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DEL-commands-to-the-replica-as-keys-evict-in-the-master-side"><span class="toc-number"></span> <span class="toc-text">DEL commands to the replica as keys evict in the master side.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-behavior-ensures-that-masters-and-replicas-stay-consistent-and-is-usually"><span class="toc-number"></span> <span class="toc-text">This behavior ensures that masters and replicas stay consistent, and is usually</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#what-you-want-however-if-your-replica-is-writable-or-you-want-the-replica-to-have"><span class="toc-number"></span> <span class="toc-text">what you want, however if your replica is writable, or you want the replica to have</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-different-memory-setting-and-you-are-sure-all-the-writes-performed-to-the"><span class="toc-number"></span> <span class="toc-text">a different memory setting, and you are sure all the writes performed to the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-are-idempotent-then-you-may-change-this-default-but-be-sure-to-understand"><span class="toc-number"></span> <span class="toc-text">replica are idempotent, then you may change this default (but be sure to understand</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#what-you-are-doing"><span class="toc-number"></span> <span class="toc-text">what you are doing).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-that-since-the-replica-by-default-does-not-evict-it-may-end-using-more"><span class="toc-number"></span> <span class="toc-text">Note that since the replica by default does not evict, it may end using more</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#memory-than-the-one-set-via-maxmemory-there-are-certain-buffers-that-may"><span class="toc-number"></span> <span class="toc-text">memory than the one set via maxmemory (there are certain buffers that may</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#be-larger-on-the-replica-or-data-structures-may-sometimes-take-more-memory-and-so"><span class="toc-number"></span> <span class="toc-text">be larger on the replica, or data structures may sometimes take more memory and so</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#forth-So-make-sure-you-monitor-your-replicas-and-make-sure-they-have-enough"><span class="toc-number"></span> <span class="toc-text">forth). So make sure you monitor your replicas and make sure they have enough</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#memory-to-never-hit-a-real-out-of-memory-condition-before-the-master-hits"><span class="toc-number"></span> <span class="toc-text">memory to never hit a real out-of-memory condition before the master hits</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-configured-maxmemory-setting"><span class="toc-number"></span> <span class="toc-text">the configured maxmemory setting.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-ignore-maxmemory-yes"><span class="toc-number"></span> <span class="toc-text">replica-ignore-maxmemory yes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-has-two-primitives-to-delete-keys-One-is-called-DEL-and-is-a-blocking"><span class="toc-number"></span> <span class="toc-text">Redis has two primitives to delete keys. One is called DEL and is a blocking</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#deletion-of-the-object-It-means-that-the-server-stops-processing-new-commands"><span class="toc-number"></span> <span class="toc-text">deletion of the object. It means that the server stops processing new commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-reclaim-all-the-memory-associated-with-an-object-in-a-synchronous"><span class="toc-number"></span> <span class="toc-text">in order to reclaim all the memory associated with an object in a synchronous</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#way-If-the-key-deleted-is-associated-with-a-small-object-the-time-needed"><span class="toc-number"></span> <span class="toc-text">way. If the key deleted is associated with a small object, the time needed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-execute-the-DEL-command-is-very-small-and-comparable-to-most-other"><span class="toc-number"></span> <span class="toc-text">in order to execute the DEL command is very small and comparable to most other</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#O-1-or-O-log-N-commands-in-Redis-However-if-the-key-is-associated-with-an"><span class="toc-number"></span> <span class="toc-text">O(1) or O(log_N) commands in Redis. However if the key is associated with an</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#aggregated-value-containing-millions-of-elements-the-server-can-block-for"><span class="toc-number"></span> <span class="toc-text">aggregated value containing millions of elements, the server can block for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-long-time-even-seconds-in-order-to-complete-the-operation"><span class="toc-number"></span> <span class="toc-text">a long time (even seconds) in order to complete the operation.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-the-above-reasons-Redis-also-offers-non-blocking-deletion-primitives"><span class="toc-number"></span> <span class="toc-text">For the above reasons Redis also offers non blocking deletion primitives</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#such-as-UNLINK-non-blocking-DEL-and-the-ASYNC-option-of-FLUSHALL-and"><span class="toc-number"></span> <span class="toc-text">such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FLUSHDB-commands-in-order-to-reclaim-memory-in-background-Those-commands"><span class="toc-number"></span> <span class="toc-text">FLUSHDB commands, in order to reclaim memory in background. Those commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#are-executed-in-constant-time-Another-thread-will-incrementally-free-the"><span class="toc-number"></span> <span class="toc-text">are executed in constant time. Another thread will incrementally free the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#object-in-the-background-as-fast-as-possible"><span class="toc-number"></span> <span class="toc-text">object in the background as fast as possible.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DEL-UNLINK-and-ASYNC-option-of-FLUSHALL-and-FLUSHDB-are-user-controlled"><span class="toc-number"></span> <span class="toc-text">DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It’s-up-to-the-design-of-the-application-to-understand-when-it-is-a-good"><span class="toc-number"></span> <span class="toc-text">It’s up to the design of the application to understand when it is a good</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idea-to-use-one-or-the-other-However-the-Redis-server-sometimes-has-to"><span class="toc-number"></span> <span class="toc-text">idea to use one or the other. However the Redis server sometimes has to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delete-keys-or-flush-the-whole-database-as-a-side-effect-of-other-operations"><span class="toc-number"></span> <span class="toc-text">delete keys or flush the whole database as a side effect of other operations.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Specifically-Redis-deletes-objects-independently-of-a-user-call-in-the"><span class="toc-number"></span> <span class="toc-text">Specifically Redis deletes objects independently of a user call in the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#following-scenarios"><span class="toc-number"></span> <span class="toc-text">following scenarios:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-On-eviction-because-of-the-maxmemory-and-maxmemory-policy-configurations"><span class="toc-number"></span> <span class="toc-text">1) On eviction, because of the maxmemory and maxmemory policy configurations,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-make-room-for-new-data-without-going-over-the-specified"><span class="toc-number"></span> <span class="toc-text">in order to make room for new data, without going over the specified</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#memory-limit"><span class="toc-number"></span> <span class="toc-text">memory limit.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Because-of-expire-when-a-key-with-an-associated-time-to-live-see-the"><span class="toc-number"></span> <span class="toc-text">2) Because of expire: when a key with an associated time to live (see the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EXPIRE-command-must-be-deleted-from-memory"><span class="toc-number"></span> <span class="toc-text">EXPIRE command) must be deleted from memory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Because-of-a-side-effect-of-a-command-that-stores-data-on-a-key-that-may"><span class="toc-number"></span> <span class="toc-text">3) Because of a side effect of a command that stores data on a key that may</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#already-exist-For-example-the-RENAME-command-may-delete-the-old-key"><span class="toc-number"></span> <span class="toc-text">already exist. For example the RENAME command may delete the old key</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#content-when-it-is-replaced-with-another-one-Similarly-SUNIONSTORE"><span class="toc-number"></span> <span class="toc-text">content when it is replaced with another one. Similarly SUNIONSTORE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#or-SORT-with-STORE-option-may-delete-existing-keys-The-SET-command"><span class="toc-number"></span> <span class="toc-text">or SORT with STORE option may delete existing keys. The SET command</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#itself-removes-any-old-content-of-the-specified-key-in-order-to-replace"><span class="toc-number"></span> <span class="toc-text">itself removes any old content of the specified key in order to replace</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#it-with-the-specified-string"><span class="toc-number"></span> <span class="toc-text">it with the specified string.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-During-replication-when-a-replica-performs-a-full-resynchronization-with"><span class="toc-number"></span> <span class="toc-text">4) During replication, when a replica performs a full resynchronization with</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#its-master-the-content-of-the-whole-database-is-removed-in-order-to"><span class="toc-number"></span> <span class="toc-text">its master, the content of the whole database is removed in order to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#load-the-RDB-file-just-transferred"><span class="toc-number"></span> <span class="toc-text">load the RDB file just transferred.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-all-the-above-cases-the-default-is-to-delete-objects-in-a-blocking-way"><span class="toc-number"></span> <span class="toc-text">In all the above cases the default is to delete objects in a blocking way,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#like-if-DEL-was-called-However-you-can-configure-each-case-specifically"><span class="toc-number"></span> <span class="toc-text">like if DEL was called. However you can configure each case specifically</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-instead-release-memory-in-a-non-blocking-way-like-if-UNLINK"><span class="toc-number"></span> <span class="toc-text">in order to instead release memory in a non-blocking way like if UNLINK</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#was-called-using-the-following-configuration-directives"><span class="toc-number"></span> <span class="toc-text">was called, using the following configuration directives:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-Redis-asynchronously-dumps-the-dataset-on-disk-This-mode-is"><span class="toc-number"></span> <span class="toc-text">By default Redis asynchronously dumps the dataset on disk. This mode is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#good-enough-in-many-applications-but-an-issue-with-the-Redis-process-or"><span class="toc-number"></span> <span class="toc-text">good enough in many applications, but an issue with the Redis process or</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-power-outage-may-result-into-a-few-minutes-of-writes-lost-depending-on"><span class="toc-number"></span> <span class="toc-text">a power outage may result into a few minutes of writes lost (depending on</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-configured-save-points"><span class="toc-number"></span> <span class="toc-text">the configured save points).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Append-Only-File-is-an-alternative-persistence-mode-that-provides"><span class="toc-number"></span> <span class="toc-text">The Append Only File is an alternative persistence mode that provides</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#much-better-durability-For-instance-using-the-default-data-fsync-policy"><span class="toc-number"></span> <span class="toc-text">much better durability. For instance using the default data fsync policy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#see-later-in-the-config-file-Redis-can-lose-just-one-second-of-writes-in-a"><span class="toc-number"></span> <span class="toc-text">(see later in the config file) Redis can lose just one second of writes in a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dramatic-event-like-a-server-power-outage-or-a-single-write-if-something"><span class="toc-number"></span> <span class="toc-text">dramatic event like a server power outage, or a single write if something</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wrong-with-the-Redis-process-itself-happens-but-the-operating-system-is"><span class="toc-number"></span> <span class="toc-text">wrong with the Redis process itself happens, but the operating system is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#still-running-correctly"><span class="toc-number"></span> <span class="toc-text">still running correctly.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOF-and-RDB-persistence-can-be-enabled-at-the-same-time-without-problems"><span class="toc-number"></span> <span class="toc-text">AOF and RDB persistence can be enabled at the same time without problems.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-AOF-is-enabled-on-startup-Redis-will-load-the-AOF-that-is-the-file"><span class="toc-number"></span> <span class="toc-text">If the AOF is enabled on startup Redis will load the AOF, that is the file</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#with-the-better-durability-guarantees"><span class="toc-number"></span> <span class="toc-text">with the better durability guarantees.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Please-check-http-redis-io-topics-persistence-for-more-information"><span class="toc-number"></span> <span class="toc-text">Please check http://redis.io/topics/persistence for more information.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-name-of-the-append-only-file-default-“appendonly-aof”"><span class="toc-number"></span> <span class="toc-text">The name of the append only file (default: “appendonly.aof”)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-fsync-call-tells-the-Operating-System-to-actually-write-data-on-disk"><span class="toc-number"></span> <span class="toc-text">The fsync() call tells the Operating System to actually write data on disk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#instead-of-waiting-for-more-data-in-the-output-buffer-Some-OS-will-really-flush"><span class="toc-number"></span> <span class="toc-text">instead of waiting for more data in the output buffer. Some OS will really flush</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#data-on-disk-some-other-OS-will-just-try-to-do-it-ASAP"><span class="toc-number"></span> <span class="toc-text">data on disk, some other OS will just try to do it ASAP.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-supports-three-different-modes"><span class="toc-number"></span> <span class="toc-text">Redis supports three different modes:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#no-don’t-fsync-just-let-the-OS-flush-the-data-when-it-wants-Faster"><span class="toc-number"></span> <span class="toc-text">no: don’t fsync, just let the OS flush the data when it wants. Faster.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#always-fsync-after-every-write-to-the-append-only-log-Slow-Safest"><span class="toc-number"></span> <span class="toc-text">always: fsync after every write to the append only log. Slow, Safest.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#everysec-fsync-only-one-time-every-second-Compromise"><span class="toc-number"></span> <span class="toc-text">everysec: fsync only one time every second. Compromise.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-is-“everysec”-as-that’s-usually-the-right-compromise-between"><span class="toc-number"></span> <span class="toc-text">The default is “everysec”, as that’s usually the right compromise between</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#speed-and-data-safety-It’s-up-to-you-to-understand-if-you-can-relax-this-to"><span class="toc-number"></span> <span class="toc-text">speed and data safety. It’s up to you to understand if you can relax this to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#“no”-that-will-let-the-operating-system-flush-the-output-buffer-when"><span class="toc-number"></span> <span class="toc-text">“no” that will let the operating system flush the output buffer when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#it-wants-for-better-performances-but-if-you-can-live-with-the-idea-of"><span class="toc-number"></span> <span class="toc-text">it wants, for better performances (but if you can live with the idea of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#some-data-loss-consider-the-default-persistence-mode-that’s-snapshotting"><span class="toc-number"></span> <span class="toc-text">some data loss consider the default persistence mode that’s snapshotting),</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#or-on-the-contrary-use-“always”-that’s-very-slow-but-a-bit-safer-than"><span class="toc-number"></span> <span class="toc-text">or on the contrary, use “always” that’s very slow but a bit safer than</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#everysec"><span class="toc-number"></span> <span class="toc-text">everysec.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#More-details-please-check-the-following-article"><span class="toc-number"></span> <span class="toc-text">More details please check the following article:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http-antirez-com-post-redis-persistence-demystified-html"><span class="toc-number"></span> <span class="toc-text">http://antirez.com/post/redis-persistence-demystified.html</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-unsure-use-“everysec”"><span class="toc-number"></span> <span class="toc-text">If unsure, use “everysec”.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#appendfsync-always"><span class="toc-number"></span> <span class="toc-text">appendfsync always</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#appendfsync-no"><span class="toc-number"></span> <span class="toc-text">appendfsync no</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-the-AOF-fsync-policy-is-set-to-always-or-everysec-and-a-background"><span class="toc-number"></span> <span class="toc-text">When the AOF fsync policy is set to always or everysec, and a background</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#saving-process-a-background-save-or-AOF-log-background-rewriting-is"><span class="toc-number"></span> <span class="toc-text">saving process (a background save or AOF log background rewriting) is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#performing-a-lot-of-I-O-against-the-disk-in-some-Linux-configurations"><span class="toc-number"></span> <span class="toc-text">performing a lot of I/O against the disk, in some Linux configurations</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-may-block-too-long-on-the-fsync-call-Note-that-there-is-no-fix-for"><span class="toc-number"></span> <span class="toc-text">Redis may block too long on the fsync() call. Note that there is no fix for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-currently-as-even-performing-fsync-in-a-different-thread-will-block"><span class="toc-number"></span> <span class="toc-text">this currently, as even performing fsync in a different thread will block</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#our-synchronous-write-2-call"><span class="toc-number"></span> <span class="toc-text">our synchronous write(2) call.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-order-to-mitigate-this-problem-it’s-possible-to-use-the-following-option"><span class="toc-number"></span> <span class="toc-text">In order to mitigate this problem it’s possible to use the following option</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-will-prevent-fsync-from-being-called-in-the-main-process-while-a"><span class="toc-number"></span> <span class="toc-text">that will prevent fsync() from being called in the main process while a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BGSAVE-or-BGREWRITEAOF-is-in-progress"><span class="toc-number"></span> <span class="toc-text">BGSAVE or BGREWRITEAOF is in progress.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-means-that-while-another-child-is-saving-the-durability-of-Redis-is"><span class="toc-number"></span> <span class="toc-text">This means that while another child is saving, the durability of Redis is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-same-as-“appendfsync-none”-In-practical-terms-this-means-that-it-is"><span class="toc-number"></span> <span class="toc-text">the same as “appendfsync none”. In practical terms, this means that it is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#possible-to-lose-up-to-30-seconds-of-log-in-the-worst-scenario-with-the"><span class="toc-number"></span> <span class="toc-text">possible to lose up to 30 seconds of log in the worst scenario (with the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#default-Linux-settings"><span class="toc-number"></span> <span class="toc-text">default Linux settings).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-you-have-latency-problems-turn-this-to-“yes”-Otherwise-leave-it-as"><span class="toc-number"></span> <span class="toc-text">If you have latency problems turn this to “yes”. Otherwise leave it as</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#“no”-that-is-the-safest-pick-from-the-point-of-view-of-durability"><span class="toc-number"></span> <span class="toc-text">“no” that is the safest pick from the point of view of durability.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Automatic-rewrite-of-the-append-only-file"><span class="toc-number"></span> <span class="toc-text">Automatic rewrite of the append only file.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-is-able-to-automatically-rewrite-the-log-file-implicitly-calling"><span class="toc-number"></span> <span class="toc-text">Redis is able to automatically rewrite the log file implicitly calling</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BGREWRITEAOF-when-the-AOF-log-size-grows-by-the-specified-percentage"><span class="toc-number"></span> <span class="toc-text">BGREWRITEAOF when the AOF log size grows by the specified percentage.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-is-how-it-works-Redis-remembers-the-size-of-the-AOF-file-after-the"><span class="toc-number"></span> <span class="toc-text">This is how it works: Redis remembers the size of the AOF file after the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latest-rewrite-if-no-rewrite-has-happened-since-the-restart-the-size-of"><span class="toc-number"></span> <span class="toc-text">latest rewrite (if no rewrite has happened since the restart, the size of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-AOF-at-startup-is-used"><span class="toc-number"></span> <span class="toc-text">the AOF at startup is used).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-base-size-is-compared-to-the-current-size-If-the-current-size-is"><span class="toc-number"></span> <span class="toc-text">This base size is compared to the current size. If the current size is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bigger-than-the-specified-percentage-the-rewrite-is-triggered-Also"><span class="toc-number"></span> <span class="toc-text">bigger than the specified percentage, the rewrite is triggered. Also</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#you-need-to-specify-a-minimal-size-for-the-AOF-file-to-be-rewritten-this"><span class="toc-number"></span> <span class="toc-text">you need to specify a minimal size for the AOF file to be rewritten, this</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-useful-to-avoid-rewriting-the-AOF-file-even-if-the-percentage-increase"><span class="toc-number"></span> <span class="toc-text">is useful to avoid rewriting the AOF file even if the percentage increase</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-reached-but-it-is-still-pretty-small"><span class="toc-number"></span> <span class="toc-text">is reached but it is still pretty small.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Specify-a-percentage-of-zero-in-order-to-disable-the-automatic-AOF"><span class="toc-number"></span> <span class="toc-text">Specify a percentage of zero in order to disable the automatic AOF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rewrite-feature"><span class="toc-number"></span> <span class="toc-text">rewrite feature.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#An-AOF-file-may-be-found-to-be-truncated-at-the-end-during-the-Redis"><span class="toc-number"></span> <span class="toc-text">An AOF file may be found to be truncated at the end during the Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#startup-process-when-the-AOF-data-gets-loaded-back-into-memory"><span class="toc-number"></span> <span class="toc-text">startup process, when the AOF data gets loaded back into memory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-may-happen-when-the-system-where-Redis-is-running"><span class="toc-number"></span> <span class="toc-text">This may happen when the system where Redis is running</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crashes-especially-when-an-ext4-filesystem-is-mounted-without-the"><span class="toc-number"></span> <span class="toc-text">crashes, especially when an ext4 filesystem is mounted without the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#data-ordered-option-however-this-can’t-happen-when-Redis-itself"><span class="toc-number"></span> <span class="toc-text">data=ordered option (however this can’t happen when Redis itself</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#crashes-or-aborts-but-the-operating-system-still-works-correctly"><span class="toc-number"></span> <span class="toc-text">crashes or aborts but the operating system still works correctly).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-can-either-exit-with-an-error-when-this-happens-or-load-as-much"><span class="toc-number"></span> <span class="toc-text">Redis can either exit with an error when this happens, or load as much</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#data-as-possible-the-default-now-and-start-if-the-AOF-file-is-found"><span class="toc-number"></span> <span class="toc-text">data as possible (the default now) and start if the AOF file is found</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-be-truncated-at-the-end-The-following-option-controls-this-behavior"><span class="toc-number"></span> <span class="toc-text">to be truncated at the end. The following option controls this behavior.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-aof-load-truncated-is-set-to-yes-a-truncated-AOF-file-is-loaded-and"><span class="toc-number"></span> <span class="toc-text">If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-Redis-server-starts-emitting-a-log-to-inform-the-user-of-the-event"><span class="toc-number"></span> <span class="toc-text">the Redis server starts emitting a log to inform the user of the event.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Otherwise-if-the-option-is-set-to-no-the-server-aborts-with-an-error"><span class="toc-number"></span> <span class="toc-text">Otherwise if the option is set to no, the server aborts with an error</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-refuses-to-start-When-the-option-is-set-to-no-the-user-requires"><span class="toc-number"></span> <span class="toc-text">and refuses to start. When the option is set to no, the user requires</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-fix-the-AOF-file-using-the-“redis-check-aof”-utility-before-to-restart"><span class="toc-number"></span> <span class="toc-text">to fix the AOF file using the “redis-check-aof” utility before to restart</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-server"><span class="toc-number"></span> <span class="toc-text">the server.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-that-if-the-AOF-file-will-be-found-to-be-corrupted-in-the-middle"><span class="toc-number"></span> <span class="toc-text">Note that if the AOF file will be found to be corrupted in the middle</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-server-will-still-exit-with-an-error-This-option-only-applies-when"><span class="toc-number"></span> <span class="toc-text">the server will still exit with an error. This option only applies when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-will-try-to-read-more-data-from-the-AOF-file-but-not-enough-bytes"><span class="toc-number"></span> <span class="toc-text">Redis will try to read more data from the AOF file but not enough bytes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-be-found"><span class="toc-number"></span> <span class="toc-text">will be found.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-rewriting-the-AOF-file-Redis-is-able-to-use-an-RDB-preamble-in-the"><span class="toc-number"></span> <span class="toc-text">When rewriting the AOF file, Redis is able to use an RDB preamble in the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOF-file-for-faster-rewrites-and-recoveries-When-this-option-is-turned"><span class="toc-number"></span> <span class="toc-text">AOF file for faster rewrites and recoveries. When this option is turned</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#on-the-rewritten-AOF-file-is-composed-of-two-different-stanzas"><span class="toc-number"></span> <span class="toc-text">on the rewritten AOF file is composed of two different stanzas:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RDB-file-AOF-tail"><span class="toc-number"></span> <span class="toc-text">[RDB file][AOF tail]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-loading-Redis-recognizes-that-the-AOF-file-starts-with-the-“REDIS”"><span class="toc-number"></span> <span class="toc-text">When loading Redis recognizes that the AOF file starts with the “REDIS”</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#string-and-loads-the-prefixed-RDB-file-and-continues-loading-the-AOF"><span class="toc-number"></span> <span class="toc-text">string and loads the prefixed RDB file, and continues loading the AOF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tail"><span class="toc-number"></span> <span class="toc-text">tail.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Max-execution-time-of-a-Lua-script-in-milliseconds"><span class="toc-number"></span> <span class="toc-text">Max execution time of a Lua script in milliseconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-maximum-execution-time-is-reached-Redis-will-log-that-a-script-is"><span class="toc-number"></span> <span class="toc-text">If the maximum execution time is reached Redis will log that a script is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#still-in-execution-after-the-maximum-allowed-time-and-will-start-to"><span class="toc-number"></span> <span class="toc-text">still in execution after the maximum allowed time and will start to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reply-to-queries-with-an-error"><span class="toc-number"></span> <span class="toc-text">reply to queries with an error.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-a-long-running-script-exceeds-the-maximum-execution-time-only-the"><span class="toc-number"></span> <span class="toc-text">When a long running script exceeds the maximum execution time only the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SCRIPT-KILL-and-SHUTDOWN-NOSAVE-commands-are-available-The-first-can-be"><span class="toc-number"></span> <span class="toc-text">SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#used-to-stop-a-script-that-did-not-yet-called-write-commands-The-second"><span class="toc-number"></span> <span class="toc-text">used to stop a script that did not yet called write commands. The second</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-the-only-way-to-shut-down-the-server-in-the-case-a-write-command-was"><span class="toc-number"></span> <span class="toc-text">is the only way to shut down the server in the case a write command was</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#already-issued-by-the-script-but-the-user-doesn’t-want-to-wait-for-the-natural"><span class="toc-number"></span> <span class="toc-text">already issued by the script but the user doesn’t want to wait for the natural</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#termination-of-the-script"><span class="toc-number"></span> <span class="toc-text">termination of the script.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-it-to-0-or-a-negative-value-for-unlimited-execution-without-warnings"><span class="toc-number"></span> <span class="toc-text">Set it to 0 or a negative value for unlimited execution without warnings.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#"><span class="toc-number"></span> <span class="toc-text">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WARNING-EXPERIMENTAL-Redis-Cluster-is-considered-to-be-stable-code-however"><span class="toc-number"></span> <span class="toc-text">WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-mark-it-as-“mature”-we-need-to-wait-for-a-non-trivial-percentage"><span class="toc-number"></span> <span class="toc-text">in order to mark it as “mature” we need to wait for a non trivial percentage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-users-to-deploy-it-in-production"><span class="toc-number"></span> <span class="toc-text">of users to deploy it in production.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-1"><span class="toc-number"></span> <span class="toc-text">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Normal-Redis-instances-can’t-be-part-of-a-Redis-Cluster-only-nodes-that-are"><span class="toc-number"></span> <span class="toc-text">Normal Redis instances can’t be part of a Redis Cluster; only nodes that are</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#started-as-cluster-nodes-can-In-order-to-start-a-Redis-instance-as-a"><span class="toc-number"></span> <span class="toc-text">started as cluster nodes can. In order to start a Redis instance as a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-node-enable-the-cluster-support-uncommenting-the-following"><span class="toc-number"></span> <span class="toc-text">cluster node enable the cluster support uncommenting the following:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-enabled-yes"><span class="toc-number"></span> <span class="toc-text">cluster-enabled yes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Every-cluster-node-has-a-cluster-configuration-file-This-file-is-not"><span class="toc-number"></span> <span class="toc-text">Every cluster node has a cluster configuration file. This file is not</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#intended-to-be-edited-by-hand-It-is-created-and-updated-by-Redis-nodes"><span class="toc-number"></span> <span class="toc-text">intended to be edited by hand. It is created and updated by Redis nodes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Every-Redis-Cluster-node-requires-a-different-cluster-configuration-file"><span class="toc-number"></span> <span class="toc-text">Every Redis Cluster node requires a different cluster configuration file.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Make-sure-that-instances-running-in-the-same-system-do-not-have"><span class="toc-number"></span> <span class="toc-text">Make sure that instances running in the same system do not have</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#overlapping-cluster-configuration-file-names"><span class="toc-number"></span> <span class="toc-text">overlapping cluster configuration file names.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-config-file-nodes-6379-conf"><span class="toc-number"></span> <span class="toc-text">cluster-config-file nodes-6379.conf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cluster-node-timeout-is-the-amount-of-milliseconds-a-node-must-be-unreachable"><span class="toc-number"></span> <span class="toc-text">Cluster node timeout is the amount of milliseconds a node must be unreachable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-it-to-be-considered-in-failure-state"><span class="toc-number"></span> <span class="toc-text">for it to be considered in failure state.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Most-other-internal-time-limits-are-multiple-of-the-node-timeout"><span class="toc-number"></span> <span class="toc-text">Most other internal time limits are multiple of the node timeout.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-node-timeout-15000"><span class="toc-number"></span> <span class="toc-text">cluster-node-timeout 15000</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-replica-of-a-failing-master-will-avoid-to-start-a-failover-if-its-data"><span class="toc-number"></span> <span class="toc-text">A replica of a failing master will avoid to start a failover if its data</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#looks-too-old"><span class="toc-number"></span> <span class="toc-text">looks too old.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#There-is-no-simple-way-for-a-replica-to-actually-have-an-exact-measure-of"><span class="toc-number"></span> <span class="toc-text">There is no simple way for a replica to actually have an exact measure of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#its-“data-age”-so-the-following-two-checks-are-performed"><span class="toc-number"></span> <span class="toc-text">its “data age”, so the following two checks are performed:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-If-there-are-multiple-replicas-able-to-failover-they-exchange-messages"><span class="toc-number"></span> <span class="toc-text">1) If there are multiple replicas able to failover, they exchange messages</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-try-to-give-an-advantage-to-the-replica-with-the-best"><span class="toc-number"></span> <span class="toc-text">in order to try to give an advantage to the replica with the best</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replication-offset-more-data-from-the-master-processed"><span class="toc-number"></span> <span class="toc-text">replication offset (more data from the master processed).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Replicas-will-try-to-get-their-rank-by-offset-and-apply-to-the-start"><span class="toc-number"></span> <span class="toc-text">Replicas will try to get their rank by offset, and apply to the start</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-the-failover-a-delay-proportional-to-their-rank"><span class="toc-number"></span> <span class="toc-text">of the failover a delay proportional to their rank.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Every-single-replica-computes-the-time-of-the-last-interaction-with"><span class="toc-number"></span> <span class="toc-text">2) Every single replica computes the time of the last interaction with</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#its-master-This-can-be-the-last-ping-or-command-received-if-the-master"><span class="toc-number"></span> <span class="toc-text">its master. This can be the last ping or command received (if the master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-still-in-the-“connected”-state-or-the-time-that-elapsed-since-the"><span class="toc-number"></span> <span class="toc-text">is still in the “connected” state), or the time that elapsed since the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#disconnection-with-the-master-if-the-replication-link-is-currently-down"><span class="toc-number"></span> <span class="toc-text">disconnection with the master (if the replication link is currently down).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-last-interaction-is-too-old-the-replica-will-not-try-to-failover"><span class="toc-number"></span> <span class="toc-text">If the last interaction is too old, the replica will not try to failover</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#at-all"><span class="toc-number"></span> <span class="toc-text">at all.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-point-“2”-can-be-tuned-by-user-Specifically-a-replica-will-not-perform"><span class="toc-number"></span> <span class="toc-text">The point “2” can be tuned by user. Specifically a replica will not perform</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-failover-if-since-the-last-interaction-with-the-master-the-time"><span class="toc-number"></span> <span class="toc-text">the failover if, since the last interaction with the master, the time</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elapsed-is-greater-than"><span class="toc-number"></span> <span class="toc-text">elapsed is greater than:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#node-timeout-replica-validity-factor-repl-ping-replica-period"><span class="toc-number"></span> <span class="toc-text">(node-timeout * replica-validity-factor) + repl-ping-replica-period</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#So-for-example-if-node-timeout-is-30-seconds-and-the-replica-validity-factor"><span class="toc-number"></span> <span class="toc-text">So for example if node-timeout is 30 seconds, and the replica-validity-factor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-10-and-assuming-a-default-repl-ping-replica-period-of-10-seconds-the"><span class="toc-number"></span> <span class="toc-text">is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-will-not-try-to-failover-if-it-was-not-able-to-talk-with-the-master"><span class="toc-number"></span> <span class="toc-text">replica will not try to failover if it was not able to talk with the master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-longer-than-310-seconds"><span class="toc-number"></span> <span class="toc-text">for longer than 310 seconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-large-replica-validity-factor-may-allow-replicas-with-too-old-data-to-failover"><span class="toc-number"></span> <span class="toc-text">A large replica-validity-factor may allow replicas with too old data to failover</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-master-while-a-too-small-value-may-prevent-the-cluster-from-being-able-to"><span class="toc-number"></span> <span class="toc-text">a master, while a too small value may prevent the cluster from being able to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elect-a-replica-at-all"><span class="toc-number"></span> <span class="toc-text">elect a replica at all.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-maximum-availability-it-is-possible-to-set-the-replica-validity-factor"><span class="toc-number"></span> <span class="toc-text">For maximum availability, it is possible to set the replica-validity-factor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-a-value-of-0-which-means-that-replicas-will-always-try-to-failover-the"><span class="toc-number"></span> <span class="toc-text">to a value of 0, which means, that replicas will always try to failover the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master-regardless-of-the-last-time-they-interacted-with-the-master"><span class="toc-number"></span> <span class="toc-text">master regardless of the last time they interacted with the master.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-they’ll-always-try-to-apply-a-delay-proportional-to-their"><span class="toc-number"></span> <span class="toc-text">(However they’ll always try to apply a delay proportional to their</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#offset-rank"><span class="toc-number"></span> <span class="toc-text">offset rank).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-is-the-only-value-able-to-guarantee-that-when-all-the-partitions-heal"><span class="toc-number"></span> <span class="toc-text">Zero is the only value able to guarantee that when all the partitions heal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-cluster-will-always-be-able-to-continue"><span class="toc-number"></span> <span class="toc-text">the cluster will always be able to continue.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-replica-validity-factor-10"><span class="toc-number"></span> <span class="toc-text">cluster-replica-validity-factor 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cluster-replicas-are-able-to-migrate-to-orphaned-masters-that-are-masters"><span class="toc-number"></span> <span class="toc-text">Cluster replicas are able to migrate to orphaned masters, that are masters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-are-left-without-working-replicas-This-improves-the-cluster-ability"><span class="toc-number"></span> <span class="toc-text">that are left without working replicas. This improves the cluster ability</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-resist-to-failures-as-otherwise-an-orphaned-master-can’t-be-failed-over"><span class="toc-number"></span> <span class="toc-text">to resist to failures as otherwise an orphaned master can’t be failed over</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-case-of-failure-if-it-has-no-working-replicas"><span class="toc-number"></span> <span class="toc-text">in case of failure if it has no working replicas.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Replicas-migrate-to-orphaned-masters-only-if-there-are-still-at-least-a"><span class="toc-number"></span> <span class="toc-text">Replicas migrate to orphaned masters only if there are still at least a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#given-number-of-other-working-replicas-for-their-old-master-This-number"><span class="toc-number"></span> <span class="toc-text">given number of other working replicas for their old master. This number</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-the-“migration-barrier”-A-migration-barrier-of-1-means-that-a-replica"><span class="toc-number"></span> <span class="toc-text">is the “migration barrier”. A migration barrier of 1 means that a replica</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-migrate-only-if-there-is-at-least-1-other-working-replica-for-its-master"><span class="toc-number"></span> <span class="toc-text">will migrate only if there is at least 1 other working replica for its master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-so-forth-It-usually-reflects-the-number-of-replicas-you-want-for-every"><span class="toc-number"></span> <span class="toc-text">and so forth. It usually reflects the number of replicas you want for every</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master-in-your-cluster"><span class="toc-number"></span> <span class="toc-text">master in your cluster.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Default-is-1-replicas-migrate-only-if-their-masters-remain-with-at-least"><span class="toc-number"></span> <span class="toc-text">Default is 1 (replicas migrate only if their masters remain with at least</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#one-replica-To-disable-migration-just-set-it-to-a-very-large-value"><span class="toc-number"></span> <span class="toc-text">one replica). To disable migration just set it to a very large value.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-value-of-0-can-be-set-but-is-useful-only-for-debugging-and-dangerous"><span class="toc-number"></span> <span class="toc-text">A value of 0 can be set but is useful only for debugging and dangerous</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-production"><span class="toc-number"></span> <span class="toc-text">in production.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-migration-barrier-1"><span class="toc-number"></span> <span class="toc-text">cluster-migration-barrier 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-Redis-Cluster-nodes-stop-accepting-queries-if-they-detect-there"><span class="toc-number"></span> <span class="toc-text">By default Redis Cluster nodes stop accepting queries if they detect there</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-at-least-an-hash-slot-uncovered-no-available-node-is-serving-it"><span class="toc-number"></span> <span class="toc-text">is at least an hash slot uncovered (no available node is serving it).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-way-if-the-cluster-is-partially-down-for-example-a-range-of-hash-slots"><span class="toc-number"></span> <span class="toc-text">This way if the cluster is partially down (for example a range of hash slots</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#are-no-longer-covered-all-the-cluster-becomes-eventually-unavailable"><span class="toc-number"></span> <span class="toc-text">are no longer covered) all the cluster becomes, eventually, unavailable.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-automatically-returns-available-as-soon-as-all-the-slots-are-covered-again"><span class="toc-number"></span> <span class="toc-text">It automatically returns available as soon as all the slots are covered again.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#However-sometimes-you-want-the-subset-of-the-cluster-which-is-working"><span class="toc-number"></span> <span class="toc-text">However sometimes you want the subset of the cluster which is working,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-continue-to-accept-queries-for-the-part-of-the-key-space-that-is-still"><span class="toc-number"></span> <span class="toc-text">to continue to accept queries for the part of the key space that is still</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#covered-In-order-to-do-so-just-set-the-cluster-require-full-coverage"><span class="toc-number"></span> <span class="toc-text">covered. In order to do so, just set the cluster-require-full-coverage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#option-to-no"><span class="toc-number"></span> <span class="toc-text">option to no.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-require-full-coverage-yes"><span class="toc-number"></span> <span class="toc-text">cluster-require-full-coverage yes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-option-when-set-to-yes-prevents-replicas-from-trying-to-failover-its"><span class="toc-number"></span> <span class="toc-text">This option, when set to yes, prevents replicas from trying to failover its</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master-during-master-failures-However-the-master-can-still-perform-a"><span class="toc-number"></span> <span class="toc-text">master during master failures. However the master can still perform a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#manual-failover-if-forced-to-do-so"><span class="toc-number"></span> <span class="toc-text">manual failover, if forced to do so.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-is-useful-in-different-scenarios-especially-in-the-case-of-multiple"><span class="toc-number"></span> <span class="toc-text">This is useful in different scenarios, especially in the case of multiple</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#data-center-operations-where-we-want-one-side-to-never-be-promoted-if-not"><span class="toc-number"></span> <span class="toc-text">data center operations, where we want one side to never be promoted if not</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-the-case-of-a-total-DC-failure"><span class="toc-number"></span> <span class="toc-text">in the case of a total DC failure.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-replica-no-failover-no"><span class="toc-number"></span> <span class="toc-text">cluster-replica-no-failover no</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-order-to-setup-your-cluster-make-sure-to-read-the-documentation"><span class="toc-number"></span> <span class="toc-text">In order to setup your cluster make sure to read the documentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#available-at-http-redis-io-web-site"><span class="toc-number"></span> <span class="toc-text">available at http://redis.io web site.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-certain-deployments-Redis-Cluster-nodes-address-discovery-fails-because"><span class="toc-number"></span> <span class="toc-text">In certain deployments, Redis Cluster nodes address discovery fails, because</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#addresses-are-NAT-ted-or-because-ports-are-forwarded-the-typical-case-is"><span class="toc-number"></span> <span class="toc-text">addresses are NAT-ted or because ports are forwarded (the typical case is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-and-other-containers"><span class="toc-number"></span> <span class="toc-text">Docker and other containers).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-order-to-make-Redis-Cluster-working-in-such-environments-a-static"><span class="toc-number"></span> <span class="toc-text">In order to make Redis Cluster working in such environments, a static</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#configuration-where-each-node-knows-its-public-address-is-needed-The"><span class="toc-number"></span> <span class="toc-text">configuration where each node knows its public address is needed. The</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#following-two-options-are-used-for-this-scope-and-are"><span class="toc-number"></span> <span class="toc-text">following two options are used for this scope, and are:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-ip"><span class="toc-number"></span> <span class="toc-text">* cluster-announce-ip</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-port"><span class="toc-number"></span> <span class="toc-text">* cluster-announce-port</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-bus-port"><span class="toc-number"></span> <span class="toc-text">* cluster-announce-bus-port</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Each-instruct-the-node-about-its-address-client-port-and-cluster-message"><span class="toc-number"></span> <span class="toc-text">Each instruct the node about its address, client port, and cluster message</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bus-port-The-information-is-then-published-in-the-header-of-the-bus-packets"><span class="toc-number"></span> <span class="toc-text">bus port. The information is then published in the header of the bus packets</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#so-that-other-nodes-will-be-able-to-correctly-map-the-address-of-the-node"><span class="toc-number"></span> <span class="toc-text">so that other nodes will be able to correctly map the address of the node</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#publishing-the-information"><span class="toc-number"></span> <span class="toc-text">publishing the information.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-the-above-options-are-not-used-the-normal-Redis-Cluster-auto-detection"><span class="toc-number"></span> <span class="toc-text">If the above options are not used, the normal Redis Cluster auto-detection</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-be-used-instead"><span class="toc-number"></span> <span class="toc-text">will be used instead.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Note-that-when-remapped-the-bus-port-may-not-be-at-the-fixed-offset-of"><span class="toc-number"></span> <span class="toc-text">Note that when remapped, the bus port may not be at the fixed offset of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#clients-port-10000-so-you-can-specify-any-port-and-bus-port-depending"><span class="toc-number"></span> <span class="toc-text">clients port + 10000, so you can specify any port and bus-port depending</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#on-how-they-get-remapped-If-the-bus-port-is-not-set-a-fixed-offset-of"><span class="toc-number"></span> <span class="toc-text">on how they get remapped. If the bus-port is not set, a fixed offset of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10000-will-be-used-as-usually"><span class="toc-number"></span> <span class="toc-text">10000 will be used as usually.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example-1"><span class="toc-number"></span> <span class="toc-text">Example:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-ip-10-1-1-5"><span class="toc-number"></span> <span class="toc-text">cluster-announce-ip 10.1.1.5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-port-6379"><span class="toc-number"></span> <span class="toc-text">cluster-announce-port 6379</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cluster-announce-bus-port-6380"><span class="toc-number"></span> <span class="toc-text">cluster-announce-bus-port 6380</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Redis-Slow-Log-is-a-system-to-log-queries-that-exceeded-a-specified"><span class="toc-number"></span> <span class="toc-text">The Redis Slow Log is a system to log queries that exceeded a specified</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#execution-time-The-execution-time-does-not-include-the-I-O-operations"><span class="toc-number"></span> <span class="toc-text">execution time. The execution time does not include the I/O operations</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#like-talking-with-the-client-sending-the-reply-and-so-forth"><span class="toc-number"></span> <span class="toc-text">like talking with the client, sending the reply and so forth,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#but-just-the-time-needed-to-actually-execute-the-command-this-is-the-only"><span class="toc-number"></span> <span class="toc-text">but just the time needed to actually execute the command (this is the only</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#stage-of-command-execution-where-the-thread-is-blocked-and-can-not-serve"><span class="toc-number"></span> <span class="toc-text">stage of command execution where the thread is blocked and can not serve</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#other-requests-in-the-meantime"><span class="toc-number"></span> <span class="toc-text">other requests in the meantime).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#You-can-configure-the-slow-log-with-two-parameters-one-tells-Redis"><span class="toc-number"></span> <span class="toc-text">You can configure the slow log with two parameters: one tells Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#what-is-the-execution-time-in-microseconds-to-exceed-in-order-for-the"><span class="toc-number"></span> <span class="toc-text">what is the execution time, in microseconds, to exceed in order for the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#command-to-get-logged-and-the-other-parameter-is-the-length-of-the"><span class="toc-number"></span> <span class="toc-text">command to get logged, and the other parameter is the length of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#slow-log-When-a-new-command-is-logged-the-oldest-one-is-removed-from-the"><span class="toc-number"></span> <span class="toc-text">slow log. When a new command is logged the oldest one is removed from the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#queue-of-logged-commands"><span class="toc-number"></span> <span class="toc-text">queue of logged commands.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-following-time-is-expressed-in-microseconds-so-1000000-is-equivalent"><span class="toc-number"></span> <span class="toc-text">The following time is expressed in microseconds, so 1000000 is equivalent</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-one-second-Note-that-a-negative-number-disables-the-slow-log-while"><span class="toc-number"></span> <span class="toc-text">to one second. Note that a negative number disables the slow log, while</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-value-of-zero-forces-the-logging-of-every-command"><span class="toc-number"></span> <span class="toc-text">a value of zero forces the logging of every command.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#There-is-no-limit-to-this-length-Just-be-aware-that-it-will-consume-memory"><span class="toc-number"></span> <span class="toc-text">There is no limit to this length. Just be aware that it will consume memory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#You-can-reclaim-memory-used-by-the-slow-log-with-SLOWLOG-RESET"><span class="toc-number"></span> <span class="toc-text">You can reclaim memory used by the slow log with SLOWLOG RESET.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Redis-latency-monitoring-subsystem-samples-different-operations"><span class="toc-number"></span> <span class="toc-text">The Redis latency monitoring subsystem samples different operations</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#at-runtime-in-order-to-collect-data-related-to-possible-sources-of"><span class="toc-number"></span> <span class="toc-text">at runtime in order to collect data related to possible sources of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-of-a-Redis-instance"><span class="toc-number"></span> <span class="toc-text">latency of a Redis instance.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Via-the-LATENCY-command-this-information-is-available-to-the-user-that-can"><span class="toc-number"></span> <span class="toc-text">Via the LATENCY command this information is available to the user that can</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#print-graphs-and-obtain-reports"><span class="toc-number"></span> <span class="toc-text">print graphs and obtain reports.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-system-only-logs-operations-that-were-performed-in-a-time-equal-or"><span class="toc-number"></span> <span class="toc-text">The system only logs operations that were performed in a time equal or</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#greater-than-the-amount-of-milliseconds-specified-via-the"><span class="toc-number"></span> <span class="toc-text">greater than the amount of milliseconds specified via the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#latency-monitor-threshold-configuration-directive-When-its-value-is-set"><span class="toc-number"></span> <span class="toc-text">latency-monitor-threshold configuration directive. When its value is set</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-zero-the-latency-monitor-is-turned-off"><span class="toc-number"></span> <span class="toc-text">to zero, the latency monitor is turned off.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-latency-monitoring-is-disabled-since-it-is-mostly-not-needed"><span class="toc-number"></span> <span class="toc-text">By default latency monitoring is disabled since it is mostly not needed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#if-you-don’t-have-latency-issues-and-collecting-data-has-a-performance"><span class="toc-number"></span> <span class="toc-text">if you don’t have latency issues, and collecting data has a performance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#impact-that-while-very-small-can-be-measured-under-big-load-Latency"><span class="toc-number"></span> <span class="toc-text">impact, that while very small, can be measured under big load. Latency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#monitoring-can-easily-be-enabled-at-runtime-using-the-command"><span class="toc-number"></span> <span class="toc-text">monitoring can easily be enabled at runtime using the command</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#“CONFIG-SET-latency-monitor-threshold-“-if-needed"><span class="toc-number"></span> <span class="toc-text">“CONFIG SET latency-monitor-threshold “ if needed.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-can-notify-Pub-Sub-clients-about-events-happening-in-the-key-space"><span class="toc-number"></span> <span class="toc-text">Redis can notify Pub/Sub clients about events happening in the key space.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-feature-is-documented-at-http-redis-io-topics-notifications"><span class="toc-number"></span> <span class="toc-text">This feature is documented at http://redis.io/topics/notifications</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-instance-if-keyspace-events-notification-is-enabled-and-a-client"><span class="toc-number"></span> <span class="toc-text">For instance if keyspace events notification is enabled, and a client</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#performs-a-DEL-operation-on-key-“foo”-stored-in-the-Database-0-two"><span class="toc-number"></span> <span class="toc-text">performs a DEL operation on key “foo” stored in the Database 0, two</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#messages-will-be-published-via-Pub-Sub"><span class="toc-number"></span> <span class="toc-text">messages will be published via Pub/Sub:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PUBLISH-keyspace-0-foo-del"><span class="toc-number"></span> <span class="toc-text">PUBLISH keyspace@0:foo del</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PUBLISH-keyevent-0-del-foo"><span class="toc-number"></span> <span class="toc-text">PUBLISH keyevent@0:del foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#It-is-possible-to-select-the-events-that-Redis-will-notify-among-a-set"><span class="toc-number"></span> <span class="toc-text">It is possible to select the events that Redis will notify among a set</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-classes-Every-class-is-identified-by-a-single-character"><span class="toc-number"></span> <span class="toc-text">of classes. Every class is identified by a single character:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#K-Keyspace-events-published-with-keyspace-prefix"><span class="toc-number"></span> <span class="toc-text">K     Keyspace events, published with keyspace@ prefix.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#E-Keyevent-events-published-with-keyevent-prefix"><span class="toc-number"></span> <span class="toc-text">E     Keyevent events, published with keyevent@ prefix.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#g-Generic-commands-non-type-specific-like-DEL-EXPIRE-RENAME-…"><span class="toc-number"></span> <span class="toc-text">g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, …</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#String-commands"><span class="toc-number"></span> <span class="toc-text">$     String commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#l-List-commands"><span class="toc-number"></span> <span class="toc-text">l     List commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#s-Set-commands"><span class="toc-number"></span> <span class="toc-text">s     Set commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#h-Hash-commands"><span class="toc-number"></span> <span class="toc-text">h     Hash commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#z-Sorted-set-commands"><span class="toc-number"></span> <span class="toc-text">z     Sorted set commands</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x-Expired-events-events-generated-every-time-a-key-expires"><span class="toc-number"></span> <span class="toc-text">x     Expired events (events generated every time a key expires)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#e-Evicted-events-events-generated-when-a-key-is-evicted-for-maxmemory"><span class="toc-number"></span> <span class="toc-text">e     Evicted events (events generated when a key is evicted for maxmemory)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-Alias-for-g-lshzxe-so-that-the-“AKE”-string-means-all-the-events"><span class="toc-number"></span> <span class="toc-text">A     Alias for g$lshzxe, so that the “AKE” string means all the events.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-“notify-keyspace-events”-takes-as-argument-a-string-that-is-composed"><span class="toc-number"></span> <span class="toc-text">The “notify-keyspace-events” takes as argument a string that is composed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-zero-or-multiple-characters-The-empty-string-means-that-notifications"><span class="toc-number"></span> <span class="toc-text">of zero or multiple characters. The empty string means that notifications</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#are-disabled"><span class="toc-number"></span> <span class="toc-text">are disabled.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example-to-enable-list-and-generic-events-from-the-point-of-view-of-the"><span class="toc-number"></span> <span class="toc-text">Example: to enable list and generic events, from the point of view of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#event-name-use"><span class="toc-number"></span> <span class="toc-text">event name, use:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#notify-keyspace-events-Elg"><span class="toc-number"></span> <span class="toc-text">notify-keyspace-events Elg</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Example-2-to-get-the-stream-of-the-expired-keys-subscribing-to-channel"><span class="toc-number"></span> <span class="toc-text">Example 2: to get the stream of the expired keys subscribing to channel</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#name-keyevent-0-expired-use"><span class="toc-number"></span> <span class="toc-text">name keyevent@0:expired use:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#notify-keyspace-events-Ex"><span class="toc-number"></span> <span class="toc-text">notify-keyspace-events Ex</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-all-notifications-are-disabled-because-most-users-don’t-need"><span class="toc-number"></span> <span class="toc-text">By default all notifications are disabled because most users don’t need</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-feature-and-the-feature-has-some-overhead-Note-that-if-you-don’t"><span class="toc-number"></span> <span class="toc-text">this feature and the feature has some overhead. Note that if you don’t</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#specify-at-least-one-of-K-or-E-no-events-will-be-delivered"><span class="toc-number"></span> <span class="toc-text">specify at least one of K or E, no events will be delivered.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hashes-are-encoded-using-a-memory-efficient-data-structure-when-they-have-a"><span class="toc-number"></span> <span class="toc-text">Hashes are encoded using a memory efficient data structure when they have a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#small-number-of-entries-and-the-biggest-entry-does-not-exceed-a-given"><span class="toc-number"></span> <span class="toc-text">small number of entries, and the biggest entry does not exceed a given</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#threshold-These-thresholds-can-be-configured-using-the-following-directives"><span class="toc-number"></span> <span class="toc-text">threshold. These thresholds can be configured using the following directives.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lists-are-also-encoded-in-a-special-way-to-save-a-lot-of-space"><span class="toc-number"></span> <span class="toc-text">Lists are also encoded in a special way to save a lot of space.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-number-of-entries-allowed-per-internal-list-node-can-be-specified"><span class="toc-number"></span> <span class="toc-text">The number of entries allowed per internal list node can be specified</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#as-a-fixed-maximum-size-or-a-maximum-number-of-elements"><span class="toc-number"></span> <span class="toc-text">as a fixed maximum size or a maximum number of elements.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#For-a-fixed-maximum-size-use-5-through-1-meaning"><span class="toc-number"></span> <span class="toc-text">For a fixed maximum size, use -5 through -1, meaning:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-max-size-64-Kb-lt-–-not-recommended-for-normal-workloads"><span class="toc-number"></span> <span class="toc-text">-5: max size: 64 Kb  &lt;– not recommended for normal workloads</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-max-size-32-Kb-lt-–-not-recommended"><span class="toc-number"></span> <span class="toc-text">-4: max size: 32 Kb  &lt;– not recommended</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-max-size-16-Kb-lt-–-probably-not-recommended"><span class="toc-number"></span> <span class="toc-text">-3: max size: 16 Kb  &lt;– probably not recommended</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-max-size-8-Kb-lt-–-good"><span class="toc-number"></span> <span class="toc-text">-2: max size: 8 Kb   &lt;– good</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-max-size-4-Kb-lt-–-good"><span class="toc-number"></span> <span class="toc-text">-1: max size: 4 Kb   &lt;– good</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Positive-numbers-mean-store-up-to-exactly-that-number-of-elements"><span class="toc-number"></span> <span class="toc-text">Positive numbers mean store up to exactly that number of elements</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#per-list-node"><span class="toc-number"></span> <span class="toc-text">per list node.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-highest-performing-option-is-usually-2-8-Kb-size-or-1-4-Kb-size"><span class="toc-number"></span> <span class="toc-text">The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#but-if-your-use-case-is-unique-adjust-the-settings-as-necessary"><span class="toc-number"></span> <span class="toc-text">but if your use case is unique, adjust the settings as necessary.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lists-may-also-be-compressed"><span class="toc-number"></span> <span class="toc-text">Lists may also be compressed.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Compress-depth-is-the-number-of-quicklist-ziplist-nodes-from-each-side-of"><span class="toc-number"></span> <span class="toc-text">Compress depth is the number of quicklist ziplist nodes from each side of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-list-to-exclude-from-compression-The-head-and-tail-of-the-list"><span class="toc-number"></span> <span class="toc-text">the list to exclude from compression.  The head and tail of the list</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#are-always-uncompressed-for-fast-push-pop-operations-Settings-are"><span class="toc-number"></span> <span class="toc-text">are always uncompressed for fast push/pop operations.  Settings are:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-disable-all-list-compression"><span class="toc-number"></span> <span class="toc-text">0: disable all list compression</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-depth-1-means-“don’t-start-compressing-until-after-1-node-into-the-list"><span class="toc-number"></span> <span class="toc-text">1: depth 1 means “don’t start compressing until after 1 node into the list,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#going-from-either-the-head-or-tail”"><span class="toc-number"></span> <span class="toc-text">going from either the head or tail”</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#So-head-gt-node-gt-node-gt-…-gt-node-gt-tail"><span class="toc-number"></span> <span class="toc-text">So: [head]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[tail]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#head-tail-will-always-be-uncompressed-inner-nodes-will-compress"><span class="toc-number"></span> <span class="toc-text">[head], [tail] will always be uncompressed; inner nodes will compress.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-head-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-tail"><span class="toc-number"></span> <span class="toc-text">2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[tail]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-here-means-don’t-compress-head-or-head-gt-next-or-tail-gt-prev-or-tail"><span class="toc-number"></span> <span class="toc-text">2 here means: don’t compress head or head-&gt;next or tail-&gt;prev or tail,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#but-compress-all-nodes-between-them"><span class="toc-number"></span> <span class="toc-text">but compress all nodes between them.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-head-gt-next-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-prev-gt-tail"><span class="toc-number"></span> <span class="toc-text">3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#etc"><span class="toc-number"></span> <span class="toc-text">etc.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sets-have-a-special-encoding-in-just-one-case-when-a-set-is-composed"><span class="toc-number"></span> <span class="toc-text">Sets have a special encoding in just one case: when a set is composed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-just-strings-that-happen-to-be-integers-in-radix-10-in-the-range"><span class="toc-number"></span> <span class="toc-text">of just strings that happen to be integers in radix 10 in the range</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-64-bit-signed-integers"><span class="toc-number"></span> <span class="toc-text">of 64 bit signed integers.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-following-configuration-setting-sets-the-limit-in-the-size-of-the"><span class="toc-number"></span> <span class="toc-text">The following configuration setting sets the limit in the size of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set-in-order-to-use-this-special-memory-saving-encoding"><span class="toc-number"></span> <span class="toc-text">set in order to use this special memory saving encoding.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Similarly-to-hashes-and-lists-sorted-sets-are-also-specially-encoded-in"><span class="toc-number"></span> <span class="toc-text">Similarly to hashes and lists, sorted sets are also specially encoded in</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#order-to-save-a-lot-of-space-This-encoding-is-only-used-when-the-length-and"><span class="toc-number"></span> <span class="toc-text">order to save a lot of space. This encoding is only used when the length and</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elements-of-a-sorted-set-are-below-the-following-limits"><span class="toc-number"></span> <span class="toc-text">elements of a sorted set are below the following limits:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HyperLogLog-sparse-representation-bytes-limit-The-limit-includes-the"><span class="toc-number"></span> <span class="toc-text">HyperLogLog sparse representation bytes limit. The limit includes the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-bytes-header-When-an-HyperLogLog-using-the-sparse-representation-crosses"><span class="toc-number"></span> <span class="toc-text">16 bytes header. When an HyperLogLog using the sparse representation crosses</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-limit-it-is-converted-into-the-dense-representation"><span class="toc-number"></span> <span class="toc-text">this limit, it is converted into the dense representation.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-value-greater-than-16000-is-totally-useless-since-at-that-point-the"><span class="toc-number"></span> <span class="toc-text">A value greater than 16000 is totally useless, since at that point the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dense-representation-is-more-memory-efficient"><span class="toc-number"></span> <span class="toc-text">dense representation is more memory efficient.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-suggested-value-is-3000-in-order-to-have-the-benefits-of"><span class="toc-number"></span> <span class="toc-text">The suggested value is ~ 3000 in order to have the benefits of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-space-efficient-encoding-without-slowing-down-too-much-PFADD"><span class="toc-number"></span> <span class="toc-text">the space efficient encoding without slowing down too much PFADD,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#which-is-O-N-with-the-sparse-encoding-The-value-can-be-raised-to"><span class="toc-number"></span> <span class="toc-text">which is O(N) with the sparse encoding. The value can be raised to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10000-when-CPU-is-not-a-concern-but-space-is-and-the-data-set-is"><span class="toc-number"></span> <span class="toc-text">~ 10000 when CPU is not a concern, but space is, and the data set is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#composed-of-many-HyperLogLogs-with-cardinality-in-the-0-15000-range"><span class="toc-number"></span> <span class="toc-text">composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Streams-macro-node-max-size-items-The-stream-data-structure-is-a-radix"><span class="toc-number"></span> <span class="toc-text">Streams macro node max size / items. The stream data structure is a radix</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tree-of-big-nodes-that-encode-multiple-items-inside-Using-this-configuration"><span class="toc-number"></span> <span class="toc-text">tree of big nodes that encode multiple items inside. Using this configuration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#it-is-possible-to-configure-how-big-a-single-node-can-be-in-bytes-and-the"><span class="toc-number"></span> <span class="toc-text">it is possible to configure how big a single node can be in bytes, and the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#maximum-number-of-items-it-may-contain-before-switching-to-a-new-node-when"><span class="toc-number"></span> <span class="toc-text">maximum number of items it may contain before switching to a new node when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#appending-new-stream-entries-If-any-of-the-following-settings-are-set-to"><span class="toc-number"></span> <span class="toc-text">appending new stream entries. If any of the following settings are set to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#zero-the-limit-is-ignored-so-for-instance-it-is-possible-to-set-just-a"><span class="toc-number"></span> <span class="toc-text">zero, the limit is ignored, so for instance it is possible to set just a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#max-entires-limit-by-setting-max-bytes-to-0-and-max-entries-to-the-desired"><span class="toc-number"></span> <span class="toc-text">max entires limit by setting max-bytes to 0 and max-entries to the desired</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#value"><span class="toc-number"></span> <span class="toc-text">value.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Active-rehashing-uses-1-millisecond-every-100-milliseconds-of-CPU-time-in"><span class="toc-number"></span> <span class="toc-text">Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#order-to-help-rehashing-the-main-Redis-hash-table-the-one-mapping-top-level"><span class="toc-number"></span> <span class="toc-text">order to help rehashing the main Redis hash table (the one mapping top-level</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#keys-to-values-The-hash-table-implementation-Redis-uses-see-dict-c"><span class="toc-number"></span> <span class="toc-text">keys to values). The hash table implementation Redis uses (see dict.c)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#performs-a-lazy-rehashing-the-more-operation-you-run-into-a-hash-table"><span class="toc-number"></span> <span class="toc-text">performs a lazy rehashing: the more operation you run into a hash table</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-is-rehashing-the-more-rehashing-“steps”-are-performed-so-if-the"><span class="toc-number"></span> <span class="toc-text">that is rehashing, the more rehashing “steps” are performed, so if the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#server-is-idle-the-rehashing-is-never-complete-and-some-more-memory-is-used"><span class="toc-number"></span> <span class="toc-text">server is idle the rehashing is never complete and some more memory is used</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#by-the-hash-table"><span class="toc-number"></span> <span class="toc-text">by the hash table.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-is-to-use-this-millisecond-10-times-every-second-in-order-to"><span class="toc-number"></span> <span class="toc-text">The default is to use this millisecond 10 times every second in order to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#actively-rehash-the-main-dictionaries-freeing-memory-when-possible"><span class="toc-number"></span> <span class="toc-text">actively rehash the main dictionaries, freeing memory when possible.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#If-unsure"><span class="toc-number"></span> <span class="toc-text">If unsure:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#use-“activerehashing-no”-if-you-have-hard-latency-requirements-and-it-is"><span class="toc-number"></span> <span class="toc-text">use “activerehashing no” if you have hard latency requirements and it is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#not-a-good-thing-in-your-environment-that-Redis-can-reply-from-time-to-time"><span class="toc-number"></span> <span class="toc-text">not a good thing in your environment that Redis can reply from time to time</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-queries-with-2-milliseconds-delay"><span class="toc-number"></span> <span class="toc-text">to queries with 2 milliseconds delay.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#use-“activerehashing-yes”-if-you-don’t-have-such-hard-requirements-but"><span class="toc-number"></span> <span class="toc-text">use “activerehashing yes” if you don’t have such hard requirements but</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#want-to-free-memory-asap-when-possible"><span class="toc-number"></span> <span class="toc-text">want to free memory asap when possible.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-client-output-buffer-limits-can-be-used-to-force-disconnection-of-clients"><span class="toc-number"></span> <span class="toc-text">The client output buffer limits can be used to force disconnection of clients</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#that-are-not-reading-data-from-the-server-fast-enough-for-some-reason-a"><span class="toc-number"></span> <span class="toc-text">that are not reading data from the server fast enough for some reason (a</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#common-reason-is-that-a-Pub-Sub-client-can’t-consume-messages-as-fast-as-the"><span class="toc-number"></span> <span class="toc-text">common reason is that a Pub/Sub client can’t consume messages as fast as the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#publisher-can-produce-them"><span class="toc-number"></span> <span class="toc-text">publisher can produce them).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-limit-can-be-set-differently-for-the-three-different-classes-of-clients"><span class="toc-number"></span> <span class="toc-text">The limit can be set differently for the three different classes of clients:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#normal-gt-normal-clients-including-MONITOR-clients"><span class="toc-number"></span> <span class="toc-text">normal -&gt; normal clients including MONITOR clients</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#replica-gt-replica-clients"><span class="toc-number"></span> <span class="toc-text">replica  -&gt; replica clients</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pubsub-gt-clients-subscribed-to-at-least-one-pubsub-channel-or-pattern"><span class="toc-number"></span> <span class="toc-text">pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-syntax-of-every-client-output-buffer-limit-directive-is-the-following"><span class="toc-number"></span> <span class="toc-text">The syntax of every client-output-buffer-limit directive is the following:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#client-output-buffer-limit"><span class="toc-number"></span> <span class="toc-text">client-output-buffer-limit    </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A-client-is-immediately-disconnected-once-the-hard-limit-is-reached-or-if"><span class="toc-number"></span> <span class="toc-text">A client is immediately disconnected once the hard limit is reached, or if</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-soft-limit-is-reached-and-remains-reached-for-the-specified-number-of"><span class="toc-number"></span> <span class="toc-text">the soft limit is reached and remains reached for the specified number of</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#seconds-continuously"><span class="toc-number"></span> <span class="toc-text">seconds (continuously).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#So-for-instance-if-the-hard-limit-is-32-megabytes-and-the-soft-limit-is"><span class="toc-number"></span> <span class="toc-text">So for instance if the hard limit is 32 megabytes and the soft limit is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-megabytes-10-seconds-the-client-will-get-disconnected-immediately"><span class="toc-number"></span> <span class="toc-text">16 megabytes / 10 seconds, the client will get disconnected immediately</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#if-the-size-of-the-output-buffers-reach-32-megabytes-but-will-also-get"><span class="toc-number"></span> <span class="toc-text">if the size of the output buffers reach 32 megabytes, but will also get</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#disconnected-if-the-client-reaches-16-megabytes-and-continuously-overcomes"><span class="toc-number"></span> <span class="toc-text">disconnected if the client reaches 16 megabytes and continuously overcomes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-limit-for-10-seconds"><span class="toc-number"></span> <span class="toc-text">the limit for 10 seconds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-normal-clients-are-not-limited-because-they-don’t-receive-data"><span class="toc-number"></span> <span class="toc-text">By default normal clients are not limited because they don’t receive data</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#without-asking-in-a-push-way-but-just-after-a-request-so-only"><span class="toc-number"></span> <span class="toc-text">without asking (in a push way), but just after a request, so only</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#asynchronous-clients-may-create-a-scenario-where-data-is-requested-faster"><span class="toc-number"></span> <span class="toc-text">asynchronous clients may create a scenario where data is requested faster</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#than-it-can-read"><span class="toc-number"></span> <span class="toc-text">than it can read.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Instead-there-is-a-default-limit-for-pubsub-and-replica-clients-since"><span class="toc-number"></span> <span class="toc-text">Instead there is a default limit for pubsub and replica clients, since</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#subscribers-and-replicas-receive-data-in-a-push-fashion"><span class="toc-number"></span> <span class="toc-text">subscribers and replicas receive data in a push fashion.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Both-the-hard-or-the-soft-limit-can-be-disabled-by-setting-them-to-zero"><span class="toc-number"></span> <span class="toc-text">Both the hard or the soft limit can be disabled by setting them to zero.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Client-query-buffers-accumulate-new-commands-They-are-limited-to-a-fixed"><span class="toc-number"></span> <span class="toc-text">Client query buffers accumulate new commands. They are limited to a fixed</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#amount-by-default-in-order-to-avoid-that-a-protocol-desynchronization-for"><span class="toc-number"></span> <span class="toc-text">amount by default in order to avoid that a protocol desynchronization (for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#instance-due-to-a-bug-in-the-client-will-lead-to-unbound-memory-usage-in"><span class="toc-number"></span> <span class="toc-text">instance due to a bug in the client) will lead to unbound memory usage in</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-query-buffer-However-you-can-configure-it-here-if-you-have-very-special"><span class="toc-number"></span> <span class="toc-text">the query buffer. However you can configure it here if you have very special</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#needs-such-us-huge-multi-exec-requests-or-alike"><span class="toc-number"></span> <span class="toc-text">needs, such us huge multi/exec requests or alike.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#client-query-buffer-limit-1gb"><span class="toc-number"></span> <span class="toc-text">client-query-buffer-limit 1gb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#In-the-Redis-protocol-bulk-requests-that-are-elements-representing-single"><span class="toc-number"></span> <span class="toc-text">In the Redis protocol, bulk requests, that are, elements representing single</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#strings-are-normally-limited-ot-512-mb-However-you-can-change-this-limit"><span class="toc-number"></span> <span class="toc-text">strings, are normally limited ot 512 mb. However you can change this limit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#here"><span class="toc-number"></span> <span class="toc-text">here.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#proto-max-bulk-len-512mb"><span class="toc-number"></span> <span class="toc-text">proto-max-bulk-len 512mb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-calls-an-internal-function-to-perform-many-background-tasks-like"><span class="toc-number"></span> <span class="toc-text">Redis calls an internal function to perform many background tasks, like</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#closing-connections-of-clients-in-timeout-purging-expired-keys-that-are"><span class="toc-number"></span> <span class="toc-text">closing connections of clients in timeout, purging expired keys that are</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#never-requested-and-so-forth"><span class="toc-number"></span> <span class="toc-text">never requested, and so forth.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Not-all-tasks-are-performed-with-the-same-frequency-but-Redis-checks-for"><span class="toc-number"></span> <span class="toc-text">Not all tasks are performed with the same frequency, but Redis checks for</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tasks-to-perform-according-to-the-specified-“hz”-value"><span class="toc-number"></span> <span class="toc-text">tasks to perform according to the specified “hz” value.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#By-default-“hz”-is-set-to-10-Raising-the-value-will-use-more-CPU-when"><span class="toc-number"></span> <span class="toc-text">By default “hz” is set to 10. Raising the value will use more CPU when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-is-idle-but-at-the-same-time-will-make-Redis-more-responsive-when"><span class="toc-number"></span> <span class="toc-text">Redis is idle, but at the same time will make Redis more responsive when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#there-are-many-keys-expiring-at-the-same-time-and-timeouts-may-be"><span class="toc-number"></span> <span class="toc-text">there are many keys expiring at the same time, and timeouts may be</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#handled-with-more-precision"><span class="toc-number"></span> <span class="toc-text">handled with more precision.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-range-is-between-1-and-500-however-a-value-over-100-is-usually-not"><span class="toc-number"></span> <span class="toc-text">The range is between 1 and 500, however a value over 100 is usually not</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-good-idea-Most-users-should-use-the-default-of-10-and-raise-this-up-to"><span class="toc-number"></span> <span class="toc-text">a good idea. Most users should use the default of 10 and raise this up to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#100-only-in-environments-where-very-low-latency-is-required"><span class="toc-number"></span> <span class="toc-text">100 only in environments where very low latency is required.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Normally-it-is-useful-to-have-an-HZ-value-which-is-proportional-to-the"><span class="toc-number"></span> <span class="toc-text">Normally it is useful to have an HZ value which is proportional to the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#number-of-clients-connected-This-is-useful-in-order-for-instance-to"><span class="toc-number"></span> <span class="toc-text">number of clients connected. This is useful in order, for instance, to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#avoid-too-many-clients-are-processed-for-each-background-task-invocation"><span class="toc-number"></span> <span class="toc-text">avoid too many clients are processed for each background task invocation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-avoid-latency-spikes"><span class="toc-number"></span> <span class="toc-text">in order to avoid latency spikes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Since-the-default-HZ-value-by-default-is-conservatively-set-to-10-Redis"><span class="toc-number"></span> <span class="toc-text">Since the default HZ value by default is conservatively set to 10, Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#offers-and-enables-by-default-the-ability-to-use-an-adaptive-HZ-value"><span class="toc-number"></span> <span class="toc-text">offers, and enables by default, the ability to use an adaptive HZ value</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#which-will-temporary-raise-when-there-are-many-connected-clients"><span class="toc-number"></span> <span class="toc-text">which will temporary raise when there are many connected clients.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-dynamic-HZ-is-enabled-the-actual-configured-HZ-will-be-used-as"><span class="toc-number"></span> <span class="toc-text">When dynamic HZ is enabled, the actual configured HZ will be used as</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#as-a-baseline-but-multiples-of-the-configured-HZ-value-will-be-actually"><span class="toc-number"></span> <span class="toc-text">as a baseline, but multiples of the configured HZ value will be actually</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#used-as-needed-once-more-clients-are-connected-In-this-way-an-idle"><span class="toc-number"></span> <span class="toc-text">used as needed once more clients are connected. In this way an idle</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#instance-will-use-very-little-CPU-time-while-a-busy-instance-will-be"><span class="toc-number"></span> <span class="toc-text">instance will use very little CPU time while a busy instance will be</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#more-responsive"><span class="toc-number"></span> <span class="toc-text">more responsive.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-a-child-rewrites-the-AOF-file-if-the-following-option-is-enabled"><span class="toc-number"></span> <span class="toc-text">When a child rewrites the AOF file, if the following option is enabled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful"><span class="toc-number"></span> <span class="toc-text">the file will be fsync-ed every 32 MB of data generated. This is useful</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid"><span class="toc-number"></span> <span class="toc-text">in order to commit the file to the disk more incrementally and avoid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#big-latency-spikes"><span class="toc-number"></span> <span class="toc-text">big latency spikes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#When-redis-saves-RDB-file-if-the-following-option-is-enabled"><span class="toc-number"></span> <span class="toc-text">When redis saves RDB file, if the following option is enabled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful-1"><span class="toc-number"></span> <span class="toc-text">the file will be fsync-ed every 32 MB of data generated. This is useful</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid-1"><span class="toc-number"></span> <span class="toc-text">in order to commit the file to the disk more incrementally and avoid</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#big-latency-spikes-1"><span class="toc-number"></span> <span class="toc-text">big latency spikes.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-LFU-eviction-see-maxmemory-setting-can-be-tuned-However-it-is-a-good"><span class="toc-number"></span> <span class="toc-text">Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#idea-to-start-with-the-default-settings-and-only-change-them-after-investigating"><span class="toc-number"></span> <span class="toc-text">idea to start with the default settings and only change them after investigating</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#how-to-improve-the-performances-and-how-the-keys-LFU-change-over-time-which"><span class="toc-number"></span> <span class="toc-text">how to improve the performances and how the keys LFU change over time, which</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#is-possible-to-inspect-via-the-OBJECT-FREQ-command"><span class="toc-number"></span> <span class="toc-text">is possible to inspect via the OBJECT FREQ command.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#There-are-two-tunable-parameters-in-the-Redis-LFU-implementation-the"><span class="toc-number"></span> <span class="toc-text">There are two tunable parameters in the Redis LFU implementation: the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#counter-logarithm-factor-and-the-counter-decay-time-It-is-important-to"><span class="toc-number"></span> <span class="toc-text">counter logarithm factor and the counter decay time. It is important to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#understand-what-the-two-parameters-mean-before-changing-them"><span class="toc-number"></span> <span class="toc-text">understand what the two parameters mean before changing them.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-LFU-counter-is-just-8-bits-per-key-it’s-maximum-value-is-255-so-Redis"><span class="toc-number"></span> <span class="toc-text">The LFU counter is just 8 bits per key, it’s maximum value is 255, so Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uses-a-probabilistic-increment-with-logarithmic-behavior-Given-the-value"><span class="toc-number"></span> <span class="toc-text">uses a probabilistic increment with logarithmic behavior. Given the value</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#of-the-old-counter-when-a-key-is-accessed-the-counter-is-incremented-in"><span class="toc-number"></span> <span class="toc-text">of the old counter, when a key is accessed, the counter is incremented in</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#this-way"><span class="toc-number"></span> <span class="toc-text">this way:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-A-random-number-R-between-0-and-1-is-extracted"><span class="toc-number"></span> <span class="toc-text">1. A random number R between 0 and 1 is extracted.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-A-probability-P-is-calculated-as-1-old-value-lfu-log-factor-1"><span class="toc-number"></span> <span class="toc-text">2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-The-counter-is-incremented-only-if-R-lt-P"><span class="toc-number"></span> <span class="toc-text">3. The counter is incremented only if R &lt; P.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-lfu-log-factor-is-10-This-is-a-table-of-how-the-frequency"><span class="toc-number"></span> <span class="toc-text">The default lfu-log-factor is 10. This is a table of how the frequency</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#counter-changes-with-a-different-number-of-accesses-with-different"><span class="toc-number"></span> <span class="toc-text">counter changes with a different number of accesses with different</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#logarithmic-factors"><span class="toc-number"></span> <span class="toc-text">logarithmic factors:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#factor-100-hits-1000-hits-100K-hits-1M-hits-10M-hits"><span class="toc-number"></span> <span class="toc-text">| factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————-1"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0-104-255-255-255-255"><span class="toc-number"></span> <span class="toc-text">| 0      | 104        | 255        | 255        | 255        | 255        |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————-2"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-18-49-255-255-255"><span class="toc-number"></span> <span class="toc-text">| 1      | 18         | 49         | 255        | 255        | 255        |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————-3"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-10-18-142-255-255"><span class="toc-number"></span> <span class="toc-text">| 10     | 10         | 18         | 142        | 255        | 255        |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————-4"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#100-8-11-49-143-255"><span class="toc-number"></span> <span class="toc-text">| 100    | 8          | 11         | 49         | 143        | 255        |</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——–-————-————-————-————-————-5"><span class="toc-number"></span> <span class="toc-text">+——–+————+————+————+————+————+</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NOTE-The-above-table-was-obtained-by-running-the-following-commands"><span class="toc-number"></span> <span class="toc-text">NOTE: The above table was obtained by running the following commands:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-benchmark-n-1000000-incr-foo"><span class="toc-number"></span> <span class="toc-text">redis-benchmark -n 1000000 incr foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-cli-object-freq-foo"><span class="toc-number"></span> <span class="toc-text">redis-cli object freq foo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NOTE-2-The-counter-initial-value-is-5-in-order-to-give-new-objects-a-chance"><span class="toc-number"></span> <span class="toc-text">NOTE 2: The counter initial value is 5 in order to give new objects a chance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-accumulate-hits"><span class="toc-number"></span> <span class="toc-text">to accumulate hits.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-counter-decay-time-is-the-time-in-minutes-that-must-elapse-in-order"><span class="toc-number"></span> <span class="toc-text">The counter decay time is the time, in minutes, that must elapse in order</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#for-the-key-counter-to-be-divided-by-two-or-decremented-if-it-has-a-value"><span class="toc-number"></span> <span class="toc-text">for the key counter to be divided by two (or decremented if it has a value</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#less-lt-10"><span class="toc-number"></span> <span class="toc-text">less &lt;= 10).</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-default-value-for-the-lfu-decay-time-is-1-A-Special-value-of-0-means-to"><span class="toc-number"></span> <span class="toc-text">The default value for the lfu-decay-time is 1. A Special value of 0 means to</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#decay-the-counter-every-time-it-happens-to-be-scanned"><span class="toc-number"></span> <span class="toc-text">decay the counter every time it happens to be scanned.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lfu-log-factor-10"><span class="toc-number"></span> <span class="toc-text">lfu-log-factor 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lfu-decay-time-1"><span class="toc-number"></span> <span class="toc-text">lfu-decay-time 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WARNING-THIS-FEATURE-IS-EXPERIMENTAL-However-it-was-stress-tested"><span class="toc-number"></span> <span class="toc-text">WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#even-in-production-and-manually-tested-by-multiple-engineers-for-some"><span class="toc-number"></span> <span class="toc-text">even in production and manually tested by multiple engineers for some</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#time"><span class="toc-number"></span> <span class="toc-text">time.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What-is-active-defragmentation"><span class="toc-number"></span> <span class="toc-text">What is active defragmentation?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#——————————"><span class="toc-number"></span> <span class="toc-text">——————————-</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Active-online-defragmentation-allows-a-Redis-server-to-compact-the"><span class="toc-number"></span> <span class="toc-text">Active (online) defragmentation allows a Redis server to compact the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#spaces-left-between-small-allocations-and-deallocations-of-data-in-memory"><span class="toc-number"></span> <span class="toc-text">spaces left between small allocations and deallocations of data in memory,</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thus-allowing-to-reclaim-back-memory"><span class="toc-number"></span> <span class="toc-text">thus allowing to reclaim back memory.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fragmentation-is-a-natural-process-that-happens-with-every-allocator-but"><span class="toc-number"></span> <span class="toc-text">Fragmentation is a natural process that happens with every allocator (but</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#less-so-with-Jemalloc-fortunately-and-certain-workloads-Normally-a-server"><span class="toc-number"></span> <span class="toc-text">less so with Jemalloc, fortunately) and certain workloads. Normally a server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#restart-is-needed-in-order-to-lower-the-fragmentation-or-at-least-to-flush"><span class="toc-number"></span> <span class="toc-text">restart is needed in order to lower the fragmentation, or at least to flush</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#away-all-the-data-and-create-it-again-However-thanks-to-this-feature"><span class="toc-number"></span> <span class="toc-text">away all the data and create it again. However thanks to this feature</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#implemented-by-Oran-Agra-for-Redis-4-0-this-process-can-happen-at-runtime"><span class="toc-number"></span> <span class="toc-text">implemented by Oran Agra for Redis 4.0 this process can happen at runtime</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#in-an-“hot”-way-while-the-server-is-running"><span class="toc-number"></span> <span class="toc-text">in an “hot” way, while the server is running.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basically-when-the-fragmentation-is-over-a-certain-level-see-the"><span class="toc-number"></span> <span class="toc-text">Basically when the fragmentation is over a certain level (see the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#configuration-options-below-Redis-will-start-to-create-new-copies-of-the"><span class="toc-number"></span> <span class="toc-text">configuration options below) Redis will start to create new copies of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#values-in-contiguous-memory-regions-by-exploiting-certain-specific-Jemalloc"><span class="toc-number"></span> <span class="toc-text">values in contiguous memory regions by exploiting certain specific Jemalloc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#features-in-order-to-understand-if-an-allocation-is-causing-fragmentation"><span class="toc-number"></span> <span class="toc-text">features (in order to understand if an allocation is causing fragmentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#and-to-allocate-it-in-a-better-place-and-at-the-same-time-will-release-the"><span class="toc-number"></span> <span class="toc-text">and to allocate it in a better place), and at the same time, will release the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#old-copies-of-the-data-This-process-repeated-incrementally-for-all-the-keys"><span class="toc-number"></span> <span class="toc-text">old copies of the data. This process, repeated incrementally for all the keys</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#will-cause-the-fragmentation-to-drop-back-to-normal-values"><span class="toc-number"></span> <span class="toc-text">will cause the fragmentation to drop back to normal values.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Important-things-to-understand"><span class="toc-number"></span> <span class="toc-text">Important things to understand:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-This-feature-is-disabled-by-default-and-only-works-if-you-compiled-Redis"><span class="toc-number"></span> <span class="toc-text">1. This feature is disabled by default, and only works if you compiled Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-use-the-copy-of-Jemalloc-we-ship-with-the-source-code-of-Redis"><span class="toc-number"></span> <span class="toc-text">to use the copy of Jemalloc we ship with the source code of Redis.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This-is-the-default-with-Linux-builds"><span class="toc-number"></span> <span class="toc-text">This is the default with Linux builds.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-You-never-need-to-enable-this-feature-if-you-don’t-have-fragmentation"><span class="toc-number"></span> <span class="toc-text">2. You never need to enable this feature if you don’t have fragmentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#issues"><span class="toc-number"></span> <span class="toc-text">issues.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Once-you-experience-fragmentation-you-can-enable-this-feature-when"><span class="toc-number"></span> <span class="toc-text">3. Once you experience fragmentation, you can enable this feature when</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#needed-with-the-command-“CONFIG-SET-activedefrag-yes”"><span class="toc-number"></span> <span class="toc-text">needed with the command “CONFIG SET activedefrag yes”.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-configuration-parameters-are-able-to-fine-tune-the-behavior-of-the"><span class="toc-number"></span> <span class="toc-text">The configuration parameters are able to fine tune the behavior of the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#defragmentation-process-If-you-are-not-sure-about-what-they-mean-it-is"><span class="toc-number"></span> <span class="toc-text">defragmentation process. If you are not sure about what they mean it is</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#a-good-idea-to-leave-the-defaults-untouched"><span class="toc-number"></span> <span class="toc-text">a good idea to leave the defaults untouched.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Enabled-active-defragmentation"><span class="toc-number"></span> <span class="toc-text">Enabled active defragmentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#activedefrag-yes"><span class="toc-number"></span> <span class="toc-text">activedefrag yes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Minimum-amount-of-fragmentation-waste-to-start-active-defrag"><span class="toc-number"></span> <span class="toc-text">Minimum amount of fragmentation waste to start active defrag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-ignore-bytes-100mb"><span class="toc-number"></span> <span class="toc-text">active-defrag-ignore-bytes 100mb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Minimum-percentage-of-fragmentation-to-start-active-defrag"><span class="toc-number"></span> <span class="toc-text">Minimum percentage of fragmentation to start active defrag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-threshold-lower-10"><span class="toc-number"></span> <span class="toc-text">active-defrag-threshold-lower 10</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Maximum-percentage-of-fragmentation-at-which-we-use-maximum-effort"><span class="toc-number"></span> <span class="toc-text">Maximum percentage of fragmentation at which we use maximum effort</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-threshold-upper-100"><span class="toc-number"></span> <span class="toc-text">active-defrag-threshold-upper 100</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Minimal-effort-for-defrag-in-CPU-percentage"><span class="toc-number"></span> <span class="toc-text">Minimal effort for defrag in CPU percentage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-cycle-min-5"><span class="toc-number"></span> <span class="toc-text">active-defrag-cycle-min 5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Maximal-effort-for-defrag-in-CPU-percentage"><span class="toc-number"></span> <span class="toc-text">Maximal effort for defrag in CPU percentage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-cycle-max-75"><span class="toc-number"></span> <span class="toc-text">active-defrag-cycle-max 75</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Maximum-number-of-set-hash-zset-list-fields-that-will-be-processed-from"><span class="toc-number"></span> <span class="toc-text">Maximum number of set/hash/zset/list fields that will be processed from</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#the-main-dictionary-scan"><span class="toc-number"></span> <span class="toc-text">the main dictionary scan</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#active-defrag-max-scan-fields-1000"><span class="toc-number"></span> <span class="toc-text">active-defrag-max-scan-fields 1000</span></a>
		
		</div>
		
		<p>为深入学习了解<code>redis</code>, 本文将对<code>redis5.0.0</code>源码包目录下的<code>redis.conf</code>配置文件进行完整翻译学习, 翻译顺序与配置文件保持一致;<br><a id="more"></a></p>
<p><code>Redis</code>配置文件示例</p>
<p>为程序能正确读取配置文件, 配置文件路径必须作为程序启动的第一个参数输入,  </p>
<blockquote>
<p>./redis-server /path/to/redis.conf </p>
</blockquote>
<p>默认的配置文件中, 首先约定了存储单位:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1k  =&gt; 1000 bytes</span><br><span class="line">1kb =&gt; 1024 bytes</span><br><span class="line">1m  =&gt; 1000000 bytes</span><br><span class="line">1mb =&gt; 1024*1024 bytes</span><br><span class="line">1g  =&gt; 1000000000 bytes</span><br><span class="line">1gb =&gt; 1024*1024*1024 bytes</span><br></pre></td></tr></table></figure></p>
<p>Redis配置中对单位的大小写不敏感, 1GB、1Gb和1gB都是相同的。由此也说明, Redis只支持bytes, 不支持bit单位。</p>
<h5 id="INCLUDES"><a href="#INCLUDES" class="headerlink" title="INCLUDES"></a>INCLUDES</h5><p>################################## INCLUDES ###################################</p>
<p>Redis支持以<code>include</code>的方式引入一个或多个其他配置文件, 比如:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include /path/to/local.conf</span><br><span class="line">include /path/to/other.conf</span><br></pre></td></tr></table></figure></p>
<p>当存在一个标准配置模板可以应用到所有的<code>redis server</code>服务实例中, 但又需要自定义配置其中某些服务实例的配置项, 则很适合用<code>include</code>引入这些自定义配置文件, 这些自定义配置文件中也可以通过<code>include</code>引入其他配置文件;<br>需要注意的是,<code>include</code>引入的配置项并不会被<code>admin</code>通过<code>CONFIG REWRITE</code>命令或<code>Redis Sentinel</code>重写; 但如一个配置项在不同配置文件中都有定义, 则以最后一行读入的为准, 就是说后面的配置项会覆盖前面的配置项。<br>在标准配置模板开始位置引入<code>include</code>配置文件, 则引入的这些配置文件不会覆盖标准配置模板中的配置项;<br>在标准配置模板最后位置引入<code>include</code>配置文件, 则引入的这些配置文件会覆盖标准配置模板中的配置项;</p>
<h5 id="MODULES"><a href="#MODULES" class="headerlink" title="MODULES"></a>MODULES</h5><p>################################## MODULES #####################################</p>
<p>从<code>redis4.0</code>版本开始支持载入模块功能, 大大扩展了<code>redis</code>功能,  <code>redis4.0</code>以上版本可以通过<code>loadmodule</code>配置在服务启动时载入相关模块功能,若当前<code>redis</code>服务器版本不支持加载模块, 则不会响应<code>loadmodule</code>指令; 可以使用多个<code>loadmodule</code>指令;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loadmodule /path/to/my_module.so</span><br><span class="line">loadmodule /path/to/other_module.so</span><br></pre></td></tr></table></figure>
<h5 id="NETWORK"><a href="#NETWORK" class="headerlink" title="NETWORK"></a>NETWORK</h5><p>################################## NETWORK #####################################<br>默认情况下, 如果没有具体指定<code>bind</code>配置指令, Redis会响应本机所有可用网卡的连接请求。Redis允许通过<code>bind</code>配置项来指定要绑定的一个或多个IP,<br>示例,<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind 192.168.1.100 10.0.0.1</span><br><span class="line">bind 127.0.0.1 ::1</span><br></pre></td></tr></table></figure></p>
<p>注意, 将设置<code>bind</code>为响应所有网卡请求<code>redis</code>实例的机器直接暴露在公网上是很危险的行为, 这样做会将数据库实例暴露给公网上的每个用户; 所以默认配置为<code>bind 127.0.0.1</code>，这将强制<code>redis</code>服务实例只能响应与<code>redis</code>服务运行在同一台机器上的客户端请求; 如果你确认安全的情况下, 可以<code>bind</code>为响应所有网卡请求;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br></pre></td></tr></table></figure></p>
<p>保护模式是为避免<code>Redis</code>实例运行在公网上和使用的一层保护行为;</p>
<p>当开启保护模式后, 存在如下情况,</p>
<ol>
<li>服务器没有通过<code>bind</code>指令明确绑定到一组网络地址上;</li>
<li>没有配置访问密码;</li>
</ol>
<p>则<code>redis</code>服务器只接受来自IPv4和IPv6环回地址127.0.0.1和:: 1上客户端的连接请求以及Unix sockets请求;</p>
<p>默认情况下, 保护模式是开启的, 在你确认在上述两种情况下需要响应来自其它机器上<code>redis</code>连接请求时, 可以自行保护模式;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure></p>
<p><code>redis</code>默认监听6379服务端口(IANA #815344), 当端口被设置为0时, <code>redis</code>服务器则不再监听TCP套接字连接了;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可是, 如果Redis不监听端口, 还怎么与外界通信呢？其实Redis还支持通过unix socket方式来接收请求。可以通过unix socket配置项来指定unix socket文件的路径, 并通过unix socket perm来指定文件的权限。</p>
</blockquote>
<p>TCP listen() backlog值<br>在高QPS场景下需要提高backlog值来避免TCP的慢连接问题; 若backlog值大于系统<code>/proc/sys/net/core/somaxconn</code>最大值, Linux kernel默认会将backlog值截断保存到somaxconn中, 即backlog值受到somaxconn的最大值影响, 所以为了达到理想效果请注意同时将<code>somaxconn</code>和<code>tcp_max_syn_backlog</code>设置为一个比较大的合理值; <code>redis.conf</code>默认设置tcp-backlog为511,<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-backlog 511</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>tcp_max_syn_backlog</code> 为tcp三次握手中未完成连接队列的最大值限制, 默认值为128;<br><code>somaxconn</code> 定义了系统中每一个端口最大的监听队列的长度,这是个全局的参数, 默认值为128;<br>更多说明可参考 <a href="http://researchlab.github.io/2018/09/23/tcp-net-programing/">TCP网络编程过程完整分析</a></p>
</blockquote>
<p>Unix socket<br>没有设置默认Unix socket 套接字路径, 所以Redis默认不会监听来自Unix socket的请求, 只有具体配置指定了Unix socket套接字路径, 才监听这个套接字上的请求;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> unixsocket /tmp/redis.sock  指定 unix socket 的路径</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unixsocketperm 700 指定 unix socket file 的权限</span></span><br></pre></td></tr></table></figure></p>
<p>当客户端闲置多少秒后关闭连接，如果设置为0表示关闭该功能, 默认为0;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 0</span><br></pre></td></tr></table></figure></p>
<p> TCP keepalive.<br>TCP连接保活策略, 可以通过tcp-keepalive配置项来进行设置, 单位为秒, 假如设置为60秒, 则server端会每60秒向连接空闲的客户端发起一次ACK请求, 以检查客户端是否已经挂掉, 对于无响应的客户端则会关闭其连接。所以关闭一个连接最长需要120秒的时间。如果设置为0, 则不会进行保活检测。<br>官方建议值为300s, 并从redis3.2.1开始默认设置tcp-keepalive值;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-keepalive 300</span><br></pre></td></tr></table></figure></p>
<h5 id="GENERAL"><a href="#GENERAL" class="headerlink" title="GENERAL"></a>GENERAL</h5><p>################################# GENERAL #####################################<br>默认情况, redis实例不会以守护进程运行, 如果需要运行为守护进程， 则应配置其值为<code>yes</code>, 当以守护进程运行时，redis会将其pid默认写入到<code>/var/run/redis.pid</code>文件中<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure></p>
<p>可以通过upstart和systemd管理Redis守护进程, 具体响应如下,<br><code>supervised no</code>      - 不使用 supervision 管理<br><code>supervised upstart</code> - <code>upstart</code>信号以<code>SIGSTOP</code>模式启动<code>redis</code><br><code>supervised systemd</code> - <code>systemd</code> 将READY=1 写入 $NOTIFY_SOCKET<br><code>supervised auto</code>    - 通过检测<code>UPSTART_JOB</code>或者<code>NOTIFY_SOCKET</code>环境参数来决定使用<code>upstart</code>或者<code>systemd</code>方法启动;<br>注意上述只能管理守护进程存在,并不会检测redis连接是否依然有效;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervised no</span><br></pre></td></tr></table></figure></p>
<p>当redis以守护模式启动时, 如果没有配置pidfile, pidfile默认值是/var/run/redis.pid, redis会在启动时将pid值记录到指定的pidfile中, 并且在服务关闭时删除这个pid记录;<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure></p>
<p>Redis支持通过loglevel配置项设置日志等级, 共分四级, 即debug、verbose、notice、warning, 记录的日志信息依次递减,重要程度依次递增, 默认为notice<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel notice</span><br></pre></td></tr></table></figure></p>
<p>Redis也支持通过logfile配置项来设置日志文件的生成位置。如果设置为空字符串, 则Redis会将日志输出到标准输出。假如在daemon情况下将日志设置为输出到标准输出, 则日志会被写到/dev/null中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logfile ""</span><br></pre></td></tr></table></figure>
<h1 id="To-enable-logging-to-the-system-logger-just-set-‘syslog-enabled’-to-yes"><a href="#To-enable-logging-to-the-system-logger-just-set-‘syslog-enabled’-to-yes" class="headerlink" title="To enable logging to the system logger, just set ‘syslog-enabled’ to yes,"></a>To enable logging to the system logger, just set ‘syslog-enabled’ to yes,</h1><h1 id="and-optionally-update-the-other-syslog-parameters-to-suit-your-needs"><a href="#and-optionally-update-the-other-syslog-parameters-to-suit-your-needs" class="headerlink" title="and optionally update the other syslog parameters to suit your needs."></a>and optionally update the other syslog parameters to suit your needs.</h1><h1 id="syslog-enabled-no"><a href="#syslog-enabled-no" class="headerlink" title="syslog-enabled no"></a>syslog-enabled no</h1><h1 id="Specify-the-syslog-identity"><a href="#Specify-the-syslog-identity" class="headerlink" title="Specify the syslog identity."></a>Specify the syslog identity.</h1><h1 id="syslog-ident-redis"><a href="#syslog-ident-redis" class="headerlink" title="syslog-ident redis"></a>syslog-ident redis</h1><h1 id="Specify-the-syslog-facility-Must-be-USER-or-between-LOCAL0-LOCAL7"><a href="#Specify-the-syslog-facility-Must-be-USER-or-between-LOCAL0-LOCAL7" class="headerlink" title="Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7."></a>Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</h1><h1 id="syslog-facility-local0"><a href="#syslog-facility-local0" class="headerlink" title="syslog-facility local0"></a>syslog-facility local0</h1><h1 id="Set-the-number-of-databases-The-default-database-is-DB-0-you-can-select"><a href="#Set-the-number-of-databases-The-default-database-is-DB-0-you-can-select" class="headerlink" title="Set the number of databases. The default database is DB 0, you can select"></a>Set the number of databases. The default database is DB 0, you can select</h1><h1 id="a-different-one-on-a-per-connection-basis-using-SELECT-where"><a href="#a-different-one-on-a-per-connection-basis-using-SELECT-where" class="headerlink" title="a different one on a per-connection basis using SELECT  where"></a>a different one on a per-connection basis using SELECT <dbid> where</dbid></h1><h1 id="dbid-is-a-number-between-0-and-‘databases’-1"><a href="#dbid-is-a-number-between-0-and-‘databases’-1" class="headerlink" title="dbid is a number between 0 and ‘databases’-1"></a>dbid is a number between 0 and ‘databases’-1</h1><p>databases 16</p>
<h1 id="By-default-Redis-shows-an-ASCII-art-logo-only-when-started-to-log-to-the"><a href="#By-default-Redis-shows-an-ASCII-art-logo-only-when-started-to-log-to-the" class="headerlink" title="By default Redis shows an ASCII art logo only when started to log to the"></a>By default Redis shows an ASCII art logo only when started to log to the</h1><h1 id="standard-output-and-if-the-standard-output-is-a-TTY-Basically-this-means"><a href="#standard-output-and-if-the-standard-output-is-a-TTY-Basically-this-means" class="headerlink" title="standard output and if the standard output is a TTY. Basically this means"></a>standard output and if the standard output is a TTY. Basically this means</h1><h1 id="that-normally-a-logo-is-displayed-only-in-interactive-sessions"><a href="#that-normally-a-logo-is-displayed-only-in-interactive-sessions" class="headerlink" title="that normally a logo is displayed only in interactive sessions."></a>that normally a logo is displayed only in interactive sessions.</h1><p>#</p>
<h1 id="However-it-is-possible-to-force-the-pre-4-0-behavior-and-always-show-a"><a href="#However-it-is-possible-to-force-the-pre-4-0-behavior-and-always-show-a" class="headerlink" title="However it is possible to force the pre-4.0 behavior and always show a"></a>However it is possible to force the pre-4.0 behavior and always show a</h1><h1 id="ASCII-art-logo-in-startup-logs-by-setting-the-following-option-to-yes"><a href="#ASCII-art-logo-in-startup-logs-by-setting-the-following-option-to-yes" class="headerlink" title="ASCII art logo in startup logs by setting the following option to yes."></a>ASCII art logo in startup logs by setting the following option to yes.</h1><p>always-show-logo yes</p>
<p>################################ SNAPSHOTTING  ################################<br>#</p>
<h1 id="Save-the-DB-on-disk"><a href="#Save-the-DB-on-disk" class="headerlink" title="Save the DB on disk:"></a>Save the DB on disk:</h1><p>#</p>
<h1 id="save"><a href="#save" class="headerlink" title="save  "></a>save <seconds> <changes></changes></seconds></h1><p>#</p>
<h1 id="Will-save-the-DB-if-both-the-given-number-of-seconds-and-the-given"><a href="#Will-save-the-DB-if-both-the-given-number-of-seconds-and-the-given" class="headerlink" title="Will save the DB if both the given number of seconds and the given"></a>Will save the DB if both the given number of seconds and the given</h1><h1 id="number-of-write-operations-against-the-DB-occurred"><a href="#number-of-write-operations-against-the-DB-occurred" class="headerlink" title="number of write operations against the DB occurred."></a>number of write operations against the DB occurred.</h1><p>#</p>
<h1 id="In-the-example-below-the-behaviour-will-be-to-save"><a href="#In-the-example-below-the-behaviour-will-be-to-save" class="headerlink" title="In the example below the behaviour will be to save:"></a>In the example below the behaviour will be to save:</h1><h1 id="after-900-sec-15-min-if-at-least-1-key-changed"><a href="#after-900-sec-15-min-if-at-least-1-key-changed" class="headerlink" title="after 900 sec (15 min) if at least 1 key changed"></a>after 900 sec (15 min) if at least 1 key changed</h1><h1 id="after-300-sec-5-min-if-at-least-10-keys-changed"><a href="#after-300-sec-5-min-if-at-least-10-keys-changed" class="headerlink" title="after 300 sec (5 min) if at least 10 keys changed"></a>after 300 sec (5 min) if at least 10 keys changed</h1><h1 id="after-60-sec-if-at-least-10000-keys-changed"><a href="#after-60-sec-if-at-least-10000-keys-changed" class="headerlink" title="after 60 sec if at least 10000 keys changed"></a>after 60 sec if at least 10000 keys changed</h1><p>#</p>
<h1 id="Note-you-can-disable-saving-completely-by-commenting-out-all-“save”-lines"><a href="#Note-you-can-disable-saving-completely-by-commenting-out-all-“save”-lines" class="headerlink" title="Note: you can disable saving completely by commenting out all “save” lines."></a>Note: you can disable saving completely by commenting out all “save” lines.</h1><p>#</p>
<h1 id="It-is-also-possible-to-remove-all-the-previously-configured-save"><a href="#It-is-also-possible-to-remove-all-the-previously-configured-save" class="headerlink" title="It is also possible to remove all the previously configured save"></a>It is also possible to remove all the previously configured save</h1><h1 id="points-by-adding-a-save-directive-with-a-single-empty-string-argument"><a href="#points-by-adding-a-save-directive-with-a-single-empty-string-argument" class="headerlink" title="points by adding a save directive with a single empty string argument"></a>points by adding a save directive with a single empty string argument</h1><h1 id="like-in-the-following-example"><a href="#like-in-the-following-example" class="headerlink" title="like in the following example:"></a>like in the following example:</h1><p>#</p>
<h1 id="save-“”"><a href="#save-“”" class="headerlink" title="save “”"></a>save “”</h1><p>save 900 1<br>save 300 10<br>save 60 10000</p>
<h1 id="By-default-Redis-will-stop-accepting-writes-if-RDB-snapshots-are-enabled"><a href="#By-default-Redis-will-stop-accepting-writes-if-RDB-snapshots-are-enabled" class="headerlink" title="By default Redis will stop accepting writes if RDB snapshots are enabled"></a>By default Redis will stop accepting writes if RDB snapshots are enabled</h1><h1 id="at-least-one-save-point-and-the-latest-background-save-failed"><a href="#at-least-one-save-point-and-the-latest-background-save-failed" class="headerlink" title="(at least one save point) and the latest background save failed."></a>(at least one save point) and the latest background save failed.</h1><h1 id="This-will-make-the-user-aware-in-a-hard-way-that-data-is-not-persisting"><a href="#This-will-make-the-user-aware-in-a-hard-way-that-data-is-not-persisting" class="headerlink" title="This will make the user aware (in a hard way) that data is not persisting"></a>This will make the user aware (in a hard way) that data is not persisting</h1><h1 id="on-disk-properly-otherwise-chances-are-that-no-one-will-notice-and-some"><a href="#on-disk-properly-otherwise-chances-are-that-no-one-will-notice-and-some" class="headerlink" title="on disk properly, otherwise chances are that no one will notice and some"></a>on disk properly, otherwise chances are that no one will notice and some</h1><h1 id="disaster-will-happen"><a href="#disaster-will-happen" class="headerlink" title="disaster will happen."></a>disaster will happen.</h1><p>#</p>
<h1 id="If-the-background-saving-process-will-start-working-again-Redis-will"><a href="#If-the-background-saving-process-will-start-working-again-Redis-will" class="headerlink" title="If the background saving process will start working again Redis will"></a>If the background saving process will start working again Redis will</h1><h1 id="automatically-allow-writes-again"><a href="#automatically-allow-writes-again" class="headerlink" title="automatically allow writes again."></a>automatically allow writes again.</h1><p>#</p>
<h1 id="However-if-you-have-setup-your-proper-monitoring-of-the-Redis-server"><a href="#However-if-you-have-setup-your-proper-monitoring-of-the-Redis-server" class="headerlink" title="However if you have setup your proper monitoring of the Redis server"></a>However if you have setup your proper monitoring of the Redis server</h1><h1 id="and-persistence-you-may-want-to-disable-this-feature-so-that-Redis-will"><a href="#and-persistence-you-may-want-to-disable-this-feature-so-that-Redis-will" class="headerlink" title="and persistence, you may want to disable this feature so that Redis will"></a>and persistence, you may want to disable this feature so that Redis will</h1><h1 id="continue-to-work-as-usual-even-if-there-are-problems-with-disk"><a href="#continue-to-work-as-usual-even-if-there-are-problems-with-disk" class="headerlink" title="continue to work as usual even if there are problems with disk,"></a>continue to work as usual even if there are problems with disk,</h1><h1 id="permissions-and-so-forth"><a href="#permissions-and-so-forth" class="headerlink" title="permissions, and so forth."></a>permissions, and so forth.</h1><p>stop-writes-on-bgsave-error yes</p>
<h1 id="Compress-string-objects-using-LZF-when-dump-rdb-databases"><a href="#Compress-string-objects-using-LZF-when-dump-rdb-databases" class="headerlink" title="Compress string objects using LZF when dump .rdb databases?"></a>Compress string objects using LZF when dump .rdb databases?</h1><h1 id="For-default-that’s-set-to-‘yes’-as-it’s-almost-always-a-win"><a href="#For-default-that’s-set-to-‘yes’-as-it’s-almost-always-a-win" class="headerlink" title="For default that’s set to ‘yes’ as it’s almost always a win."></a>For default that’s set to ‘yes’ as it’s almost always a win.</h1><h1 id="If-you-want-to-save-some-CPU-in-the-saving-child-set-it-to-‘no’-but"><a href="#If-you-want-to-save-some-CPU-in-the-saving-child-set-it-to-‘no’-but" class="headerlink" title="If you want to save some CPU in the saving child set it to ‘no’ but"></a>If you want to save some CPU in the saving child set it to ‘no’ but</h1><h1 id="the-dataset-will-likely-be-bigger-if-you-have-compressible-values-or-keys"><a href="#the-dataset-will-likely-be-bigger-if-you-have-compressible-values-or-keys" class="headerlink" title="the dataset will likely be bigger if you have compressible values or keys."></a>the dataset will likely be bigger if you have compressible values or keys.</h1><p>rdbcompression yes</p>
<h1 id="Since-version-5-of-RDB-a-CRC64-checksum-is-placed-at-the-end-of-the-file"><a href="#Since-version-5-of-RDB-a-CRC64-checksum-is-placed-at-the-end-of-the-file" class="headerlink" title="Since version 5 of RDB a CRC64 checksum is placed at the end of the file."></a>Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</h1><h1 id="This-makes-the-format-more-resistant-to-corruption-but-there-is-a-performance"><a href="#This-makes-the-format-more-resistant-to-corruption-but-there-is-a-performance" class="headerlink" title="This makes the format more resistant to corruption but there is a performance"></a>This makes the format more resistant to corruption but there is a performance</h1><h1 id="hit-to-pay-around-10-when-saving-and-loading-RDB-files-so-you-can-disable-it"><a href="#hit-to-pay-around-10-when-saving-and-loading-RDB-files-so-you-can-disable-it" class="headerlink" title="hit to pay (around 10%) when saving and loading RDB files, so you can disable it"></a>hit to pay (around 10%) when saving and loading RDB files, so you can disable it</h1><h1 id="for-maximum-performances"><a href="#for-maximum-performances" class="headerlink" title="for maximum performances."></a>for maximum performances.</h1><p>#</p>
<h1 id="RDB-files-created-with-checksum-disabled-have-a-checksum-of-zero-that-will"><a href="#RDB-files-created-with-checksum-disabled-have-a-checksum-of-zero-that-will" class="headerlink" title="RDB files created with checksum disabled have a checksum of zero that will"></a>RDB files created with checksum disabled have a checksum of zero that will</h1><h1 id="tell-the-loading-code-to-skip-the-check"><a href="#tell-the-loading-code-to-skip-the-check" class="headerlink" title="tell the loading code to skip the check."></a>tell the loading code to skip the check.</h1><p>rdbchecksum yes</p>
<h1 id="The-filename-where-to-dump-the-DB"><a href="#The-filename-where-to-dump-the-DB" class="headerlink" title="The filename where to dump the DB"></a>The filename where to dump the DB</h1><p>dbfilename dump.rdb</p>
<h1 id="The-working-directory"><a href="#The-working-directory" class="headerlink" title="The working directory."></a>The working directory.</h1><p>#</p>
<h1 id="The-DB-will-be-written-inside-this-directory-with-the-filename-specified"><a href="#The-DB-will-be-written-inside-this-directory-with-the-filename-specified" class="headerlink" title="The DB will be written inside this directory, with the filename specified"></a>The DB will be written inside this directory, with the filename specified</h1><h1 id="above-using-the-‘dbfilename’-configuration-directive"><a href="#above-using-the-‘dbfilename’-configuration-directive" class="headerlink" title="above using the ‘dbfilename’ configuration directive."></a>above using the ‘dbfilename’ configuration directive.</h1><p>#</p>
<h1 id="The-Append-Only-File-will-also-be-created-inside-this-directory"><a href="#The-Append-Only-File-will-also-be-created-inside-this-directory" class="headerlink" title="The Append Only File will also be created inside this directory."></a>The Append Only File will also be created inside this directory.</h1><p>#</p>
<h1 id="Note-that-you-must-specify-a-directory-here-not-a-file-name"><a href="#Note-that-you-must-specify-a-directory-here-not-a-file-name" class="headerlink" title="Note that you must specify a directory here, not a file name."></a>Note that you must specify a directory here, not a file name.</h1><p>dir ./</p>
<p>################################# REPLICATION #################################</p>
<h1 id="Master-Replica-replication-Use-replicaof-to-make-a-Redis-instance-a-copy-of"><a href="#Master-Replica-replication-Use-replicaof-to-make-a-Redis-instance-a-copy-of" class="headerlink" title="Master-Replica replication. Use replicaof to make a Redis instance a copy of"></a>Master-Replica replication. Use replicaof to make a Redis instance a copy of</h1><h1 id="another-Redis-server-A-few-things-to-understand-ASAP-about-Redis-replication"><a href="#another-Redis-server-A-few-things-to-understand-ASAP-about-Redis-replication" class="headerlink" title="another Redis server. A few things to understand ASAP about Redis replication."></a>another Redis server. A few things to understand ASAP about Redis replication.</h1><p>#</p>
<h1 id="——————-—————"><a href="#——————-—————" class="headerlink" title="+——————+      +—————+"></a>+——————+      +—————+</h1><h1 id="Master-—-gt-Replica"><a href="#Master-—-gt-Replica" class="headerlink" title="|      Master      | —&gt; |    Replica    |"></a>|      Master      | —&gt; |    Replica    |</h1><h1 id="receive-writes-exact-copy"><a href="#receive-writes-exact-copy" class="headerlink" title="| (receive writes) |      |  (exact copy) |"></a>| (receive writes) |      |  (exact copy) |</h1><h1 id="——————-—————-1"><a href="#——————-—————-1" class="headerlink" title="+——————+      +—————+"></a>+——————+      +—————+</h1><p>#</p>
<h1 id="1-Redis-replication-is-asynchronous-but-you-can-configure-a-master-to"><a href="#1-Redis-replication-is-asynchronous-but-you-can-configure-a-master-to" class="headerlink" title="1) Redis replication is asynchronous, but you can configure a master to"></a>1) Redis replication is asynchronous, but you can configure a master to</h1><h1 id="stop-accepting-writes-if-it-appears-to-be-not-connected-with-at-least"><a href="#stop-accepting-writes-if-it-appears-to-be-not-connected-with-at-least" class="headerlink" title="stop accepting writes if it appears to be not connected with at least"></a>stop accepting writes if it appears to be not connected with at least</h1><h1 id="a-given-number-of-replicas"><a href="#a-given-number-of-replicas" class="headerlink" title="a given number of replicas."></a>a given number of replicas.</h1><h1 id="2-Redis-replicas-are-able-to-perform-a-partial-resynchronization-with-the"><a href="#2-Redis-replicas-are-able-to-perform-a-partial-resynchronization-with-the" class="headerlink" title="2) Redis replicas are able to perform a partial resynchronization with the"></a>2) Redis replicas are able to perform a partial resynchronization with the</h1><h1 id="master-if-the-replication-link-is-lost-for-a-relatively-small-amount-of"><a href="#master-if-the-replication-link-is-lost-for-a-relatively-small-amount-of" class="headerlink" title="master if the replication link is lost for a relatively small amount of"></a>master if the replication link is lost for a relatively small amount of</h1><h1 id="time-You-may-want-to-configure-the-replication-backlog-size-see-the-next"><a href="#time-You-may-want-to-configure-the-replication-backlog-size-see-the-next" class="headerlink" title="time. You may want to configure the replication backlog size (see the next"></a>time. You may want to configure the replication backlog size (see the next</h1><h1 id="sections-of-this-file-with-a-sensible-value-depending-on-your-needs"><a href="#sections-of-this-file-with-a-sensible-value-depending-on-your-needs" class="headerlink" title="sections of this file) with a sensible value depending on your needs."></a>sections of this file) with a sensible value depending on your needs.</h1><h1 id="3-Replication-is-automatic-and-does-not-need-user-intervention-After-a"><a href="#3-Replication-is-automatic-and-does-not-need-user-intervention-After-a" class="headerlink" title="3) Replication is automatic and does not need user intervention. After a"></a>3) Replication is automatic and does not need user intervention. After a</h1><h1 id="network-partition-replicas-automatically-try-to-reconnect-to-masters"><a href="#network-partition-replicas-automatically-try-to-reconnect-to-masters" class="headerlink" title="network partition replicas automatically try to reconnect to masters"></a>network partition replicas automatically try to reconnect to masters</h1><h1 id="and-resynchronize-with-them"><a href="#and-resynchronize-with-them" class="headerlink" title="and resynchronize with them."></a>and resynchronize with them.</h1><p>#</p>
<h1 id="replicaof"><a href="#replicaof" class="headerlink" title="replicaof  "></a>replicaof <masterip> <masterport></masterport></masterip></h1><h1 id="If-the-master-is-password-protected-using-the-“requirepass”-configuration"><a href="#If-the-master-is-password-protected-using-the-“requirepass”-configuration" class="headerlink" title="If the master is password protected (using the “requirepass” configuration"></a>If the master is password protected (using the “requirepass” configuration</h1><h1 id="directive-below-it-is-possible-to-tell-the-replica-to-authenticate-before"><a href="#directive-below-it-is-possible-to-tell-the-replica-to-authenticate-before" class="headerlink" title="directive below) it is possible to tell the replica to authenticate before"></a>directive below) it is possible to tell the replica to authenticate before</h1><h1 id="starting-the-replication-synchronization-process-otherwise-the-master-will"><a href="#starting-the-replication-synchronization-process-otherwise-the-master-will" class="headerlink" title="starting the replication synchronization process, otherwise the master will"></a>starting the replication synchronization process, otherwise the master will</h1><h1 id="refuse-the-replica-request"><a href="#refuse-the-replica-request" class="headerlink" title="refuse the replica request."></a>refuse the replica request.</h1><p>#</p>
<h1 id="masterauth"><a href="#masterauth" class="headerlink" title="masterauth "></a>masterauth <master-password></master-password></h1><h1 id="When-a-replica-loses-its-connection-with-the-master-or-when-the-replication"><a href="#When-a-replica-loses-its-connection-with-the-master-or-when-the-replication" class="headerlink" title="When a replica loses its connection with the master, or when the replication"></a>When a replica loses its connection with the master, or when the replication</h1><h1 id="is-still-in-progress-the-replica-can-act-in-two-different-ways"><a href="#is-still-in-progress-the-replica-can-act-in-two-different-ways" class="headerlink" title="is still in progress, the replica can act in two different ways:"></a>is still in progress, the replica can act in two different ways:</h1><p>#</p>
<h1 id="1-if-replica-serve-stale-data-is-set-to-‘yes’-the-default-the-replica-will"><a href="#1-if-replica-serve-stale-data-is-set-to-‘yes’-the-default-the-replica-will" class="headerlink" title="1) if replica-serve-stale-data is set to ‘yes’ (the default) the replica will"></a>1) if replica-serve-stale-data is set to ‘yes’ (the default) the replica will</h1><h1 id="still-reply-to-client-requests-possibly-with-out-of-date-data-or-the"><a href="#still-reply-to-client-requests-possibly-with-out-of-date-data-or-the" class="headerlink" title="still reply to client requests, possibly with out of date data, or the"></a>still reply to client requests, possibly with out of date data, or the</h1><h1 id="data-set-may-just-be-empty-if-this-is-the-first-synchronization"><a href="#data-set-may-just-be-empty-if-this-is-the-first-synchronization" class="headerlink" title="data set may just be empty if this is the first synchronization."></a>data set may just be empty if this is the first synchronization.</h1><p>#</p>
<h1 id="2-if-replica-serve-stale-data-is-set-to-‘no’-the-replica-will-reply-with"><a href="#2-if-replica-serve-stale-data-is-set-to-‘no’-the-replica-will-reply-with" class="headerlink" title="2) if replica-serve-stale-data is set to ‘no’ the replica will reply with"></a>2) if replica-serve-stale-data is set to ‘no’ the replica will reply with</h1><h1 id="an-error-“SYNC-with-master-in-progress”-to-all-the-kind-of-commands"><a href="#an-error-“SYNC-with-master-in-progress”-to-all-the-kind-of-commands" class="headerlink" title="an error “SYNC with master in progress” to all the kind of commands"></a>an error “SYNC with master in progress” to all the kind of commands</h1><h1 id="but-to-INFO-replicaOF-AUTH-PING-SHUTDOWN-REPLCONF-ROLE-CONFIG"><a href="#but-to-INFO-replicaOF-AUTH-PING-SHUTDOWN-REPLCONF-ROLE-CONFIG" class="headerlink" title="but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,"></a>but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</h1><h1 id="SUBSCRIBE-UNSUBSCRIBE-PSUBSCRIBE-PUNSUBSCRIBE-PUBLISH-PUBSUB"><a href="#SUBSCRIBE-UNSUBSCRIBE-PSUBSCRIBE-PUNSUBSCRIBE-PUBLISH-PUBSUB" class="headerlink" title="SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,"></a>SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</h1><h1 id="COMMAND-POST-HOST-and-LATENCY"><a href="#COMMAND-POST-HOST-and-LATENCY" class="headerlink" title="COMMAND, POST, HOST: and LATENCY."></a>COMMAND, POST, HOST: and LATENCY.</h1><p>#<br>replica-serve-stale-data yes</p>
<h1 id="You-can-configure-a-replica-instance-to-accept-writes-or-not-Writing-against"><a href="#You-can-configure-a-replica-instance-to-accept-writes-or-not-Writing-against" class="headerlink" title="You can configure a replica instance to accept writes or not. Writing against"></a>You can configure a replica instance to accept writes or not. Writing against</h1><h1 id="a-replica-instance-may-be-useful-to-store-some-ephemeral-data-because-data"><a href="#a-replica-instance-may-be-useful-to-store-some-ephemeral-data-because-data" class="headerlink" title="a replica instance may be useful to store some ephemeral data (because data"></a>a replica instance may be useful to store some ephemeral data (because data</h1><h1 id="written-on-a-replica-will-be-easily-deleted-after-resync-with-the-master-but"><a href="#written-on-a-replica-will-be-easily-deleted-after-resync-with-the-master-but" class="headerlink" title="written on a replica will be easily deleted after resync with the master) but"></a>written on a replica will be easily deleted after resync with the master) but</h1><h1 id="may-also-cause-problems-if-clients-are-writing-to-it-because-of-a"><a href="#may-also-cause-problems-if-clients-are-writing-to-it-because-of-a" class="headerlink" title="may also cause problems if clients are writing to it because of a"></a>may also cause problems if clients are writing to it because of a</h1><h1 id="misconfiguration"><a href="#misconfiguration" class="headerlink" title="misconfiguration."></a>misconfiguration.</h1><p>#</p>
<h1 id="Since-Redis-2-6-by-default-replicas-are-read-only"><a href="#Since-Redis-2-6-by-default-replicas-are-read-only" class="headerlink" title="Since Redis 2.6 by default replicas are read-only."></a>Since Redis 2.6 by default replicas are read-only.</h1><p>#</p>
<h1 id="Note-read-only-replicas-are-not-designed-to-be-exposed-to-untrusted-clients"><a href="#Note-read-only-replicas-are-not-designed-to-be-exposed-to-untrusted-clients" class="headerlink" title="Note: read only replicas are not designed to be exposed to untrusted clients"></a>Note: read only replicas are not designed to be exposed to untrusted clients</h1><h1 id="on-the-internet-It’s-just-a-protection-layer-against-misuse-of-the-instance"><a href="#on-the-internet-It’s-just-a-protection-layer-against-misuse-of-the-instance" class="headerlink" title="on the internet. It’s just a protection layer against misuse of the instance."></a>on the internet. It’s just a protection layer against misuse of the instance.</h1><h1 id="Still-a-read-only-replica-exports-by-default-all-the-administrative-commands"><a href="#Still-a-read-only-replica-exports-by-default-all-the-administrative-commands" class="headerlink" title="Still a read only replica exports by default all the administrative commands"></a>Still a read only replica exports by default all the administrative commands</h1><h1 id="such-as-CONFIG-DEBUG-and-so-forth-To-a-limited-extent-you-can-improve"><a href="#such-as-CONFIG-DEBUG-and-so-forth-To-a-limited-extent-you-can-improve" class="headerlink" title="such as CONFIG, DEBUG, and so forth. To a limited extent you can improve"></a>such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</h1><h1 id="security-of-read-only-replicas-using-‘rename-command’-to-shadow-all-the"><a href="#security-of-read-only-replicas-using-‘rename-command’-to-shadow-all-the" class="headerlink" title="security of read only replicas using ‘rename-command’ to shadow all the"></a>security of read only replicas using ‘rename-command’ to shadow all the</h1><h1 id="administrative-dangerous-commands"><a href="#administrative-dangerous-commands" class="headerlink" title="administrative / dangerous commands."></a>administrative / dangerous commands.</h1><p>replica-read-only yes</p>
<h1 id="Replication-SYNC-strategy-disk-or-socket"><a href="#Replication-SYNC-strategy-disk-or-socket" class="headerlink" title="Replication SYNC strategy: disk or socket."></a>Replication SYNC strategy: disk or socket.</h1><p>#</p>
<h1 id="——————————————————"><a href="#——————————————————" class="headerlink" title="——————————————————-"></a>——————————————————-</h1><h1 id="WARNING-DISKLESS-REPLICATION-IS-EXPERIMENTAL-CURRENTLY"><a href="#WARNING-DISKLESS-REPLICATION-IS-EXPERIMENTAL-CURRENTLY" class="headerlink" title="WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY"></a>WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</h1><h1 id="——————————————————-1"><a href="#——————————————————-1" class="headerlink" title="——————————————————-"></a>——————————————————-</h1><p>#</p>
<h1 id="New-replicas-and-reconnecting-replicas-that-are-not-able-to-continue-the-replication"><a href="#New-replicas-and-reconnecting-replicas-that-are-not-able-to-continue-the-replication" class="headerlink" title="New replicas and reconnecting replicas that are not able to continue the replication"></a>New replicas and reconnecting replicas that are not able to continue the replication</h1><h1 id="process-just-receiving-differences-need-to-do-what-is-called-a-“full"><a href="#process-just-receiving-differences-need-to-do-what-is-called-a-“full" class="headerlink" title="process just receiving differences, need to do what is called a “full"></a>process just receiving differences, need to do what is called a “full</h1><h1 id="synchronization”-An-RDB-file-is-transmitted-from-the-master-to-the-replicas"><a href="#synchronization”-An-RDB-file-is-transmitted-from-the-master-to-the-replicas" class="headerlink" title="synchronization”. An RDB file is transmitted from the master to the replicas."></a>synchronization”. An RDB file is transmitted from the master to the replicas.</h1><h1 id="The-transmission-can-happen-in-two-different-ways"><a href="#The-transmission-can-happen-in-two-different-ways" class="headerlink" title="The transmission can happen in two different ways:"></a>The transmission can happen in two different ways:</h1><p>#</p>
<h1 id="1-Disk-backed-The-Redis-master-creates-a-new-process-that-writes-the-RDB"><a href="#1-Disk-backed-The-Redis-master-creates-a-new-process-that-writes-the-RDB" class="headerlink" title="1) Disk-backed: The Redis master creates a new process that writes the RDB"></a>1) Disk-backed: The Redis master creates a new process that writes the RDB</h1><h1 id="file-on-disk-Later-the-file-is-transferred-by-the-parent"><a href="#file-on-disk-Later-the-file-is-transferred-by-the-parent" class="headerlink" title="file on disk. Later the file is transferred by the parent"></a>file on disk. Later the file is transferred by the parent</h1><h1 id="process-to-the-replicas-incrementally"><a href="#process-to-the-replicas-incrementally" class="headerlink" title="process to the replicas incrementally."></a>process to the replicas incrementally.</h1><h1 id="2-Diskless-The-Redis-master-creates-a-new-process-that-directly-writes-the"><a href="#2-Diskless-The-Redis-master-creates-a-new-process-that-directly-writes-the" class="headerlink" title="2) Diskless: The Redis master creates a new process that directly writes the"></a>2) Diskless: The Redis master creates a new process that directly writes the</h1><h1 id="RDB-file-to-replica-sockets-without-touching-the-disk-at-all"><a href="#RDB-file-to-replica-sockets-without-touching-the-disk-at-all" class="headerlink" title="RDB file to replica sockets, without touching the disk at all."></a>RDB file to replica sockets, without touching the disk at all.</h1><p>#</p>
<h1 id="With-disk-backed-replication-while-the-RDB-file-is-generated-more-replicas"><a href="#With-disk-backed-replication-while-the-RDB-file-is-generated-more-replicas" class="headerlink" title="With disk-backed replication, while the RDB file is generated, more replicas"></a>With disk-backed replication, while the RDB file is generated, more replicas</h1><h1 id="can-be-queued-and-served-with-the-RDB-file-as-soon-as-the-current-child-producing"><a href="#can-be-queued-and-served-with-the-RDB-file-as-soon-as-the-current-child-producing" class="headerlink" title="can be queued and served with the RDB file as soon as the current child producing"></a>can be queued and served with the RDB file as soon as the current child producing</h1><h1 id="the-RDB-file-finishes-its-work-With-diskless-replication-instead-once"><a href="#the-RDB-file-finishes-its-work-With-diskless-replication-instead-once" class="headerlink" title="the RDB file finishes its work. With diskless replication instead once"></a>the RDB file finishes its work. With diskless replication instead once</h1><h1 id="the-transfer-starts-new-replicas-arriving-will-be-queued-and-a-new-transfer"><a href="#the-transfer-starts-new-replicas-arriving-will-be-queued-and-a-new-transfer" class="headerlink" title="the transfer starts, new replicas arriving will be queued and a new transfer"></a>the transfer starts, new replicas arriving will be queued and a new transfer</h1><h1 id="will-start-when-the-current-one-terminates"><a href="#will-start-when-the-current-one-terminates" class="headerlink" title="will start when the current one terminates."></a>will start when the current one terminates.</h1><p>#</p>
<h1 id="When-diskless-replication-is-used-the-master-waits-a-configurable-amount-of"><a href="#When-diskless-replication-is-used-the-master-waits-a-configurable-amount-of" class="headerlink" title="When diskless replication is used, the master waits a configurable amount of"></a>When diskless replication is used, the master waits a configurable amount of</h1><h1 id="time-in-seconds-before-starting-the-transfer-in-the-hope-that-multiple-replicas"><a href="#time-in-seconds-before-starting-the-transfer-in-the-hope-that-multiple-replicas" class="headerlink" title="time (in seconds) before starting the transfer in the hope that multiple replicas"></a>time (in seconds) before starting the transfer in the hope that multiple replicas</h1><h1 id="will-arrive-and-the-transfer-can-be-parallelized"><a href="#will-arrive-and-the-transfer-can-be-parallelized" class="headerlink" title="will arrive and the transfer can be parallelized."></a>will arrive and the transfer can be parallelized.</h1><p>#</p>
<h1 id="With-slow-disks-and-fast-large-bandwidth-networks-diskless-replication"><a href="#With-slow-disks-and-fast-large-bandwidth-networks-diskless-replication" class="headerlink" title="With slow disks and fast (large bandwidth) networks, diskless replication"></a>With slow disks and fast (large bandwidth) networks, diskless replication</h1><h1 id="works-better"><a href="#works-better" class="headerlink" title="works better."></a>works better.</h1><p>repl-diskless-sync no</p>
<h1 id="When-diskless-replication-is-enabled-it-is-possible-to-configure-the-delay"><a href="#When-diskless-replication-is-enabled-it-is-possible-to-configure-the-delay" class="headerlink" title="When diskless replication is enabled, it is possible to configure the delay"></a>When diskless replication is enabled, it is possible to configure the delay</h1><h1 id="the-server-waits-in-order-to-spawn-the-child-that-transfers-the-RDB-via-socket"><a href="#the-server-waits-in-order-to-spawn-the-child-that-transfers-the-RDB-via-socket" class="headerlink" title="the server waits in order to spawn the child that transfers the RDB via socket"></a>the server waits in order to spawn the child that transfers the RDB via socket</h1><h1 id="to-the-replicas"><a href="#to-the-replicas" class="headerlink" title="to the replicas."></a>to the replicas.</h1><p>#</p>
<h1 id="This-is-important-since-once-the-transfer-starts-it-is-not-possible-to-serve"><a href="#This-is-important-since-once-the-transfer-starts-it-is-not-possible-to-serve" class="headerlink" title="This is important since once the transfer starts, it is not possible to serve"></a>This is important since once the transfer starts, it is not possible to serve</h1><h1 id="new-replicas-arriving-that-will-be-queued-for-the-next-RDB-transfer-so-the-server"><a href="#new-replicas-arriving-that-will-be-queued-for-the-next-RDB-transfer-so-the-server" class="headerlink" title="new replicas arriving, that will be queued for the next RDB transfer, so the server"></a>new replicas arriving, that will be queued for the next RDB transfer, so the server</h1><h1 id="waits-a-delay-in-order-to-let-more-replicas-arrive"><a href="#waits-a-delay-in-order-to-let-more-replicas-arrive" class="headerlink" title="waits a delay in order to let more replicas arrive."></a>waits a delay in order to let more replicas arrive.</h1><p>#</p>
<h1 id="The-delay-is-specified-in-seconds-and-by-default-is-5-seconds-To-disable"><a href="#The-delay-is-specified-in-seconds-and-by-default-is-5-seconds-To-disable" class="headerlink" title="The delay is specified in seconds, and by default is 5 seconds. To disable"></a>The delay is specified in seconds, and by default is 5 seconds. To disable</h1><h1 id="it-entirely-just-set-it-to-0-seconds-and-the-transfer-will-start-ASAP"><a href="#it-entirely-just-set-it-to-0-seconds-and-the-transfer-will-start-ASAP" class="headerlink" title="it entirely just set it to 0 seconds and the transfer will start ASAP."></a>it entirely just set it to 0 seconds and the transfer will start ASAP.</h1><p>repl-diskless-sync-delay 5</p>
<h1 id="Replicas-send-PINGs-to-server-in-a-predefined-interval-It’s-possible-to-change"><a href="#Replicas-send-PINGs-to-server-in-a-predefined-interval-It’s-possible-to-change" class="headerlink" title="Replicas send PINGs to server in a predefined interval. It’s possible to change"></a>Replicas send PINGs to server in a predefined interval. It’s possible to change</h1><h1 id="this-interval-with-the-repl-ping-replica-period-option-The-default-value-is-10"><a href="#this-interval-with-the-repl-ping-replica-period-option-The-default-value-is-10" class="headerlink" title="this interval with the repl_ping_replica_period option. The default value is 10"></a>this interval with the repl_ping_replica_period option. The default value is 10</h1><h1 id="seconds"><a href="#seconds" class="headerlink" title="seconds."></a>seconds.</h1><p>#</p>
<h1 id="repl-ping-replica-period-10"><a href="#repl-ping-replica-period-10" class="headerlink" title="repl-ping-replica-period 10"></a>repl-ping-replica-period 10</h1><h1 id="The-following-option-sets-the-replication-timeout-for"><a href="#The-following-option-sets-the-replication-timeout-for" class="headerlink" title="The following option sets the replication timeout for:"></a>The following option sets the replication timeout for:</h1><p>#</p>
<h1 id="1-Bulk-transfer-I-O-during-SYNC-from-the-point-of-view-of-replica"><a href="#1-Bulk-transfer-I-O-during-SYNC-from-the-point-of-view-of-replica" class="headerlink" title="1) Bulk transfer I/O during SYNC, from the point of view of replica."></a>1) Bulk transfer I/O during SYNC, from the point of view of replica.</h1><h1 id="2-Master-timeout-from-the-point-of-view-of-replicas-data-pings"><a href="#2-Master-timeout-from-the-point-of-view-of-replicas-data-pings" class="headerlink" title="2) Master timeout from the point of view of replicas (data, pings)."></a>2) Master timeout from the point of view of replicas (data, pings).</h1><h1 id="3-Replica-timeout-from-the-point-of-view-of-masters-REPLCONF-ACK-pings"><a href="#3-Replica-timeout-from-the-point-of-view-of-masters-REPLCONF-ACK-pings" class="headerlink" title="3) Replica timeout from the point of view of masters (REPLCONF ACK pings)."></a>3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</h1><p>#</p>
<h1 id="It-is-important-to-make-sure-that-this-value-is-greater-than-the-value"><a href="#It-is-important-to-make-sure-that-this-value-is-greater-than-the-value" class="headerlink" title="It is important to make sure that this value is greater than the value"></a>It is important to make sure that this value is greater than the value</h1><h1 id="specified-for-repl-ping-replica-period-otherwise-a-timeout-will-be-detected"><a href="#specified-for-repl-ping-replica-period-otherwise-a-timeout-will-be-detected" class="headerlink" title="specified for repl-ping-replica-period otherwise a timeout will be detected"></a>specified for repl-ping-replica-period otherwise a timeout will be detected</h1><h1 id="every-time-there-is-low-traffic-between-the-master-and-the-replica"><a href="#every-time-there-is-low-traffic-between-the-master-and-the-replica" class="headerlink" title="every time there is low traffic between the master and the replica."></a>every time there is low traffic between the master and the replica.</h1><p>#</p>
<h1 id="repl-timeout-60"><a href="#repl-timeout-60" class="headerlink" title="repl-timeout 60"></a>repl-timeout 60</h1><h1 id="Disable-TCP-NODELAY-on-the-replica-socket-after-SYNC"><a href="#Disable-TCP-NODELAY-on-the-replica-socket-after-SYNC" class="headerlink" title="Disable TCP_NODELAY on the replica socket after SYNC?"></a>Disable TCP_NODELAY on the replica socket after SYNC?</h1><p>#</p>
<h1 id="If-you-select-“yes”-Redis-will-use-a-smaller-number-of-TCP-packets-and"><a href="#If-you-select-“yes”-Redis-will-use-a-smaller-number-of-TCP-packets-and" class="headerlink" title="If you select “yes” Redis will use a smaller number of TCP packets and"></a>If you select “yes” Redis will use a smaller number of TCP packets and</h1><h1 id="less-bandwidth-to-send-data-to-replicas-But-this-can-add-a-delay-for"><a href="#less-bandwidth-to-send-data-to-replicas-But-this-can-add-a-delay-for" class="headerlink" title="less bandwidth to send data to replicas. But this can add a delay for"></a>less bandwidth to send data to replicas. But this can add a delay for</h1><h1 id="the-data-to-appear-on-the-replica-side-up-to-40-milliseconds-with"><a href="#the-data-to-appear-on-the-replica-side-up-to-40-milliseconds-with" class="headerlink" title="the data to appear on the replica side, up to 40 milliseconds with"></a>the data to appear on the replica side, up to 40 milliseconds with</h1><h1 id="Linux-kernels-using-a-default-configuration"><a href="#Linux-kernels-using-a-default-configuration" class="headerlink" title="Linux kernels using a default configuration."></a>Linux kernels using a default configuration.</h1><p>#</p>
<h1 id="If-you-select-“no”-the-delay-for-data-to-appear-on-the-replica-side-will"><a href="#If-you-select-“no”-the-delay-for-data-to-appear-on-the-replica-side-will" class="headerlink" title="If you select “no” the delay for data to appear on the replica side will"></a>If you select “no” the delay for data to appear on the replica side will</h1><h1 id="be-reduced-but-more-bandwidth-will-be-used-for-replication"><a href="#be-reduced-but-more-bandwidth-will-be-used-for-replication" class="headerlink" title="be reduced but more bandwidth will be used for replication."></a>be reduced but more bandwidth will be used for replication.</h1><p>#</p>
<h1 id="By-default-we-optimize-for-low-latency-but-in-very-high-traffic-conditions"><a href="#By-default-we-optimize-for-low-latency-but-in-very-high-traffic-conditions" class="headerlink" title="By default we optimize for low latency, but in very high traffic conditions"></a>By default we optimize for low latency, but in very high traffic conditions</h1><h1 id="or-when-the-master-and-replicas-are-many-hops-away-turning-this-to-“yes”-may"><a href="#or-when-the-master-and-replicas-are-many-hops-away-turning-this-to-“yes”-may" class="headerlink" title="or when the master and replicas are many hops away, turning this to “yes” may"></a>or when the master and replicas are many hops away, turning this to “yes” may</h1><h1 id="be-a-good-idea"><a href="#be-a-good-idea" class="headerlink" title="be a good idea."></a>be a good idea.</h1><p>repl-disable-tcp-nodelay no</p>
<h1 id="Set-the-replication-backlog-size-The-backlog-is-a-buffer-that-accumulates"><a href="#Set-the-replication-backlog-size-The-backlog-is-a-buffer-that-accumulates" class="headerlink" title="Set the replication backlog size. The backlog is a buffer that accumulates"></a>Set the replication backlog size. The backlog is a buffer that accumulates</h1><h1 id="replica-data-when-replicas-are-disconnected-for-some-time-so-that-when-a-replica"><a href="#replica-data-when-replicas-are-disconnected-for-some-time-so-that-when-a-replica" class="headerlink" title="replica data when replicas are disconnected for some time, so that when a replica"></a>replica data when replicas are disconnected for some time, so that when a replica</h1><h1 id="wants-to-reconnect-again-often-a-full-resync-is-not-needed-but-a-partial"><a href="#wants-to-reconnect-again-often-a-full-resync-is-not-needed-but-a-partial" class="headerlink" title="wants to reconnect again, often a full resync is not needed, but a partial"></a>wants to reconnect again, often a full resync is not needed, but a partial</h1><h1 id="resync-is-enough-just-passing-the-portion-of-data-the-replica-missed-while"><a href="#resync-is-enough-just-passing-the-portion-of-data-the-replica-missed-while" class="headerlink" title="resync is enough, just passing the portion of data the replica missed while"></a>resync is enough, just passing the portion of data the replica missed while</h1><h1 id="disconnected"><a href="#disconnected" class="headerlink" title="disconnected."></a>disconnected.</h1><p>#</p>
<h1 id="The-bigger-the-replication-backlog-the-longer-the-time-the-replica-can-be"><a href="#The-bigger-the-replication-backlog-the-longer-the-time-the-replica-can-be" class="headerlink" title="The bigger the replication backlog, the longer the time the replica can be"></a>The bigger the replication backlog, the longer the time the replica can be</h1><h1 id="disconnected-and-later-be-able-to-perform-a-partial-resynchronization"><a href="#disconnected-and-later-be-able-to-perform-a-partial-resynchronization" class="headerlink" title="disconnected and later be able to perform a partial resynchronization."></a>disconnected and later be able to perform a partial resynchronization.</h1><p>#</p>
<h1 id="The-backlog-is-only-allocated-once-there-is-at-least-a-replica-connected"><a href="#The-backlog-is-only-allocated-once-there-is-at-least-a-replica-connected" class="headerlink" title="The backlog is only allocated once there is at least a replica connected."></a>The backlog is only allocated once there is at least a replica connected.</h1><p>#</p>
<h1 id="repl-backlog-size-1mb"><a href="#repl-backlog-size-1mb" class="headerlink" title="repl-backlog-size 1mb"></a>repl-backlog-size 1mb</h1><h1 id="After-a-master-has-no-longer-connected-replicas-for-some-time-the-backlog"><a href="#After-a-master-has-no-longer-connected-replicas-for-some-time-the-backlog" class="headerlink" title="After a master has no longer connected replicas for some time, the backlog"></a>After a master has no longer connected replicas for some time, the backlog</h1><h1 id="will-be-freed-The-following-option-configures-the-amount-of-seconds-that"><a href="#will-be-freed-The-following-option-configures-the-amount-of-seconds-that" class="headerlink" title="will be freed. The following option configures the amount of seconds that"></a>will be freed. The following option configures the amount of seconds that</h1><h1 id="need-to-elapse-starting-from-the-time-the-last-replica-disconnected-for"><a href="#need-to-elapse-starting-from-the-time-the-last-replica-disconnected-for" class="headerlink" title="need to elapse, starting from the time the last replica disconnected, for"></a>need to elapse, starting from the time the last replica disconnected, for</h1><h1 id="the-backlog-buffer-to-be-freed"><a href="#the-backlog-buffer-to-be-freed" class="headerlink" title="the backlog buffer to be freed."></a>the backlog buffer to be freed.</h1><p>#</p>
<h1 id="Note-that-replicas-never-free-the-backlog-for-timeout-since-they-may-be"><a href="#Note-that-replicas-never-free-the-backlog-for-timeout-since-they-may-be" class="headerlink" title="Note that replicas never free the backlog for timeout, since they may be"></a>Note that replicas never free the backlog for timeout, since they may be</h1><h1 id="promoted-to-masters-later-and-should-be-able-to-correctly-“partially"><a href="#promoted-to-masters-later-and-should-be-able-to-correctly-“partially" class="headerlink" title="promoted to masters later, and should be able to correctly “partially"></a>promoted to masters later, and should be able to correctly “partially</h1><h1 id="resynchronize”-with-the-replicas-hence-they-should-always-accumulate-backlog"><a href="#resynchronize”-with-the-replicas-hence-they-should-always-accumulate-backlog" class="headerlink" title="resynchronize” with the replicas: hence they should always accumulate backlog."></a>resynchronize” with the replicas: hence they should always accumulate backlog.</h1><p>#</p>
<h1 id="A-value-of-0-means-to-never-release-the-backlog"><a href="#A-value-of-0-means-to-never-release-the-backlog" class="headerlink" title="A value of 0 means to never release the backlog."></a>A value of 0 means to never release the backlog.</h1><p>#</p>
<h1 id="repl-backlog-ttl-3600"><a href="#repl-backlog-ttl-3600" class="headerlink" title="repl-backlog-ttl 3600"></a>repl-backlog-ttl 3600</h1><h1 id="The-replica-priority-is-an-integer-number-published-by-Redis-in-the-INFO-output"><a href="#The-replica-priority-is-an-integer-number-published-by-Redis-in-the-INFO-output" class="headerlink" title="The replica priority is an integer number published by Redis in the INFO output."></a>The replica priority is an integer number published by Redis in the INFO output.</h1><h1 id="It-is-used-by-Redis-Sentinel-in-order-to-select-a-replica-to-promote-into-a"><a href="#It-is-used-by-Redis-Sentinel-in-order-to-select-a-replica-to-promote-into-a" class="headerlink" title="It is used by Redis Sentinel in order to select a replica to promote into a"></a>It is used by Redis Sentinel in order to select a replica to promote into a</h1><h1 id="master-if-the-master-is-no-longer-working-correctly"><a href="#master-if-the-master-is-no-longer-working-correctly" class="headerlink" title="master if the master is no longer working correctly."></a>master if the master is no longer working correctly.</h1><p>#</p>
<h1 id="A-replica-with-a-low-priority-number-is-considered-better-for-promotion-so"><a href="#A-replica-with-a-low-priority-number-is-considered-better-for-promotion-so" class="headerlink" title="A replica with a low priority number is considered better for promotion, so"></a>A replica with a low priority number is considered better for promotion, so</h1><h1 id="for-instance-if-there-are-three-replicas-with-priority-10-100-25-Sentinel-will"><a href="#for-instance-if-there-are-three-replicas-with-priority-10-100-25-Sentinel-will" class="headerlink" title="for instance if there are three replicas with priority 10, 100, 25 Sentinel will"></a>for instance if there are three replicas with priority 10, 100, 25 Sentinel will</h1><h1 id="pick-the-one-with-priority-10-that-is-the-lowest"><a href="#pick-the-one-with-priority-10-that-is-the-lowest" class="headerlink" title="pick the one with priority 10, that is the lowest."></a>pick the one with priority 10, that is the lowest.</h1><p>#</p>
<h1 id="However-a-special-priority-of-0-marks-the-replica-as-not-able-to-perform-the"><a href="#However-a-special-priority-of-0-marks-the-replica-as-not-able-to-perform-the" class="headerlink" title="However a special priority of 0 marks the replica as not able to perform the"></a>However a special priority of 0 marks the replica as not able to perform the</h1><h1 id="role-of-master-so-a-replica-with-priority-of-0-will-never-be-selected-by"><a href="#role-of-master-so-a-replica-with-priority-of-0-will-never-be-selected-by" class="headerlink" title="role of master, so a replica with priority of 0 will never be selected by"></a>role of master, so a replica with priority of 0 will never be selected by</h1><h1 id="Redis-Sentinel-for-promotion"><a href="#Redis-Sentinel-for-promotion" class="headerlink" title="Redis Sentinel for promotion."></a>Redis Sentinel for promotion.</h1><p>#</p>
<h1 id="By-default-the-priority-is-100"><a href="#By-default-the-priority-is-100" class="headerlink" title="By default the priority is 100."></a>By default the priority is 100.</h1><p>replica-priority 100</p>
<h1 id="It-is-possible-for-a-master-to-stop-accepting-writes-if-there-are-less-than"><a href="#It-is-possible-for-a-master-to-stop-accepting-writes-if-there-are-less-than" class="headerlink" title="It is possible for a master to stop accepting writes if there are less than"></a>It is possible for a master to stop accepting writes if there are less than</h1><h1 id="N-replicas-connected-having-a-lag-less-or-equal-than-M-seconds"><a href="#N-replicas-connected-having-a-lag-less-or-equal-than-M-seconds" class="headerlink" title="N replicas connected, having a lag less or equal than M seconds."></a>N replicas connected, having a lag less or equal than M seconds.</h1><p>#</p>
<h1 id="The-N-replicas-need-to-be-in-“online”-state"><a href="#The-N-replicas-need-to-be-in-“online”-state" class="headerlink" title="The N replicas need to be in “online” state."></a>The N replicas need to be in “online” state.</h1><p>#</p>
<h1 id="The-lag-in-seconds-that-must-be-lt-the-specified-value-is-calculated-from"><a href="#The-lag-in-seconds-that-must-be-lt-the-specified-value-is-calculated-from" class="headerlink" title="The lag in seconds, that must be &lt;= the specified value, is calculated from"></a>The lag in seconds, that must be &lt;= the specified value, is calculated from</h1><h1 id="the-last-ping-received-from-the-replica-that-is-usually-sent-every-second"><a href="#the-last-ping-received-from-the-replica-that-is-usually-sent-every-second" class="headerlink" title="the last ping received from the replica, that is usually sent every second."></a>the last ping received from the replica, that is usually sent every second.</h1><p>#</p>
<h1 id="This-option-does-not-GUARANTEE-that-N-replicas-will-accept-the-write-but"><a href="#This-option-does-not-GUARANTEE-that-N-replicas-will-accept-the-write-but" class="headerlink" title="This option does not GUARANTEE that N replicas will accept the write, but"></a>This option does not GUARANTEE that N replicas will accept the write, but</h1><h1 id="will-limit-the-window-of-exposure-for-lost-writes-in-case-not-enough-replicas"><a href="#will-limit-the-window-of-exposure-for-lost-writes-in-case-not-enough-replicas" class="headerlink" title="will limit the window of exposure for lost writes in case not enough replicas"></a>will limit the window of exposure for lost writes in case not enough replicas</h1><h1 id="are-available-to-the-specified-number-of-seconds"><a href="#are-available-to-the-specified-number-of-seconds" class="headerlink" title="are available, to the specified number of seconds."></a>are available, to the specified number of seconds.</h1><p>#</p>
<h1 id="For-example-to-require-at-least-3-replicas-with-a-lag-lt-10-seconds-use"><a href="#For-example-to-require-at-least-3-replicas-with-a-lag-lt-10-seconds-use" class="headerlink" title="For example to require at least 3 replicas with a lag &lt;= 10 seconds use:"></a>For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</h1><p>#</p>
<h1 id="min-replicas-to-write-3"><a href="#min-replicas-to-write-3" class="headerlink" title="min-replicas-to-write 3"></a>min-replicas-to-write 3</h1><h1 id="min-replicas-max-lag-10"><a href="#min-replicas-max-lag-10" class="headerlink" title="min-replicas-max-lag 10"></a>min-replicas-max-lag 10</h1><p>#</p>
<h1 id="Setting-one-or-the-other-to-0-disables-the-feature"><a href="#Setting-one-or-the-other-to-0-disables-the-feature" class="headerlink" title="Setting one or the other to 0 disables the feature."></a>Setting one or the other to 0 disables the feature.</h1><p>#</p>
<h1 id="By-default-min-replicas-to-write-is-set-to-0-feature-disabled-and"><a href="#By-default-min-replicas-to-write-is-set-to-0-feature-disabled-and" class="headerlink" title="By default min-replicas-to-write is set to 0 (feature disabled) and"></a>By default min-replicas-to-write is set to 0 (feature disabled) and</h1><h1 id="min-replicas-max-lag-is-set-to-10"><a href="#min-replicas-max-lag-is-set-to-10" class="headerlink" title="min-replicas-max-lag is set to 10."></a>min-replicas-max-lag is set to 10.</h1><h1 id="A-Redis-master-is-able-to-list-the-address-and-port-of-the-attached"><a href="#A-Redis-master-is-able-to-list-the-address-and-port-of-the-attached" class="headerlink" title="A Redis master is able to list the address and port of the attached"></a>A Redis master is able to list the address and port of the attached</h1><h1 id="replicas-in-different-ways-For-example-the-“INFO-replication”-section"><a href="#replicas-in-different-ways-For-example-the-“INFO-replication”-section" class="headerlink" title="replicas in different ways. For example the “INFO replication” section"></a>replicas in different ways. For example the “INFO replication” section</h1><h1 id="offers-this-information-which-is-used-among-other-tools-by"><a href="#offers-this-information-which-is-used-among-other-tools-by" class="headerlink" title="offers this information, which is used, among other tools, by"></a>offers this information, which is used, among other tools, by</h1><h1 id="Redis-Sentinel-in-order-to-discover-replica-instances"><a href="#Redis-Sentinel-in-order-to-discover-replica-instances" class="headerlink" title="Redis Sentinel in order to discover replica instances."></a>Redis Sentinel in order to discover replica instances.</h1><h1 id="Another-place-where-this-info-is-available-is-in-the-output-of-the"><a href="#Another-place-where-this-info-is-available-is-in-the-output-of-the" class="headerlink" title="Another place where this info is available is in the output of the"></a>Another place where this info is available is in the output of the</h1><h1 id="“ROLE”-command-of-a-master"><a href="#“ROLE”-command-of-a-master" class="headerlink" title="“ROLE” command of a master."></a>“ROLE” command of a master.</h1><p>#</p>
<h1 id="The-listed-IP-and-address-normally-reported-by-a-replica-is-obtained"><a href="#The-listed-IP-and-address-normally-reported-by-a-replica-is-obtained" class="headerlink" title="The listed IP and address normally reported by a replica is obtained"></a>The listed IP and address normally reported by a replica is obtained</h1><h1 id="in-the-following-way"><a href="#in-the-following-way" class="headerlink" title="in the following way:"></a>in the following way:</h1><p>#</p>
<h1 id="IP-The-address-is-auto-detected-by-checking-the-peer-address"><a href="#IP-The-address-is-auto-detected-by-checking-the-peer-address" class="headerlink" title="IP: The address is auto detected by checking the peer address"></a>IP: The address is auto detected by checking the peer address</h1><h1 id="of-the-socket-used-by-the-replica-to-connect-with-the-master"><a href="#of-the-socket-used-by-the-replica-to-connect-with-the-master" class="headerlink" title="of the socket used by the replica to connect with the master."></a>of the socket used by the replica to connect with the master.</h1><p>#</p>
<h1 id="Port-The-port-is-communicated-by-the-replica-during-the-replication"><a href="#Port-The-port-is-communicated-by-the-replica-during-the-replication" class="headerlink" title="Port: The port is communicated by the replica during the replication"></a>Port: The port is communicated by the replica during the replication</h1><h1 id="handshake-and-is-normally-the-port-that-the-replica-is-using-to"><a href="#handshake-and-is-normally-the-port-that-the-replica-is-using-to" class="headerlink" title="handshake, and is normally the port that the replica is using to"></a>handshake, and is normally the port that the replica is using to</h1><h1 id="listen-for-connections"><a href="#listen-for-connections" class="headerlink" title="listen for connections."></a>listen for connections.</h1><p>#</p>
<h1 id="However-when-port-forwarding-or-Network-Address-Translation-NAT-is"><a href="#However-when-port-forwarding-or-Network-Address-Translation-NAT-is" class="headerlink" title="However when port forwarding or Network Address Translation (NAT) is"></a>However when port forwarding or Network Address Translation (NAT) is</h1><h1 id="used-the-replica-may-be-actually-reachable-via-different-IP-and-port"><a href="#used-the-replica-may-be-actually-reachable-via-different-IP-and-port" class="headerlink" title="used, the replica may be actually reachable via different IP and port"></a>used, the replica may be actually reachable via different IP and port</h1><h1 id="pairs-The-following-two-options-can-be-used-by-a-replica-in-order-to"><a href="#pairs-The-following-two-options-can-be-used-by-a-replica-in-order-to" class="headerlink" title="pairs. The following two options can be used by a replica in order to"></a>pairs. The following two options can be used by a replica in order to</h1><h1 id="report-to-its-master-a-specific-set-of-IP-and-port-so-that-both-INFO"><a href="#report-to-its-master-a-specific-set-of-IP-and-port-so-that-both-INFO" class="headerlink" title="report to its master a specific set of IP and port, so that both INFO"></a>report to its master a specific set of IP and port, so that both INFO</h1><h1 id="and-ROLE-will-report-those-values"><a href="#and-ROLE-will-report-those-values" class="headerlink" title="and ROLE will report those values."></a>and ROLE will report those values.</h1><p>#</p>
<h1 id="There-is-no-need-to-use-both-the-options-if-you-need-to-override-just"><a href="#There-is-no-need-to-use-both-the-options-if-you-need-to-override-just" class="headerlink" title="There is no need to use both the options if you need to override just"></a>There is no need to use both the options if you need to override just</h1><h1 id="the-port-or-the-IP-address"><a href="#the-port-or-the-IP-address" class="headerlink" title="the port or the IP address."></a>the port or the IP address.</h1><p>#</p>
<h1 id="replica-announce-ip-5-5-5-5"><a href="#replica-announce-ip-5-5-5-5" class="headerlink" title="replica-announce-ip 5.5.5.5"></a>replica-announce-ip 5.5.5.5</h1><h1 id="replica-announce-port-1234"><a href="#replica-announce-port-1234" class="headerlink" title="replica-announce-port 1234"></a>replica-announce-port 1234</h1><p>################################## SECURITY ###################################</p>
<h1 id="Require-clients-to-issue-AUTH-before-processing-any-other"><a href="#Require-clients-to-issue-AUTH-before-processing-any-other" class="headerlink" title="Require clients to issue AUTH  before processing any other"></a>Require clients to issue AUTH <password> before processing any other</password></h1><h1 id="commands-This-might-be-useful-in-environments-in-which-you-do-not-trust"><a href="#commands-This-might-be-useful-in-environments-in-which-you-do-not-trust" class="headerlink" title="commands.  This might be useful in environments in which you do not trust"></a>commands.  This might be useful in environments in which you do not trust</h1><h1 id="others-with-access-to-the-host-running-redis-server"><a href="#others-with-access-to-the-host-running-redis-server" class="headerlink" title="others with access to the host running redis-server."></a>others with access to the host running redis-server.</h1><p>#</p>
<h1 id="This-should-stay-commented-out-for-backward-compatibility-and-because-most"><a href="#This-should-stay-commented-out-for-backward-compatibility-and-because-most" class="headerlink" title="This should stay commented out for backward compatibility and because most"></a>This should stay commented out for backward compatibility and because most</h1><h1 id="people-do-not-need-auth-e-g-they-run-their-own-servers"><a href="#people-do-not-need-auth-e-g-they-run-their-own-servers" class="headerlink" title="people do not need auth (e.g. they run their own servers)."></a>people do not need auth (e.g. they run their own servers).</h1><p>#</p>
<h1 id="Warning-since-Redis-is-pretty-fast-an-outside-user-can-try-up-to"><a href="#Warning-since-Redis-is-pretty-fast-an-outside-user-can-try-up-to" class="headerlink" title="Warning: since Redis is pretty fast an outside user can try up to"></a>Warning: since Redis is pretty fast an outside user can try up to</h1><h1 id="150k-passwords-per-second-against-a-good-box-This-means-that-you-should"><a href="#150k-passwords-per-second-against-a-good-box-This-means-that-you-should" class="headerlink" title="150k passwords per second against a good box. This means that you should"></a>150k passwords per second against a good box. This means that you should</h1><h1 id="use-a-very-strong-password-otherwise-it-will-be-very-easy-to-break"><a href="#use-a-very-strong-password-otherwise-it-will-be-very-easy-to-break" class="headerlink" title="use a very strong password otherwise it will be very easy to break."></a>use a very strong password otherwise it will be very easy to break.</h1><p>#</p>
<h1 id="requirepass-foobared"><a href="#requirepass-foobared" class="headerlink" title="requirepass foobared"></a>requirepass foobared</h1><h1 id="Command-renaming"><a href="#Command-renaming" class="headerlink" title="Command renaming."></a>Command renaming.</h1><p>#</p>
<h1 id="It-is-possible-to-change-the-name-of-dangerous-commands-in-a-shared"><a href="#It-is-possible-to-change-the-name-of-dangerous-commands-in-a-shared" class="headerlink" title="It is possible to change the name of dangerous commands in a shared"></a>It is possible to change the name of dangerous commands in a shared</h1><h1 id="environment-For-instance-the-CONFIG-command-may-be-renamed-into-something"><a href="#environment-For-instance-the-CONFIG-command-may-be-renamed-into-something" class="headerlink" title="environment. For instance the CONFIG command may be renamed into something"></a>environment. For instance the CONFIG command may be renamed into something</h1><h1 id="hard-to-guess-so-that-it-will-still-be-available-for-internal-use-tools"><a href="#hard-to-guess-so-that-it-will-still-be-available-for-internal-use-tools" class="headerlink" title="hard to guess so that it will still be available for internal-use tools"></a>hard to guess so that it will still be available for internal-use tools</h1><h1 id="but-not-available-for-general-clients"><a href="#but-not-available-for-general-clients" class="headerlink" title="but not available for general clients."></a>but not available for general clients.</h1><p>#</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h1><p>#</p>
<h1 id="rename-command-CONFIG-b840fc02d524045429941cc15f59e41cb7be6c52"><a href="#rename-command-CONFIG-b840fc02d524045429941cc15f59e41cb7be6c52" class="headerlink" title="rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52"></a>rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</h1><p>#</p>
<h1 id="It-is-also-possible-to-completely-kill-a-command-by-renaming-it-into"><a href="#It-is-also-possible-to-completely-kill-a-command-by-renaming-it-into" class="headerlink" title="It is also possible to completely kill a command by renaming it into"></a>It is also possible to completely kill a command by renaming it into</h1><h1 id="an-empty-string"><a href="#an-empty-string" class="headerlink" title="an empty string:"></a>an empty string:</h1><p>#</p>
<h1 id="rename-command-CONFIG-“”"><a href="#rename-command-CONFIG-“”" class="headerlink" title="rename-command CONFIG “”"></a>rename-command CONFIG “”</h1><p>#</p>
<h1 id="Please-note-that-changing-the-name-of-commands-that-are-logged-into-the"><a href="#Please-note-that-changing-the-name-of-commands-that-are-logged-into-the" class="headerlink" title="Please note that changing the name of commands that are logged into the"></a>Please note that changing the name of commands that are logged into the</h1><h1 id="AOF-file-or-transmitted-to-replicas-may-cause-problems"><a href="#AOF-file-or-transmitted-to-replicas-may-cause-problems" class="headerlink" title="AOF file or transmitted to replicas may cause problems."></a>AOF file or transmitted to replicas may cause problems.</h1><p>################################### CLIENTS ####################################</p>
<h1 id="Set-the-max-number-of-connected-clients-at-the-same-time-By-default"><a href="#Set-the-max-number-of-connected-clients-at-the-same-time-By-default" class="headerlink" title="Set the max number of connected clients at the same time. By default"></a>Set the max number of connected clients at the same time. By default</h1><h1 id="this-limit-is-set-to-10000-clients-however-if-the-Redis-server-is-not"><a href="#this-limit-is-set-to-10000-clients-however-if-the-Redis-server-is-not" class="headerlink" title="this limit is set to 10000 clients, however if the Redis server is not"></a>this limit is set to 10000 clients, however if the Redis server is not</h1><h1 id="able-to-configure-the-process-file-limit-to-allow-for-the-specified-limit"><a href="#able-to-configure-the-process-file-limit-to-allow-for-the-specified-limit" class="headerlink" title="able to configure the process file limit to allow for the specified limit"></a>able to configure the process file limit to allow for the specified limit</h1><h1 id="the-max-number-of-allowed-clients-is-set-to-the-current-file-limit"><a href="#the-max-number-of-allowed-clients-is-set-to-the-current-file-limit" class="headerlink" title="the max number of allowed clients is set to the current file limit"></a>the max number of allowed clients is set to the current file limit</h1><h1 id="minus-32-as-Redis-reserves-a-few-file-descriptors-for-internal-uses"><a href="#minus-32-as-Redis-reserves-a-few-file-descriptors-for-internal-uses" class="headerlink" title="minus 32 (as Redis reserves a few file descriptors for internal uses)."></a>minus 32 (as Redis reserves a few file descriptors for internal uses).</h1><p>#</p>
<h1 id="Once-the-limit-is-reached-Redis-will-close-all-the-new-connections-sending"><a href="#Once-the-limit-is-reached-Redis-will-close-all-the-new-connections-sending" class="headerlink" title="Once the limit is reached Redis will close all the new connections sending"></a>Once the limit is reached Redis will close all the new connections sending</h1><h1 id="an-error-‘max-number-of-clients-reached’"><a href="#an-error-‘max-number-of-clients-reached’" class="headerlink" title="an error ‘max number of clients reached’."></a>an error ‘max number of clients reached’.</h1><p>#</p>
<h1 id="maxclients-10000"><a href="#maxclients-10000" class="headerlink" title="maxclients 10000"></a>maxclients 10000</h1><p>############################## MEMORY MANAGEMENT ################################</p>
<h1 id="Set-a-memory-usage-limit-to-the-specified-amount-of-bytes"><a href="#Set-a-memory-usage-limit-to-the-specified-amount-of-bytes" class="headerlink" title="Set a memory usage limit to the specified amount of bytes."></a>Set a memory usage limit to the specified amount of bytes.</h1><h1 id="When-the-memory-limit-is-reached-Redis-will-try-to-remove-keys"><a href="#When-the-memory-limit-is-reached-Redis-will-try-to-remove-keys" class="headerlink" title="When the memory limit is reached Redis will try to remove keys"></a>When the memory limit is reached Redis will try to remove keys</h1><h1 id="according-to-the-eviction-policy-selected-see-maxmemory-policy"><a href="#according-to-the-eviction-policy-selected-see-maxmemory-policy" class="headerlink" title="according to the eviction policy selected (see maxmemory-policy)."></a>according to the eviction policy selected (see maxmemory-policy).</h1><p>#</p>
<h1 id="If-Redis-can’t-remove-keys-according-to-the-policy-or-if-the-policy-is"><a href="#If-Redis-can’t-remove-keys-according-to-the-policy-or-if-the-policy-is" class="headerlink" title="If Redis can’t remove keys according to the policy, or if the policy is"></a>If Redis can’t remove keys according to the policy, or if the policy is</h1><h1 id="set-to-‘noeviction’-Redis-will-start-to-reply-with-errors-to-commands"><a href="#set-to-‘noeviction’-Redis-will-start-to-reply-with-errors-to-commands" class="headerlink" title="set to ‘noeviction’, Redis will start to reply with errors to commands"></a>set to ‘noeviction’, Redis will start to reply with errors to commands</h1><h1 id="that-would-use-more-memory-like-SET-LPUSH-and-so-on-and-will-continue"><a href="#that-would-use-more-memory-like-SET-LPUSH-and-so-on-and-will-continue" class="headerlink" title="that would use more memory, like SET, LPUSH, and so on, and will continue"></a>that would use more memory, like SET, LPUSH, and so on, and will continue</h1><h1 id="to-reply-to-read-only-commands-like-GET"><a href="#to-reply-to-read-only-commands-like-GET" class="headerlink" title="to reply to read-only commands like GET."></a>to reply to read-only commands like GET.</h1><p>#</p>
<h1 id="This-option-is-usually-useful-when-using-Redis-as-an-LRU-or-LFU-cache-or-to"><a href="#This-option-is-usually-useful-when-using-Redis-as-an-LRU-or-LFU-cache-or-to" class="headerlink" title="This option is usually useful when using Redis as an LRU or LFU cache, or to"></a>This option is usually useful when using Redis as an LRU or LFU cache, or to</h1><h1 id="set-a-hard-memory-limit-for-an-instance-using-the-‘noeviction’-policy"><a href="#set-a-hard-memory-limit-for-an-instance-using-the-‘noeviction’-policy" class="headerlink" title="set a hard memory limit for an instance (using the ‘noeviction’ policy)."></a>set a hard memory limit for an instance (using the ‘noeviction’ policy).</h1><p>#</p>
<h1 id="WARNING-If-you-have-replicas-attached-to-an-instance-with-maxmemory-on"><a href="#WARNING-If-you-have-replicas-attached-to-an-instance-with-maxmemory-on" class="headerlink" title="WARNING: If you have replicas attached to an instance with maxmemory on,"></a>WARNING: If you have replicas attached to an instance with maxmemory on,</h1><h1 id="the-size-of-the-output-buffers-needed-to-feed-the-replicas-are-subtracted"><a href="#the-size-of-the-output-buffers-needed-to-feed-the-replicas-are-subtracted" class="headerlink" title="the size of the output buffers needed to feed the replicas are subtracted"></a>the size of the output buffers needed to feed the replicas are subtracted</h1><h1 id="from-the-used-memory-count-so-that-network-problems-resyncs-will"><a href="#from-the-used-memory-count-so-that-network-problems-resyncs-will" class="headerlink" title="from the used memory count, so that network problems / resyncs will"></a>from the used memory count, so that network problems / resyncs will</h1><h1 id="not-trigger-a-loop-where-keys-are-evicted-and-in-turn-the-output"><a href="#not-trigger-a-loop-where-keys-are-evicted-and-in-turn-the-output" class="headerlink" title="not trigger a loop where keys are evicted, and in turn the output"></a>not trigger a loop where keys are evicted, and in turn the output</h1><h1 id="buffer-of-replicas-is-full-with-DELs-of-keys-evicted-triggering-the-deletion"><a href="#buffer-of-replicas-is-full-with-DELs-of-keys-evicted-triggering-the-deletion" class="headerlink" title="buffer of replicas is full with DELs of keys evicted triggering the deletion"></a>buffer of replicas is full with DELs of keys evicted triggering the deletion</h1><h1 id="of-more-keys-and-so-forth-until-the-database-is-completely-emptied"><a href="#of-more-keys-and-so-forth-until-the-database-is-completely-emptied" class="headerlink" title="of more keys, and so forth until the database is completely emptied."></a>of more keys, and so forth until the database is completely emptied.</h1><p>#</p>
<h1 id="In-short…-if-you-have-replicas-attached-it-is-suggested-that-you-set-a-lower"><a href="#In-short…-if-you-have-replicas-attached-it-is-suggested-that-you-set-a-lower" class="headerlink" title="In short… if you have replicas attached it is suggested that you set a lower"></a>In short… if you have replicas attached it is suggested that you set a lower</h1><h1 id="limit-for-maxmemory-so-that-there-is-some-free-RAM-on-the-system-for-replica"><a href="#limit-for-maxmemory-so-that-there-is-some-free-RAM-on-the-system-for-replica" class="headerlink" title="limit for maxmemory so that there is some free RAM on the system for replica"></a>limit for maxmemory so that there is some free RAM on the system for replica</h1><h1 id="output-buffers-but-this-is-not-needed-if-the-policy-is-‘noeviction’"><a href="#output-buffers-but-this-is-not-needed-if-the-policy-is-‘noeviction’" class="headerlink" title="output buffers (but this is not needed if the policy is ‘noeviction’)."></a>output buffers (but this is not needed if the policy is ‘noeviction’).</h1><p>#</p>
<h1 id="maxmemory"><a href="#maxmemory" class="headerlink" title="maxmemory "></a>maxmemory <bytes></bytes></h1><h1 id="MAXMEMORY-POLICY-how-Redis-will-select-what-to-remove-when-maxmemory"><a href="#MAXMEMORY-POLICY-how-Redis-will-select-what-to-remove-when-maxmemory" class="headerlink" title="MAXMEMORY POLICY: how Redis will select what to remove when maxmemory"></a>MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</h1><h1 id="is-reached-You-can-select-among-five-behaviors"><a href="#is-reached-You-can-select-among-five-behaviors" class="headerlink" title="is reached. You can select among five behaviors:"></a>is reached. You can select among five behaviors:</h1><p>#</p>
<h1 id="volatile-lru-gt-Evict-using-approximated-LRU-among-the-keys-with-an-expire-set"><a href="#volatile-lru-gt-Evict-using-approximated-LRU-among-the-keys-with-an-expire-set" class="headerlink" title="volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set."></a>volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</h1><h1 id="allkeys-lru-gt-Evict-any-key-using-approximated-LRU"><a href="#allkeys-lru-gt-Evict-any-key-using-approximated-LRU" class="headerlink" title="allkeys-lru -&gt; Evict any key using approximated LRU."></a>allkeys-lru -&gt; Evict any key using approximated LRU.</h1><h1 id="volatile-lfu-gt-Evict-using-approximated-LFU-among-the-keys-with-an-expire-set"><a href="#volatile-lfu-gt-Evict-using-approximated-LFU-among-the-keys-with-an-expire-set" class="headerlink" title="volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set."></a>volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</h1><h1 id="allkeys-lfu-gt-Evict-any-key-using-approximated-LFU"><a href="#allkeys-lfu-gt-Evict-any-key-using-approximated-LFU" class="headerlink" title="allkeys-lfu -&gt; Evict any key using approximated LFU."></a>allkeys-lfu -&gt; Evict any key using approximated LFU.</h1><h1 id="volatile-random-gt-Remove-a-random-key-among-the-ones-with-an-expire-set"><a href="#volatile-random-gt-Remove-a-random-key-among-the-ones-with-an-expire-set" class="headerlink" title="volatile-random -&gt; Remove a random key among the ones with an expire set."></a>volatile-random -&gt; Remove a random key among the ones with an expire set.</h1><h1 id="allkeys-random-gt-Remove-a-random-key-any-key"><a href="#allkeys-random-gt-Remove-a-random-key-any-key" class="headerlink" title="allkeys-random -&gt; Remove a random key, any key."></a>allkeys-random -&gt; Remove a random key, any key.</h1><h1 id="volatile-ttl-gt-Remove-the-key-with-the-nearest-expire-time-minor-TTL"><a href="#volatile-ttl-gt-Remove-the-key-with-the-nearest-expire-time-minor-TTL" class="headerlink" title="volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)"></a>volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</h1><h1 id="noeviction-gt-Don’t-evict-anything-just-return-an-error-on-write-operations"><a href="#noeviction-gt-Don’t-evict-anything-just-return-an-error-on-write-operations" class="headerlink" title="noeviction -&gt; Don’t evict anything, just return an error on write operations."></a>noeviction -&gt; Don’t evict anything, just return an error on write operations.</h1><p>#</p>
<h1 id="LRU-means-Least-Recently-Used"><a href="#LRU-means-Least-Recently-Used" class="headerlink" title="LRU means Least Recently Used"></a>LRU means Least Recently Used</h1><h1 id="LFU-means-Least-Frequently-Used"><a href="#LFU-means-Least-Frequently-Used" class="headerlink" title="LFU means Least Frequently Used"></a>LFU means Least Frequently Used</h1><p>#</p>
<h1 id="Both-LRU-LFU-and-volatile-ttl-are-implemented-using-approximated"><a href="#Both-LRU-LFU-and-volatile-ttl-are-implemented-using-approximated" class="headerlink" title="Both LRU, LFU and volatile-ttl are implemented using approximated"></a>Both LRU, LFU and volatile-ttl are implemented using approximated</h1><h1 id="randomized-algorithms"><a href="#randomized-algorithms" class="headerlink" title="randomized algorithms."></a>randomized algorithms.</h1><p>#</p>
<h1 id="Note-with-any-of-the-above-policies-Redis-will-return-an-error-on-write"><a href="#Note-with-any-of-the-above-policies-Redis-will-return-an-error-on-write" class="headerlink" title="Note: with any of the above policies, Redis will return an error on write"></a>Note: with any of the above policies, Redis will return an error on write</h1><h1 id="operations-when-there-are-no-suitable-keys-for-eviction"><a href="#operations-when-there-are-no-suitable-keys-for-eviction" class="headerlink" title="operations, when there are no suitable keys for eviction."></a>operations, when there are no suitable keys for eviction.</h1><p>#</p>
<h1 id="At-the-date-of-writing-these-commands-are-set-setnx-setex-append"><a href="#At-the-date-of-writing-these-commands-are-set-setnx-setex-append" class="headerlink" title="At the date of writing these commands are: set setnx setex append"></a>At the date of writing these commands are: set setnx setex append</h1><h1 id="incr-decr-rpush-lpush-rpushx-lpushx-linsert-lset-rpoplpush-sadd"><a href="#incr-decr-rpush-lpush-rpushx-lpushx-linsert-lset-rpoplpush-sadd" class="headerlink" title="incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd"></a>incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</h1><h1 id="sinter-sinterstore-sunion-sunionstore-sdiff-sdiffstore-zadd-zincrby"><a href="#sinter-sinterstore-sunion-sunionstore-sdiff-sdiffstore-zadd-zincrby" class="headerlink" title="sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby"></a>sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</h1><h1 id="zunionstore-zinterstore-hset-hsetnx-hmset-hincrby-incrby-decrby"><a href="#zunionstore-zinterstore-hset-hsetnx-hmset-hincrby-incrby-decrby" class="headerlink" title="zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby"></a>zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</h1><h1 id="getset-mset-msetnx-exec-sort"><a href="#getset-mset-msetnx-exec-sort" class="headerlink" title="getset mset msetnx exec sort"></a>getset mset msetnx exec sort</h1><p>#</p>
<h1 id="The-default-is"><a href="#The-default-is" class="headerlink" title="The default is:"></a>The default is:</h1><p>#</p>
<h1 id="maxmemory-policy-noeviction"><a href="#maxmemory-policy-noeviction" class="headerlink" title="maxmemory-policy noeviction"></a>maxmemory-policy noeviction</h1><h1 id="LRU-LFU-and-minimal-TTL-algorithms-are-not-precise-algorithms-but-approximated"><a href="#LRU-LFU-and-minimal-TTL-algorithms-are-not-precise-algorithms-but-approximated" class="headerlink" title="LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated"></a>LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</h1><h1 id="algorithms-in-order-to-save-memory-so-you-can-tune-it-for-speed-or"><a href="#algorithms-in-order-to-save-memory-so-you-can-tune-it-for-speed-or" class="headerlink" title="algorithms (in order to save memory), so you can tune it for speed or"></a>algorithms (in order to save memory), so you can tune it for speed or</h1><h1 id="accuracy-For-default-Redis-will-check-five-keys-and-pick-the-one-that-was"><a href="#accuracy-For-default-Redis-will-check-five-keys-and-pick-the-one-that-was" class="headerlink" title="accuracy. For default Redis will check five keys and pick the one that was"></a>accuracy. For default Redis will check five keys and pick the one that was</h1><h1 id="used-less-recently-you-can-change-the-sample-size-using-the-following"><a href="#used-less-recently-you-can-change-the-sample-size-using-the-following" class="headerlink" title="used less recently, you can change the sample size using the following"></a>used less recently, you can change the sample size using the following</h1><h1 id="configuration-directive"><a href="#configuration-directive" class="headerlink" title="configuration directive."></a>configuration directive.</h1><p>#</p>
<h1 id="The-default-of-5-produces-good-enough-results-10-Approximates-very-closely"><a href="#The-default-of-5-produces-good-enough-results-10-Approximates-very-closely" class="headerlink" title="The default of 5 produces good enough results. 10 Approximates very closely"></a>The default of 5 produces good enough results. 10 Approximates very closely</h1><h1 id="true-LRU-but-costs-more-CPU-3-is-faster-but-not-very-accurate"><a href="#true-LRU-but-costs-more-CPU-3-is-faster-but-not-very-accurate" class="headerlink" title="true LRU but costs more CPU. 3 is faster but not very accurate."></a>true LRU but costs more CPU. 3 is faster but not very accurate.</h1><p>#</p>
<h1 id="maxmemory-samples-5"><a href="#maxmemory-samples-5" class="headerlink" title="maxmemory-samples 5"></a>maxmemory-samples 5</h1><h1 id="Starting-from-Redis-5-by-default-a-replica-will-ignore-its-maxmemory-setting"><a href="#Starting-from-Redis-5-by-default-a-replica-will-ignore-its-maxmemory-setting" class="headerlink" title="Starting from Redis 5, by default a replica will ignore its maxmemory setting"></a>Starting from Redis 5, by default a replica will ignore its maxmemory setting</h1><h1 id="unless-it-is-promoted-to-master-after-a-failover-or-manually-It-means"><a href="#unless-it-is-promoted-to-master-after-a-failover-or-manually-It-means" class="headerlink" title="(unless it is promoted to master after a failover or manually). It means"></a>(unless it is promoted to master after a failover or manually). It means</h1><h1 id="that-the-eviction-of-keys-will-be-just-handled-by-the-master-sending-the"><a href="#that-the-eviction-of-keys-will-be-just-handled-by-the-master-sending-the" class="headerlink" title="that the eviction of keys will be just handled by the master, sending the"></a>that the eviction of keys will be just handled by the master, sending the</h1><h1 id="DEL-commands-to-the-replica-as-keys-evict-in-the-master-side"><a href="#DEL-commands-to-the-replica-as-keys-evict-in-the-master-side" class="headerlink" title="DEL commands to the replica as keys evict in the master side."></a>DEL commands to the replica as keys evict in the master side.</h1><p>#</p>
<h1 id="This-behavior-ensures-that-masters-and-replicas-stay-consistent-and-is-usually"><a href="#This-behavior-ensures-that-masters-and-replicas-stay-consistent-and-is-usually" class="headerlink" title="This behavior ensures that masters and replicas stay consistent, and is usually"></a>This behavior ensures that masters and replicas stay consistent, and is usually</h1><h1 id="what-you-want-however-if-your-replica-is-writable-or-you-want-the-replica-to-have"><a href="#what-you-want-however-if-your-replica-is-writable-or-you-want-the-replica-to-have" class="headerlink" title="what you want, however if your replica is writable, or you want the replica to have"></a>what you want, however if your replica is writable, or you want the replica to have</h1><h1 id="a-different-memory-setting-and-you-are-sure-all-the-writes-performed-to-the"><a href="#a-different-memory-setting-and-you-are-sure-all-the-writes-performed-to-the" class="headerlink" title="a different memory setting, and you are sure all the writes performed to the"></a>a different memory setting, and you are sure all the writes performed to the</h1><h1 id="replica-are-idempotent-then-you-may-change-this-default-but-be-sure-to-understand"><a href="#replica-are-idempotent-then-you-may-change-this-default-but-be-sure-to-understand" class="headerlink" title="replica are idempotent, then you may change this default (but be sure to understand"></a>replica are idempotent, then you may change this default (but be sure to understand</h1><h1 id="what-you-are-doing"><a href="#what-you-are-doing" class="headerlink" title="what you are doing)."></a>what you are doing).</h1><p>#</p>
<h1 id="Note-that-since-the-replica-by-default-does-not-evict-it-may-end-using-more"><a href="#Note-that-since-the-replica-by-default-does-not-evict-it-may-end-using-more" class="headerlink" title="Note that since the replica by default does not evict, it may end using more"></a>Note that since the replica by default does not evict, it may end using more</h1><h1 id="memory-than-the-one-set-via-maxmemory-there-are-certain-buffers-that-may"><a href="#memory-than-the-one-set-via-maxmemory-there-are-certain-buffers-that-may" class="headerlink" title="memory than the one set via maxmemory (there are certain buffers that may"></a>memory than the one set via maxmemory (there are certain buffers that may</h1><h1 id="be-larger-on-the-replica-or-data-structures-may-sometimes-take-more-memory-and-so"><a href="#be-larger-on-the-replica-or-data-structures-may-sometimes-take-more-memory-and-so" class="headerlink" title="be larger on the replica, or data structures may sometimes take more memory and so"></a>be larger on the replica, or data structures may sometimes take more memory and so</h1><h1 id="forth-So-make-sure-you-monitor-your-replicas-and-make-sure-they-have-enough"><a href="#forth-So-make-sure-you-monitor-your-replicas-and-make-sure-they-have-enough" class="headerlink" title="forth). So make sure you monitor your replicas and make sure they have enough"></a>forth). So make sure you monitor your replicas and make sure they have enough</h1><h1 id="memory-to-never-hit-a-real-out-of-memory-condition-before-the-master-hits"><a href="#memory-to-never-hit-a-real-out-of-memory-condition-before-the-master-hits" class="headerlink" title="memory to never hit a real out-of-memory condition before the master hits"></a>memory to never hit a real out-of-memory condition before the master hits</h1><h1 id="the-configured-maxmemory-setting"><a href="#the-configured-maxmemory-setting" class="headerlink" title="the configured maxmemory setting."></a>the configured maxmemory setting.</h1><p>#</p>
<h1 id="replica-ignore-maxmemory-yes"><a href="#replica-ignore-maxmemory-yes" class="headerlink" title="replica-ignore-maxmemory yes"></a>replica-ignore-maxmemory yes</h1><p>############################# LAZY FREEING ####################################</p>
<h1 id="Redis-has-two-primitives-to-delete-keys-One-is-called-DEL-and-is-a-blocking"><a href="#Redis-has-two-primitives-to-delete-keys-One-is-called-DEL-and-is-a-blocking" class="headerlink" title="Redis has two primitives to delete keys. One is called DEL and is a blocking"></a>Redis has two primitives to delete keys. One is called DEL and is a blocking</h1><h1 id="deletion-of-the-object-It-means-that-the-server-stops-processing-new-commands"><a href="#deletion-of-the-object-It-means-that-the-server-stops-processing-new-commands" class="headerlink" title="deletion of the object. It means that the server stops processing new commands"></a>deletion of the object. It means that the server stops processing new commands</h1><h1 id="in-order-to-reclaim-all-the-memory-associated-with-an-object-in-a-synchronous"><a href="#in-order-to-reclaim-all-the-memory-associated-with-an-object-in-a-synchronous" class="headerlink" title="in order to reclaim all the memory associated with an object in a synchronous"></a>in order to reclaim all the memory associated with an object in a synchronous</h1><h1 id="way-If-the-key-deleted-is-associated-with-a-small-object-the-time-needed"><a href="#way-If-the-key-deleted-is-associated-with-a-small-object-the-time-needed" class="headerlink" title="way. If the key deleted is associated with a small object, the time needed"></a>way. If the key deleted is associated with a small object, the time needed</h1><h1 id="in-order-to-execute-the-DEL-command-is-very-small-and-comparable-to-most-other"><a href="#in-order-to-execute-the-DEL-command-is-very-small-and-comparable-to-most-other" class="headerlink" title="in order to execute the DEL command is very small and comparable to most other"></a>in order to execute the DEL command is very small and comparable to most other</h1><h1 id="O-1-or-O-log-N-commands-in-Redis-However-if-the-key-is-associated-with-an"><a href="#O-1-or-O-log-N-commands-in-Redis-However-if-the-key-is-associated-with-an" class="headerlink" title="O(1) or O(log_N) commands in Redis. However if the key is associated with an"></a>O(1) or O(log_N) commands in Redis. However if the key is associated with an</h1><h1 id="aggregated-value-containing-millions-of-elements-the-server-can-block-for"><a href="#aggregated-value-containing-millions-of-elements-the-server-can-block-for" class="headerlink" title="aggregated value containing millions of elements, the server can block for"></a>aggregated value containing millions of elements, the server can block for</h1><h1 id="a-long-time-even-seconds-in-order-to-complete-the-operation"><a href="#a-long-time-even-seconds-in-order-to-complete-the-operation" class="headerlink" title="a long time (even seconds) in order to complete the operation."></a>a long time (even seconds) in order to complete the operation.</h1><p>#</p>
<h1 id="For-the-above-reasons-Redis-also-offers-non-blocking-deletion-primitives"><a href="#For-the-above-reasons-Redis-also-offers-non-blocking-deletion-primitives" class="headerlink" title="For the above reasons Redis also offers non blocking deletion primitives"></a>For the above reasons Redis also offers non blocking deletion primitives</h1><h1 id="such-as-UNLINK-non-blocking-DEL-and-the-ASYNC-option-of-FLUSHALL-and"><a href="#such-as-UNLINK-non-blocking-DEL-and-the-ASYNC-option-of-FLUSHALL-and" class="headerlink" title="such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and"></a>such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</h1><h1 id="FLUSHDB-commands-in-order-to-reclaim-memory-in-background-Those-commands"><a href="#FLUSHDB-commands-in-order-to-reclaim-memory-in-background-Those-commands" class="headerlink" title="FLUSHDB commands, in order to reclaim memory in background. Those commands"></a>FLUSHDB commands, in order to reclaim memory in background. Those commands</h1><h1 id="are-executed-in-constant-time-Another-thread-will-incrementally-free-the"><a href="#are-executed-in-constant-time-Another-thread-will-incrementally-free-the" class="headerlink" title="are executed in constant time. Another thread will incrementally free the"></a>are executed in constant time. Another thread will incrementally free the</h1><h1 id="object-in-the-background-as-fast-as-possible"><a href="#object-in-the-background-as-fast-as-possible" class="headerlink" title="object in the background as fast as possible."></a>object in the background as fast as possible.</h1><p>#</p>
<h1 id="DEL-UNLINK-and-ASYNC-option-of-FLUSHALL-and-FLUSHDB-are-user-controlled"><a href="#DEL-UNLINK-and-ASYNC-option-of-FLUSHALL-and-FLUSHDB-are-user-controlled" class="headerlink" title="DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled."></a>DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</h1><h1 id="It’s-up-to-the-design-of-the-application-to-understand-when-it-is-a-good"><a href="#It’s-up-to-the-design-of-the-application-to-understand-when-it-is-a-good" class="headerlink" title="It’s up to the design of the application to understand when it is a good"></a>It’s up to the design of the application to understand when it is a good</h1><h1 id="idea-to-use-one-or-the-other-However-the-Redis-server-sometimes-has-to"><a href="#idea-to-use-one-or-the-other-However-the-Redis-server-sometimes-has-to" class="headerlink" title="idea to use one or the other. However the Redis server sometimes has to"></a>idea to use one or the other. However the Redis server sometimes has to</h1><h1 id="delete-keys-or-flush-the-whole-database-as-a-side-effect-of-other-operations"><a href="#delete-keys-or-flush-the-whole-database-as-a-side-effect-of-other-operations" class="headerlink" title="delete keys or flush the whole database as a side effect of other operations."></a>delete keys or flush the whole database as a side effect of other operations.</h1><h1 id="Specifically-Redis-deletes-objects-independently-of-a-user-call-in-the"><a href="#Specifically-Redis-deletes-objects-independently-of-a-user-call-in-the" class="headerlink" title="Specifically Redis deletes objects independently of a user call in the"></a>Specifically Redis deletes objects independently of a user call in the</h1><h1 id="following-scenarios"><a href="#following-scenarios" class="headerlink" title="following scenarios:"></a>following scenarios:</h1><p>#</p>
<h1 id="1-On-eviction-because-of-the-maxmemory-and-maxmemory-policy-configurations"><a href="#1-On-eviction-because-of-the-maxmemory-and-maxmemory-policy-configurations" class="headerlink" title="1) On eviction, because of the maxmemory and maxmemory policy configurations,"></a>1) On eviction, because of the maxmemory and maxmemory policy configurations,</h1><h1 id="in-order-to-make-room-for-new-data-without-going-over-the-specified"><a href="#in-order-to-make-room-for-new-data-without-going-over-the-specified" class="headerlink" title="in order to make room for new data, without going over the specified"></a>in order to make room for new data, without going over the specified</h1><h1 id="memory-limit"><a href="#memory-limit" class="headerlink" title="memory limit."></a>memory limit.</h1><h1 id="2-Because-of-expire-when-a-key-with-an-associated-time-to-live-see-the"><a href="#2-Because-of-expire-when-a-key-with-an-associated-time-to-live-see-the" class="headerlink" title="2) Because of expire: when a key with an associated time to live (see the"></a>2) Because of expire: when a key with an associated time to live (see the</h1><h1 id="EXPIRE-command-must-be-deleted-from-memory"><a href="#EXPIRE-command-must-be-deleted-from-memory" class="headerlink" title="EXPIRE command) must be deleted from memory."></a>EXPIRE command) must be deleted from memory.</h1><h1 id="3-Because-of-a-side-effect-of-a-command-that-stores-data-on-a-key-that-may"><a href="#3-Because-of-a-side-effect-of-a-command-that-stores-data-on-a-key-that-may" class="headerlink" title="3) Because of a side effect of a command that stores data on a key that may"></a>3) Because of a side effect of a command that stores data on a key that may</h1><h1 id="already-exist-For-example-the-RENAME-command-may-delete-the-old-key"><a href="#already-exist-For-example-the-RENAME-command-may-delete-the-old-key" class="headerlink" title="already exist. For example the RENAME command may delete the old key"></a>already exist. For example the RENAME command may delete the old key</h1><h1 id="content-when-it-is-replaced-with-another-one-Similarly-SUNIONSTORE"><a href="#content-when-it-is-replaced-with-another-one-Similarly-SUNIONSTORE" class="headerlink" title="content when it is replaced with another one. Similarly SUNIONSTORE"></a>content when it is replaced with another one. Similarly SUNIONSTORE</h1><h1 id="or-SORT-with-STORE-option-may-delete-existing-keys-The-SET-command"><a href="#or-SORT-with-STORE-option-may-delete-existing-keys-The-SET-command" class="headerlink" title="or SORT with STORE option may delete existing keys. The SET command"></a>or SORT with STORE option may delete existing keys. The SET command</h1><h1 id="itself-removes-any-old-content-of-the-specified-key-in-order-to-replace"><a href="#itself-removes-any-old-content-of-the-specified-key-in-order-to-replace" class="headerlink" title="itself removes any old content of the specified key in order to replace"></a>itself removes any old content of the specified key in order to replace</h1><h1 id="it-with-the-specified-string"><a href="#it-with-the-specified-string" class="headerlink" title="it with the specified string."></a>it with the specified string.</h1><h1 id="4-During-replication-when-a-replica-performs-a-full-resynchronization-with"><a href="#4-During-replication-when-a-replica-performs-a-full-resynchronization-with" class="headerlink" title="4) During replication, when a replica performs a full resynchronization with"></a>4) During replication, when a replica performs a full resynchronization with</h1><h1 id="its-master-the-content-of-the-whole-database-is-removed-in-order-to"><a href="#its-master-the-content-of-the-whole-database-is-removed-in-order-to" class="headerlink" title="its master, the content of the whole database is removed in order to"></a>its master, the content of the whole database is removed in order to</h1><h1 id="load-the-RDB-file-just-transferred"><a href="#load-the-RDB-file-just-transferred" class="headerlink" title="load the RDB file just transferred."></a>load the RDB file just transferred.</h1><p>#</p>
<h1 id="In-all-the-above-cases-the-default-is-to-delete-objects-in-a-blocking-way"><a href="#In-all-the-above-cases-the-default-is-to-delete-objects-in-a-blocking-way" class="headerlink" title="In all the above cases the default is to delete objects in a blocking way,"></a>In all the above cases the default is to delete objects in a blocking way,</h1><h1 id="like-if-DEL-was-called-However-you-can-configure-each-case-specifically"><a href="#like-if-DEL-was-called-However-you-can-configure-each-case-specifically" class="headerlink" title="like if DEL was called. However you can configure each case specifically"></a>like if DEL was called. However you can configure each case specifically</h1><h1 id="in-order-to-instead-release-memory-in-a-non-blocking-way-like-if-UNLINK"><a href="#in-order-to-instead-release-memory-in-a-non-blocking-way-like-if-UNLINK" class="headerlink" title="in order to instead release memory in a non-blocking way like if UNLINK"></a>in order to instead release memory in a non-blocking way like if UNLINK</h1><h1 id="was-called-using-the-following-configuration-directives"><a href="#was-called-using-the-following-configuration-directives" class="headerlink" title="was called, using the following configuration directives:"></a>was called, using the following configuration directives:</h1><p>lazyfree-lazy-eviction no<br>lazyfree-lazy-expire no<br>lazyfree-lazy-server-del no<br>replica-lazy-flush no</p>
<p>############################## APPEND ONLY MODE ###############################</p>
<h1 id="By-default-Redis-asynchronously-dumps-the-dataset-on-disk-This-mode-is"><a href="#By-default-Redis-asynchronously-dumps-the-dataset-on-disk-This-mode-is" class="headerlink" title="By default Redis asynchronously dumps the dataset on disk. This mode is"></a>By default Redis asynchronously dumps the dataset on disk. This mode is</h1><h1 id="good-enough-in-many-applications-but-an-issue-with-the-Redis-process-or"><a href="#good-enough-in-many-applications-but-an-issue-with-the-Redis-process-or" class="headerlink" title="good enough in many applications, but an issue with the Redis process or"></a>good enough in many applications, but an issue with the Redis process or</h1><h1 id="a-power-outage-may-result-into-a-few-minutes-of-writes-lost-depending-on"><a href="#a-power-outage-may-result-into-a-few-minutes-of-writes-lost-depending-on" class="headerlink" title="a power outage may result into a few minutes of writes lost (depending on"></a>a power outage may result into a few minutes of writes lost (depending on</h1><h1 id="the-configured-save-points"><a href="#the-configured-save-points" class="headerlink" title="the configured save points)."></a>the configured save points).</h1><p>#</p>
<h1 id="The-Append-Only-File-is-an-alternative-persistence-mode-that-provides"><a href="#The-Append-Only-File-is-an-alternative-persistence-mode-that-provides" class="headerlink" title="The Append Only File is an alternative persistence mode that provides"></a>The Append Only File is an alternative persistence mode that provides</h1><h1 id="much-better-durability-For-instance-using-the-default-data-fsync-policy"><a href="#much-better-durability-For-instance-using-the-default-data-fsync-policy" class="headerlink" title="much better durability. For instance using the default data fsync policy"></a>much better durability. For instance using the default data fsync policy</h1><h1 id="see-later-in-the-config-file-Redis-can-lose-just-one-second-of-writes-in-a"><a href="#see-later-in-the-config-file-Redis-can-lose-just-one-second-of-writes-in-a" class="headerlink" title="(see later in the config file) Redis can lose just one second of writes in a"></a>(see later in the config file) Redis can lose just one second of writes in a</h1><h1 id="dramatic-event-like-a-server-power-outage-or-a-single-write-if-something"><a href="#dramatic-event-like-a-server-power-outage-or-a-single-write-if-something" class="headerlink" title="dramatic event like a server power outage, or a single write if something"></a>dramatic event like a server power outage, or a single write if something</h1><h1 id="wrong-with-the-Redis-process-itself-happens-but-the-operating-system-is"><a href="#wrong-with-the-Redis-process-itself-happens-but-the-operating-system-is" class="headerlink" title="wrong with the Redis process itself happens, but the operating system is"></a>wrong with the Redis process itself happens, but the operating system is</h1><h1 id="still-running-correctly"><a href="#still-running-correctly" class="headerlink" title="still running correctly."></a>still running correctly.</h1><p>#</p>
<h1 id="AOF-and-RDB-persistence-can-be-enabled-at-the-same-time-without-problems"><a href="#AOF-and-RDB-persistence-can-be-enabled-at-the-same-time-without-problems" class="headerlink" title="AOF and RDB persistence can be enabled at the same time without problems."></a>AOF and RDB persistence can be enabled at the same time without problems.</h1><h1 id="If-the-AOF-is-enabled-on-startup-Redis-will-load-the-AOF-that-is-the-file"><a href="#If-the-AOF-is-enabled-on-startup-Redis-will-load-the-AOF-that-is-the-file" class="headerlink" title="If the AOF is enabled on startup Redis will load the AOF, that is the file"></a>If the AOF is enabled on startup Redis will load the AOF, that is the file</h1><h1 id="with-the-better-durability-guarantees"><a href="#with-the-better-durability-guarantees" class="headerlink" title="with the better durability guarantees."></a>with the better durability guarantees.</h1><p>#</p>
<h1 id="Please-check-http-redis-io-topics-persistence-for-more-information"><a href="#Please-check-http-redis-io-topics-persistence-for-more-information" class="headerlink" title="Please check http://redis.io/topics/persistence for more information."></a>Please check <a href="http://redis.io/topics/persistence" target="_blank" rel="noopener">http://redis.io/topics/persistence</a> for more information.</h1><p>appendonly no</p>
<h1 id="The-name-of-the-append-only-file-default-“appendonly-aof”"><a href="#The-name-of-the-append-only-file-default-“appendonly-aof”" class="headerlink" title="The name of the append only file (default: “appendonly.aof”)"></a>The name of the append only file (default: “appendonly.aof”)</h1><p>appendfilename “appendonly.aof”</p>
<h1 id="The-fsync-call-tells-the-Operating-System-to-actually-write-data-on-disk"><a href="#The-fsync-call-tells-the-Operating-System-to-actually-write-data-on-disk" class="headerlink" title="The fsync() call tells the Operating System to actually write data on disk"></a>The fsync() call tells the Operating System to actually write data on disk</h1><h1 id="instead-of-waiting-for-more-data-in-the-output-buffer-Some-OS-will-really-flush"><a href="#instead-of-waiting-for-more-data-in-the-output-buffer-Some-OS-will-really-flush" class="headerlink" title="instead of waiting for more data in the output buffer. Some OS will really flush"></a>instead of waiting for more data in the output buffer. Some OS will really flush</h1><h1 id="data-on-disk-some-other-OS-will-just-try-to-do-it-ASAP"><a href="#data-on-disk-some-other-OS-will-just-try-to-do-it-ASAP" class="headerlink" title="data on disk, some other OS will just try to do it ASAP."></a>data on disk, some other OS will just try to do it ASAP.</h1><p>#</p>
<h1 id="Redis-supports-three-different-modes"><a href="#Redis-supports-three-different-modes" class="headerlink" title="Redis supports three different modes:"></a>Redis supports three different modes:</h1><p>#</p>
<h1 id="no-don’t-fsync-just-let-the-OS-flush-the-data-when-it-wants-Faster"><a href="#no-don’t-fsync-just-let-the-OS-flush-the-data-when-it-wants-Faster" class="headerlink" title="no: don’t fsync, just let the OS flush the data when it wants. Faster."></a>no: don’t fsync, just let the OS flush the data when it wants. Faster.</h1><h1 id="always-fsync-after-every-write-to-the-append-only-log-Slow-Safest"><a href="#always-fsync-after-every-write-to-the-append-only-log-Slow-Safest" class="headerlink" title="always: fsync after every write to the append only log. Slow, Safest."></a>always: fsync after every write to the append only log. Slow, Safest.</h1><h1 id="everysec-fsync-only-one-time-every-second-Compromise"><a href="#everysec-fsync-only-one-time-every-second-Compromise" class="headerlink" title="everysec: fsync only one time every second. Compromise."></a>everysec: fsync only one time every second. Compromise.</h1><p>#</p>
<h1 id="The-default-is-“everysec”-as-that’s-usually-the-right-compromise-between"><a href="#The-default-is-“everysec”-as-that’s-usually-the-right-compromise-between" class="headerlink" title="The default is “everysec”, as that’s usually the right compromise between"></a>The default is “everysec”, as that’s usually the right compromise between</h1><h1 id="speed-and-data-safety-It’s-up-to-you-to-understand-if-you-can-relax-this-to"><a href="#speed-and-data-safety-It’s-up-to-you-to-understand-if-you-can-relax-this-to" class="headerlink" title="speed and data safety. It’s up to you to understand if you can relax this to"></a>speed and data safety. It’s up to you to understand if you can relax this to</h1><h1 id="“no”-that-will-let-the-operating-system-flush-the-output-buffer-when"><a href="#“no”-that-will-let-the-operating-system-flush-the-output-buffer-when" class="headerlink" title="“no” that will let the operating system flush the output buffer when"></a>“no” that will let the operating system flush the output buffer when</h1><h1 id="it-wants-for-better-performances-but-if-you-can-live-with-the-idea-of"><a href="#it-wants-for-better-performances-but-if-you-can-live-with-the-idea-of" class="headerlink" title="it wants, for better performances (but if you can live with the idea of"></a>it wants, for better performances (but if you can live with the idea of</h1><h1 id="some-data-loss-consider-the-default-persistence-mode-that’s-snapshotting"><a href="#some-data-loss-consider-the-default-persistence-mode-that’s-snapshotting" class="headerlink" title="some data loss consider the default persistence mode that’s snapshotting),"></a>some data loss consider the default persistence mode that’s snapshotting),</h1><h1 id="or-on-the-contrary-use-“always”-that’s-very-slow-but-a-bit-safer-than"><a href="#or-on-the-contrary-use-“always”-that’s-very-slow-but-a-bit-safer-than" class="headerlink" title="or on the contrary, use “always” that’s very slow but a bit safer than"></a>or on the contrary, use “always” that’s very slow but a bit safer than</h1><h1 id="everysec"><a href="#everysec" class="headerlink" title="everysec."></a>everysec.</h1><p>#</p>
<h1 id="More-details-please-check-the-following-article"><a href="#More-details-please-check-the-following-article" class="headerlink" title="More details please check the following article:"></a>More details please check the following article:</h1><h1 id="http-antirez-com-post-redis-persistence-demystified-html"><a href="#http-antirez-com-post-redis-persistence-demystified-html" class="headerlink" title="http://antirez.com/post/redis-persistence-demystified.html"></a><a href="http://antirez.com/post/redis-persistence-demystified.html" target="_blank" rel="noopener">http://antirez.com/post/redis-persistence-demystified.html</a></h1><p>#</p>
<h1 id="If-unsure-use-“everysec”"><a href="#If-unsure-use-“everysec”" class="headerlink" title="If unsure, use “everysec”."></a>If unsure, use “everysec”.</h1><h1 id="appendfsync-always"><a href="#appendfsync-always" class="headerlink" title="appendfsync always"></a>appendfsync always</h1><p>appendfsync everysec</p>
<h1 id="appendfsync-no"><a href="#appendfsync-no" class="headerlink" title="appendfsync no"></a>appendfsync no</h1><h1 id="When-the-AOF-fsync-policy-is-set-to-always-or-everysec-and-a-background"><a href="#When-the-AOF-fsync-policy-is-set-to-always-or-everysec-and-a-background" class="headerlink" title="When the AOF fsync policy is set to always or everysec, and a background"></a>When the AOF fsync policy is set to always or everysec, and a background</h1><h1 id="saving-process-a-background-save-or-AOF-log-background-rewriting-is"><a href="#saving-process-a-background-save-or-AOF-log-background-rewriting-is" class="headerlink" title="saving process (a background save or AOF log background rewriting) is"></a>saving process (a background save or AOF log background rewriting) is</h1><h1 id="performing-a-lot-of-I-O-against-the-disk-in-some-Linux-configurations"><a href="#performing-a-lot-of-I-O-against-the-disk-in-some-Linux-configurations" class="headerlink" title="performing a lot of I/O against the disk, in some Linux configurations"></a>performing a lot of I/O against the disk, in some Linux configurations</h1><h1 id="Redis-may-block-too-long-on-the-fsync-call-Note-that-there-is-no-fix-for"><a href="#Redis-may-block-too-long-on-the-fsync-call-Note-that-there-is-no-fix-for" class="headerlink" title="Redis may block too long on the fsync() call. Note that there is no fix for"></a>Redis may block too long on the fsync() call. Note that there is no fix for</h1><h1 id="this-currently-as-even-performing-fsync-in-a-different-thread-will-block"><a href="#this-currently-as-even-performing-fsync-in-a-different-thread-will-block" class="headerlink" title="this currently, as even performing fsync in a different thread will block"></a>this currently, as even performing fsync in a different thread will block</h1><h1 id="our-synchronous-write-2-call"><a href="#our-synchronous-write-2-call" class="headerlink" title="our synchronous write(2) call."></a>our synchronous write(2) call.</h1><p>#</p>
<h1 id="In-order-to-mitigate-this-problem-it’s-possible-to-use-the-following-option"><a href="#In-order-to-mitigate-this-problem-it’s-possible-to-use-the-following-option" class="headerlink" title="In order to mitigate this problem it’s possible to use the following option"></a>In order to mitigate this problem it’s possible to use the following option</h1><h1 id="that-will-prevent-fsync-from-being-called-in-the-main-process-while-a"><a href="#that-will-prevent-fsync-from-being-called-in-the-main-process-while-a" class="headerlink" title="that will prevent fsync() from being called in the main process while a"></a>that will prevent fsync() from being called in the main process while a</h1><h1 id="BGSAVE-or-BGREWRITEAOF-is-in-progress"><a href="#BGSAVE-or-BGREWRITEAOF-is-in-progress" class="headerlink" title="BGSAVE or BGREWRITEAOF is in progress."></a>BGSAVE or BGREWRITEAOF is in progress.</h1><p>#</p>
<h1 id="This-means-that-while-another-child-is-saving-the-durability-of-Redis-is"><a href="#This-means-that-while-another-child-is-saving-the-durability-of-Redis-is" class="headerlink" title="This means that while another child is saving, the durability of Redis is"></a>This means that while another child is saving, the durability of Redis is</h1><h1 id="the-same-as-“appendfsync-none”-In-practical-terms-this-means-that-it-is"><a href="#the-same-as-“appendfsync-none”-In-practical-terms-this-means-that-it-is" class="headerlink" title="the same as “appendfsync none”. In practical terms, this means that it is"></a>the same as “appendfsync none”. In practical terms, this means that it is</h1><h1 id="possible-to-lose-up-to-30-seconds-of-log-in-the-worst-scenario-with-the"><a href="#possible-to-lose-up-to-30-seconds-of-log-in-the-worst-scenario-with-the" class="headerlink" title="possible to lose up to 30 seconds of log in the worst scenario (with the"></a>possible to lose up to 30 seconds of log in the worst scenario (with the</h1><h1 id="default-Linux-settings"><a href="#default-Linux-settings" class="headerlink" title="default Linux settings)."></a>default Linux settings).</h1><p>#</p>
<h1 id="If-you-have-latency-problems-turn-this-to-“yes”-Otherwise-leave-it-as"><a href="#If-you-have-latency-problems-turn-this-to-“yes”-Otherwise-leave-it-as" class="headerlink" title="If you have latency problems turn this to “yes”. Otherwise leave it as"></a>If you have latency problems turn this to “yes”. Otherwise leave it as</h1><h1 id="“no”-that-is-the-safest-pick-from-the-point-of-view-of-durability"><a href="#“no”-that-is-the-safest-pick-from-the-point-of-view-of-durability" class="headerlink" title="“no” that is the safest pick from the point of view of durability."></a>“no” that is the safest pick from the point of view of durability.</h1><p>no-appendfsync-on-rewrite no</p>
<h1 id="Automatic-rewrite-of-the-append-only-file"><a href="#Automatic-rewrite-of-the-append-only-file" class="headerlink" title="Automatic rewrite of the append only file."></a>Automatic rewrite of the append only file.</h1><h1 id="Redis-is-able-to-automatically-rewrite-the-log-file-implicitly-calling"><a href="#Redis-is-able-to-automatically-rewrite-the-log-file-implicitly-calling" class="headerlink" title="Redis is able to automatically rewrite the log file implicitly calling"></a>Redis is able to automatically rewrite the log file implicitly calling</h1><h1 id="BGREWRITEAOF-when-the-AOF-log-size-grows-by-the-specified-percentage"><a href="#BGREWRITEAOF-when-the-AOF-log-size-grows-by-the-specified-percentage" class="headerlink" title="BGREWRITEAOF when the AOF log size grows by the specified percentage."></a>BGREWRITEAOF when the AOF log size grows by the specified percentage.</h1><p>#</p>
<h1 id="This-is-how-it-works-Redis-remembers-the-size-of-the-AOF-file-after-the"><a href="#This-is-how-it-works-Redis-remembers-the-size-of-the-AOF-file-after-the" class="headerlink" title="This is how it works: Redis remembers the size of the AOF file after the"></a>This is how it works: Redis remembers the size of the AOF file after the</h1><h1 id="latest-rewrite-if-no-rewrite-has-happened-since-the-restart-the-size-of"><a href="#latest-rewrite-if-no-rewrite-has-happened-since-the-restart-the-size-of" class="headerlink" title="latest rewrite (if no rewrite has happened since the restart, the size of"></a>latest rewrite (if no rewrite has happened since the restart, the size of</h1><h1 id="the-AOF-at-startup-is-used"><a href="#the-AOF-at-startup-is-used" class="headerlink" title="the AOF at startup is used)."></a>the AOF at startup is used).</h1><p>#</p>
<h1 id="This-base-size-is-compared-to-the-current-size-If-the-current-size-is"><a href="#This-base-size-is-compared-to-the-current-size-If-the-current-size-is" class="headerlink" title="This base size is compared to the current size. If the current size is"></a>This base size is compared to the current size. If the current size is</h1><h1 id="bigger-than-the-specified-percentage-the-rewrite-is-triggered-Also"><a href="#bigger-than-the-specified-percentage-the-rewrite-is-triggered-Also" class="headerlink" title="bigger than the specified percentage, the rewrite is triggered. Also"></a>bigger than the specified percentage, the rewrite is triggered. Also</h1><h1 id="you-need-to-specify-a-minimal-size-for-the-AOF-file-to-be-rewritten-this"><a href="#you-need-to-specify-a-minimal-size-for-the-AOF-file-to-be-rewritten-this" class="headerlink" title="you need to specify a minimal size for the AOF file to be rewritten, this"></a>you need to specify a minimal size for the AOF file to be rewritten, this</h1><h1 id="is-useful-to-avoid-rewriting-the-AOF-file-even-if-the-percentage-increase"><a href="#is-useful-to-avoid-rewriting-the-AOF-file-even-if-the-percentage-increase" class="headerlink" title="is useful to avoid rewriting the AOF file even if the percentage increase"></a>is useful to avoid rewriting the AOF file even if the percentage increase</h1><h1 id="is-reached-but-it-is-still-pretty-small"><a href="#is-reached-but-it-is-still-pretty-small" class="headerlink" title="is reached but it is still pretty small."></a>is reached but it is still pretty small.</h1><p>#</p>
<h1 id="Specify-a-percentage-of-zero-in-order-to-disable-the-automatic-AOF"><a href="#Specify-a-percentage-of-zero-in-order-to-disable-the-automatic-AOF" class="headerlink" title="Specify a percentage of zero in order to disable the automatic AOF"></a>Specify a percentage of zero in order to disable the automatic AOF</h1><h1 id="rewrite-feature"><a href="#rewrite-feature" class="headerlink" title="rewrite feature."></a>rewrite feature.</h1><p>auto-aof-rewrite-percentage 100<br>auto-aof-rewrite-min-size 64mb</p>
<h1 id="An-AOF-file-may-be-found-to-be-truncated-at-the-end-during-the-Redis"><a href="#An-AOF-file-may-be-found-to-be-truncated-at-the-end-during-the-Redis" class="headerlink" title="An AOF file may be found to be truncated at the end during the Redis"></a>An AOF file may be found to be truncated at the end during the Redis</h1><h1 id="startup-process-when-the-AOF-data-gets-loaded-back-into-memory"><a href="#startup-process-when-the-AOF-data-gets-loaded-back-into-memory" class="headerlink" title="startup process, when the AOF data gets loaded back into memory."></a>startup process, when the AOF data gets loaded back into memory.</h1><h1 id="This-may-happen-when-the-system-where-Redis-is-running"><a href="#This-may-happen-when-the-system-where-Redis-is-running" class="headerlink" title="This may happen when the system where Redis is running"></a>This may happen when the system where Redis is running</h1><h1 id="crashes-especially-when-an-ext4-filesystem-is-mounted-without-the"><a href="#crashes-especially-when-an-ext4-filesystem-is-mounted-without-the" class="headerlink" title="crashes, especially when an ext4 filesystem is mounted without the"></a>crashes, especially when an ext4 filesystem is mounted without the</h1><h1 id="data-ordered-option-however-this-can’t-happen-when-Redis-itself"><a href="#data-ordered-option-however-this-can’t-happen-when-Redis-itself" class="headerlink" title="data=ordered option (however this can’t happen when Redis itself"></a>data=ordered option (however this can’t happen when Redis itself</h1><h1 id="crashes-or-aborts-but-the-operating-system-still-works-correctly"><a href="#crashes-or-aborts-but-the-operating-system-still-works-correctly" class="headerlink" title="crashes or aborts but the operating system still works correctly)."></a>crashes or aborts but the operating system still works correctly).</h1><p>#</p>
<h1 id="Redis-can-either-exit-with-an-error-when-this-happens-or-load-as-much"><a href="#Redis-can-either-exit-with-an-error-when-this-happens-or-load-as-much" class="headerlink" title="Redis can either exit with an error when this happens, or load as much"></a>Redis can either exit with an error when this happens, or load as much</h1><h1 id="data-as-possible-the-default-now-and-start-if-the-AOF-file-is-found"><a href="#data-as-possible-the-default-now-and-start-if-the-AOF-file-is-found" class="headerlink" title="data as possible (the default now) and start if the AOF file is found"></a>data as possible (the default now) and start if the AOF file is found</h1><h1 id="to-be-truncated-at-the-end-The-following-option-controls-this-behavior"><a href="#to-be-truncated-at-the-end-The-following-option-controls-this-behavior" class="headerlink" title="to be truncated at the end. The following option controls this behavior."></a>to be truncated at the end. The following option controls this behavior.</h1><p>#</p>
<h1 id="If-aof-load-truncated-is-set-to-yes-a-truncated-AOF-file-is-loaded-and"><a href="#If-aof-load-truncated-is-set-to-yes-a-truncated-AOF-file-is-loaded-and" class="headerlink" title="If aof-load-truncated is set to yes, a truncated AOF file is loaded and"></a>If aof-load-truncated is set to yes, a truncated AOF file is loaded and</h1><h1 id="the-Redis-server-starts-emitting-a-log-to-inform-the-user-of-the-event"><a href="#the-Redis-server-starts-emitting-a-log-to-inform-the-user-of-the-event" class="headerlink" title="the Redis server starts emitting a log to inform the user of the event."></a>the Redis server starts emitting a log to inform the user of the event.</h1><h1 id="Otherwise-if-the-option-is-set-to-no-the-server-aborts-with-an-error"><a href="#Otherwise-if-the-option-is-set-to-no-the-server-aborts-with-an-error" class="headerlink" title="Otherwise if the option is set to no, the server aborts with an error"></a>Otherwise if the option is set to no, the server aborts with an error</h1><h1 id="and-refuses-to-start-When-the-option-is-set-to-no-the-user-requires"><a href="#and-refuses-to-start-When-the-option-is-set-to-no-the-user-requires" class="headerlink" title="and refuses to start. When the option is set to no, the user requires"></a>and refuses to start. When the option is set to no, the user requires</h1><h1 id="to-fix-the-AOF-file-using-the-“redis-check-aof”-utility-before-to-restart"><a href="#to-fix-the-AOF-file-using-the-“redis-check-aof”-utility-before-to-restart" class="headerlink" title="to fix the AOF file using the “redis-check-aof” utility before to restart"></a>to fix the AOF file using the “redis-check-aof” utility before to restart</h1><h1 id="the-server"><a href="#the-server" class="headerlink" title="the server."></a>the server.</h1><p>#</p>
<h1 id="Note-that-if-the-AOF-file-will-be-found-to-be-corrupted-in-the-middle"><a href="#Note-that-if-the-AOF-file-will-be-found-to-be-corrupted-in-the-middle" class="headerlink" title="Note that if the AOF file will be found to be corrupted in the middle"></a>Note that if the AOF file will be found to be corrupted in the middle</h1><h1 id="the-server-will-still-exit-with-an-error-This-option-only-applies-when"><a href="#the-server-will-still-exit-with-an-error-This-option-only-applies-when" class="headerlink" title="the server will still exit with an error. This option only applies when"></a>the server will still exit with an error. This option only applies when</h1><h1 id="Redis-will-try-to-read-more-data-from-the-AOF-file-but-not-enough-bytes"><a href="#Redis-will-try-to-read-more-data-from-the-AOF-file-but-not-enough-bytes" class="headerlink" title="Redis will try to read more data from the AOF file but not enough bytes"></a>Redis will try to read more data from the AOF file but not enough bytes</h1><h1 id="will-be-found"><a href="#will-be-found" class="headerlink" title="will be found."></a>will be found.</h1><p>aof-load-truncated yes</p>
<h1 id="When-rewriting-the-AOF-file-Redis-is-able-to-use-an-RDB-preamble-in-the"><a href="#When-rewriting-the-AOF-file-Redis-is-able-to-use-an-RDB-preamble-in-the" class="headerlink" title="When rewriting the AOF file, Redis is able to use an RDB preamble in the"></a>When rewriting the AOF file, Redis is able to use an RDB preamble in the</h1><h1 id="AOF-file-for-faster-rewrites-and-recoveries-When-this-option-is-turned"><a href="#AOF-file-for-faster-rewrites-and-recoveries-When-this-option-is-turned" class="headerlink" title="AOF file for faster rewrites and recoveries. When this option is turned"></a>AOF file for faster rewrites and recoveries. When this option is turned</h1><h1 id="on-the-rewritten-AOF-file-is-composed-of-two-different-stanzas"><a href="#on-the-rewritten-AOF-file-is-composed-of-two-different-stanzas" class="headerlink" title="on the rewritten AOF file is composed of two different stanzas:"></a>on the rewritten AOF file is composed of two different stanzas:</h1><p>#</p>
<h1 id="RDB-file-AOF-tail"><a href="#RDB-file-AOF-tail" class="headerlink" title="[RDB file][AOF tail]"></a>[RDB file][AOF tail]</h1><p>#</p>
<h1 id="When-loading-Redis-recognizes-that-the-AOF-file-starts-with-the-“REDIS”"><a href="#When-loading-Redis-recognizes-that-the-AOF-file-starts-with-the-“REDIS”" class="headerlink" title="When loading Redis recognizes that the AOF file starts with the “REDIS”"></a>When loading Redis recognizes that the AOF file starts with the “REDIS”</h1><h1 id="string-and-loads-the-prefixed-RDB-file-and-continues-loading-the-AOF"><a href="#string-and-loads-the-prefixed-RDB-file-and-continues-loading-the-AOF" class="headerlink" title="string and loads the prefixed RDB file, and continues loading the AOF"></a>string and loads the prefixed RDB file, and continues loading the AOF</h1><h1 id="tail"><a href="#tail" class="headerlink" title="tail."></a>tail.</h1><p>aof-use-rdb-preamble yes</p>
<p>################################ LUA SCRIPTING  ###############################</p>
<h1 id="Max-execution-time-of-a-Lua-script-in-milliseconds"><a href="#Max-execution-time-of-a-Lua-script-in-milliseconds" class="headerlink" title="Max execution time of a Lua script in milliseconds."></a>Max execution time of a Lua script in milliseconds.</h1><p>#</p>
<h1 id="If-the-maximum-execution-time-is-reached-Redis-will-log-that-a-script-is"><a href="#If-the-maximum-execution-time-is-reached-Redis-will-log-that-a-script-is" class="headerlink" title="If the maximum execution time is reached Redis will log that a script is"></a>If the maximum execution time is reached Redis will log that a script is</h1><h1 id="still-in-execution-after-the-maximum-allowed-time-and-will-start-to"><a href="#still-in-execution-after-the-maximum-allowed-time-and-will-start-to" class="headerlink" title="still in execution after the maximum allowed time and will start to"></a>still in execution after the maximum allowed time and will start to</h1><h1 id="reply-to-queries-with-an-error"><a href="#reply-to-queries-with-an-error" class="headerlink" title="reply to queries with an error."></a>reply to queries with an error.</h1><p>#</p>
<h1 id="When-a-long-running-script-exceeds-the-maximum-execution-time-only-the"><a href="#When-a-long-running-script-exceeds-the-maximum-execution-time-only-the" class="headerlink" title="When a long running script exceeds the maximum execution time only the"></a>When a long running script exceeds the maximum execution time only the</h1><h1 id="SCRIPT-KILL-and-SHUTDOWN-NOSAVE-commands-are-available-The-first-can-be"><a href="#SCRIPT-KILL-and-SHUTDOWN-NOSAVE-commands-are-available-The-first-can-be" class="headerlink" title="SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be"></a>SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</h1><h1 id="used-to-stop-a-script-that-did-not-yet-called-write-commands-The-second"><a href="#used-to-stop-a-script-that-did-not-yet-called-write-commands-The-second" class="headerlink" title="used to stop a script that did not yet called write commands. The second"></a>used to stop a script that did not yet called write commands. The second</h1><h1 id="is-the-only-way-to-shut-down-the-server-in-the-case-a-write-command-was"><a href="#is-the-only-way-to-shut-down-the-server-in-the-case-a-write-command-was" class="headerlink" title="is the only way to shut down the server in the case a write command was"></a>is the only way to shut down the server in the case a write command was</h1><h1 id="already-issued-by-the-script-but-the-user-doesn’t-want-to-wait-for-the-natural"><a href="#already-issued-by-the-script-but-the-user-doesn’t-want-to-wait-for-the-natural" class="headerlink" title="already issued by the script but the user doesn’t want to wait for the natural"></a>already issued by the script but the user doesn’t want to wait for the natural</h1><h1 id="termination-of-the-script"><a href="#termination-of-the-script" class="headerlink" title="termination of the script."></a>termination of the script.</h1><p>#</p>
<h1 id="Set-it-to-0-or-a-negative-value-for-unlimited-execution-without-warnings"><a href="#Set-it-to-0-or-a-negative-value-for-unlimited-execution-without-warnings" class="headerlink" title="Set it to 0 or a negative value for unlimited execution without warnings."></a>Set it to 0 or a negative value for unlimited execution without warnings.</h1><p>lua-time-limit 5000</p>
<p>################################ REDIS CLUSTER  ###############################<br>#</p>
<h1 id=""><a href="#" class="headerlink" title="++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"></a>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</h1><h1 id="WARNING-EXPERIMENTAL-Redis-Cluster-is-considered-to-be-stable-code-however"><a href="#WARNING-EXPERIMENTAL-Redis-Cluster-is-considered-to-be-stable-code-however" class="headerlink" title="WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however"></a>WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however</h1><h1 id="in-order-to-mark-it-as-“mature”-we-need-to-wait-for-a-non-trivial-percentage"><a href="#in-order-to-mark-it-as-“mature”-we-need-to-wait-for-a-non-trivial-percentage" class="headerlink" title="in order to mark it as “mature” we need to wait for a non trivial percentage"></a>in order to mark it as “mature” we need to wait for a non trivial percentage</h1><h1 id="of-users-to-deploy-it-in-production"><a href="#of-users-to-deploy-it-in-production" class="headerlink" title="of users to deploy it in production."></a>of users to deploy it in production.</h1><h1 id="-1"><a href="#-1" class="headerlink" title="++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"></a>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</h1><p>#</p>
<h1 id="Normal-Redis-instances-can’t-be-part-of-a-Redis-Cluster-only-nodes-that-are"><a href="#Normal-Redis-instances-can’t-be-part-of-a-Redis-Cluster-only-nodes-that-are" class="headerlink" title="Normal Redis instances can’t be part of a Redis Cluster; only nodes that are"></a>Normal Redis instances can’t be part of a Redis Cluster; only nodes that are</h1><h1 id="started-as-cluster-nodes-can-In-order-to-start-a-Redis-instance-as-a"><a href="#started-as-cluster-nodes-can-In-order-to-start-a-Redis-instance-as-a" class="headerlink" title="started as cluster nodes can. In order to start a Redis instance as a"></a>started as cluster nodes can. In order to start a Redis instance as a</h1><h1 id="cluster-node-enable-the-cluster-support-uncommenting-the-following"><a href="#cluster-node-enable-the-cluster-support-uncommenting-the-following" class="headerlink" title="cluster node enable the cluster support uncommenting the following:"></a>cluster node enable the cluster support uncommenting the following:</h1><p>#</p>
<h1 id="cluster-enabled-yes"><a href="#cluster-enabled-yes" class="headerlink" title="cluster-enabled yes"></a>cluster-enabled yes</h1><h1 id="Every-cluster-node-has-a-cluster-configuration-file-This-file-is-not"><a href="#Every-cluster-node-has-a-cluster-configuration-file-This-file-is-not" class="headerlink" title="Every cluster node has a cluster configuration file. This file is not"></a>Every cluster node has a cluster configuration file. This file is not</h1><h1 id="intended-to-be-edited-by-hand-It-is-created-and-updated-by-Redis-nodes"><a href="#intended-to-be-edited-by-hand-It-is-created-and-updated-by-Redis-nodes" class="headerlink" title="intended to be edited by hand. It is created and updated by Redis nodes."></a>intended to be edited by hand. It is created and updated by Redis nodes.</h1><h1 id="Every-Redis-Cluster-node-requires-a-different-cluster-configuration-file"><a href="#Every-Redis-Cluster-node-requires-a-different-cluster-configuration-file" class="headerlink" title="Every Redis Cluster node requires a different cluster configuration file."></a>Every Redis Cluster node requires a different cluster configuration file.</h1><h1 id="Make-sure-that-instances-running-in-the-same-system-do-not-have"><a href="#Make-sure-that-instances-running-in-the-same-system-do-not-have" class="headerlink" title="Make sure that instances running in the same system do not have"></a>Make sure that instances running in the same system do not have</h1><h1 id="overlapping-cluster-configuration-file-names"><a href="#overlapping-cluster-configuration-file-names" class="headerlink" title="overlapping cluster configuration file names."></a>overlapping cluster configuration file names.</h1><p>#</p>
<h1 id="cluster-config-file-nodes-6379-conf"><a href="#cluster-config-file-nodes-6379-conf" class="headerlink" title="cluster-config-file nodes-6379.conf"></a>cluster-config-file nodes-6379.conf</h1><h1 id="Cluster-node-timeout-is-the-amount-of-milliseconds-a-node-must-be-unreachable"><a href="#Cluster-node-timeout-is-the-amount-of-milliseconds-a-node-must-be-unreachable" class="headerlink" title="Cluster node timeout is the amount of milliseconds a node must be unreachable"></a>Cluster node timeout is the amount of milliseconds a node must be unreachable</h1><h1 id="for-it-to-be-considered-in-failure-state"><a href="#for-it-to-be-considered-in-failure-state" class="headerlink" title="for it to be considered in failure state."></a>for it to be considered in failure state.</h1><h1 id="Most-other-internal-time-limits-are-multiple-of-the-node-timeout"><a href="#Most-other-internal-time-limits-are-multiple-of-the-node-timeout" class="headerlink" title="Most other internal time limits are multiple of the node timeout."></a>Most other internal time limits are multiple of the node timeout.</h1><p>#</p>
<h1 id="cluster-node-timeout-15000"><a href="#cluster-node-timeout-15000" class="headerlink" title="cluster-node-timeout 15000"></a>cluster-node-timeout 15000</h1><h1 id="A-replica-of-a-failing-master-will-avoid-to-start-a-failover-if-its-data"><a href="#A-replica-of-a-failing-master-will-avoid-to-start-a-failover-if-its-data" class="headerlink" title="A replica of a failing master will avoid to start a failover if its data"></a>A replica of a failing master will avoid to start a failover if its data</h1><h1 id="looks-too-old"><a href="#looks-too-old" class="headerlink" title="looks too old."></a>looks too old.</h1><p>#</p>
<h1 id="There-is-no-simple-way-for-a-replica-to-actually-have-an-exact-measure-of"><a href="#There-is-no-simple-way-for-a-replica-to-actually-have-an-exact-measure-of" class="headerlink" title="There is no simple way for a replica to actually have an exact measure of"></a>There is no simple way for a replica to actually have an exact measure of</h1><h1 id="its-“data-age”-so-the-following-two-checks-are-performed"><a href="#its-“data-age”-so-the-following-two-checks-are-performed" class="headerlink" title="its “data age”, so the following two checks are performed:"></a>its “data age”, so the following two checks are performed:</h1><p>#</p>
<h1 id="1-If-there-are-multiple-replicas-able-to-failover-they-exchange-messages"><a href="#1-If-there-are-multiple-replicas-able-to-failover-they-exchange-messages" class="headerlink" title="1) If there are multiple replicas able to failover, they exchange messages"></a>1) If there are multiple replicas able to failover, they exchange messages</h1><h1 id="in-order-to-try-to-give-an-advantage-to-the-replica-with-the-best"><a href="#in-order-to-try-to-give-an-advantage-to-the-replica-with-the-best" class="headerlink" title="in order to try to give an advantage to the replica with the best"></a>in order to try to give an advantage to the replica with the best</h1><h1 id="replication-offset-more-data-from-the-master-processed"><a href="#replication-offset-more-data-from-the-master-processed" class="headerlink" title="replication offset (more data from the master processed)."></a>replication offset (more data from the master processed).</h1><h1 id="Replicas-will-try-to-get-their-rank-by-offset-and-apply-to-the-start"><a href="#Replicas-will-try-to-get-their-rank-by-offset-and-apply-to-the-start" class="headerlink" title="Replicas will try to get their rank by offset, and apply to the start"></a>Replicas will try to get their rank by offset, and apply to the start</h1><h1 id="of-the-failover-a-delay-proportional-to-their-rank"><a href="#of-the-failover-a-delay-proportional-to-their-rank" class="headerlink" title="of the failover a delay proportional to their rank."></a>of the failover a delay proportional to their rank.</h1><p>#</p>
<h1 id="2-Every-single-replica-computes-the-time-of-the-last-interaction-with"><a href="#2-Every-single-replica-computes-the-time-of-the-last-interaction-with" class="headerlink" title="2) Every single replica computes the time of the last interaction with"></a>2) Every single replica computes the time of the last interaction with</h1><h1 id="its-master-This-can-be-the-last-ping-or-command-received-if-the-master"><a href="#its-master-This-can-be-the-last-ping-or-command-received-if-the-master" class="headerlink" title="its master. This can be the last ping or command received (if the master"></a>its master. This can be the last ping or command received (if the master</h1><h1 id="is-still-in-the-“connected”-state-or-the-time-that-elapsed-since-the"><a href="#is-still-in-the-“connected”-state-or-the-time-that-elapsed-since-the" class="headerlink" title="is still in the “connected” state), or the time that elapsed since the"></a>is still in the “connected” state), or the time that elapsed since the</h1><h1 id="disconnection-with-the-master-if-the-replication-link-is-currently-down"><a href="#disconnection-with-the-master-if-the-replication-link-is-currently-down" class="headerlink" title="disconnection with the master (if the replication link is currently down)."></a>disconnection with the master (if the replication link is currently down).</h1><h1 id="If-the-last-interaction-is-too-old-the-replica-will-not-try-to-failover"><a href="#If-the-last-interaction-is-too-old-the-replica-will-not-try-to-failover" class="headerlink" title="If the last interaction is too old, the replica will not try to failover"></a>If the last interaction is too old, the replica will not try to failover</h1><h1 id="at-all"><a href="#at-all" class="headerlink" title="at all."></a>at all.</h1><p>#</p>
<h1 id="The-point-“2”-can-be-tuned-by-user-Specifically-a-replica-will-not-perform"><a href="#The-point-“2”-can-be-tuned-by-user-Specifically-a-replica-will-not-perform" class="headerlink" title="The point “2” can be tuned by user. Specifically a replica will not perform"></a>The point “2” can be tuned by user. Specifically a replica will not perform</h1><h1 id="the-failover-if-since-the-last-interaction-with-the-master-the-time"><a href="#the-failover-if-since-the-last-interaction-with-the-master-the-time" class="headerlink" title="the failover if, since the last interaction with the master, the time"></a>the failover if, since the last interaction with the master, the time</h1><h1 id="elapsed-is-greater-than"><a href="#elapsed-is-greater-than" class="headerlink" title="elapsed is greater than:"></a>elapsed is greater than:</h1><p>#</p>
<h1 id="node-timeout-replica-validity-factor-repl-ping-replica-period"><a href="#node-timeout-replica-validity-factor-repl-ping-replica-period" class="headerlink" title="(node-timeout * replica-validity-factor) + repl-ping-replica-period"></a>(node-timeout * replica-validity-factor) + repl-ping-replica-period</h1><p>#</p>
<h1 id="So-for-example-if-node-timeout-is-30-seconds-and-the-replica-validity-factor"><a href="#So-for-example-if-node-timeout-is-30-seconds-and-the-replica-validity-factor" class="headerlink" title="So for example if node-timeout is 30 seconds, and the replica-validity-factor"></a>So for example if node-timeout is 30 seconds, and the replica-validity-factor</h1><h1 id="is-10-and-assuming-a-default-repl-ping-replica-period-of-10-seconds-the"><a href="#is-10-and-assuming-a-default-repl-ping-replica-period-of-10-seconds-the" class="headerlink" title="is 10, and assuming a default repl-ping-replica-period of 10 seconds, the"></a>is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</h1><h1 id="replica-will-not-try-to-failover-if-it-was-not-able-to-talk-with-the-master"><a href="#replica-will-not-try-to-failover-if-it-was-not-able-to-talk-with-the-master" class="headerlink" title="replica will not try to failover if it was not able to talk with the master"></a>replica will not try to failover if it was not able to talk with the master</h1><h1 id="for-longer-than-310-seconds"><a href="#for-longer-than-310-seconds" class="headerlink" title="for longer than 310 seconds."></a>for longer than 310 seconds.</h1><p>#</p>
<h1 id="A-large-replica-validity-factor-may-allow-replicas-with-too-old-data-to-failover"><a href="#A-large-replica-validity-factor-may-allow-replicas-with-too-old-data-to-failover" class="headerlink" title="A large replica-validity-factor may allow replicas with too old data to failover"></a>A large replica-validity-factor may allow replicas with too old data to failover</h1><h1 id="a-master-while-a-too-small-value-may-prevent-the-cluster-from-being-able-to"><a href="#a-master-while-a-too-small-value-may-prevent-the-cluster-from-being-able-to" class="headerlink" title="a master, while a too small value may prevent the cluster from being able to"></a>a master, while a too small value may prevent the cluster from being able to</h1><h1 id="elect-a-replica-at-all"><a href="#elect-a-replica-at-all" class="headerlink" title="elect a replica at all."></a>elect a replica at all.</h1><p>#</p>
<h1 id="For-maximum-availability-it-is-possible-to-set-the-replica-validity-factor"><a href="#For-maximum-availability-it-is-possible-to-set-the-replica-validity-factor" class="headerlink" title="For maximum availability, it is possible to set the replica-validity-factor"></a>For maximum availability, it is possible to set the replica-validity-factor</h1><h1 id="to-a-value-of-0-which-means-that-replicas-will-always-try-to-failover-the"><a href="#to-a-value-of-0-which-means-that-replicas-will-always-try-to-failover-the" class="headerlink" title="to a value of 0, which means, that replicas will always try to failover the"></a>to a value of 0, which means, that replicas will always try to failover the</h1><h1 id="master-regardless-of-the-last-time-they-interacted-with-the-master"><a href="#master-regardless-of-the-last-time-they-interacted-with-the-master" class="headerlink" title="master regardless of the last time they interacted with the master."></a>master regardless of the last time they interacted with the master.</h1><h1 id="However-they’ll-always-try-to-apply-a-delay-proportional-to-their"><a href="#However-they’ll-always-try-to-apply-a-delay-proportional-to-their" class="headerlink" title="(However they’ll always try to apply a delay proportional to their"></a>(However they’ll always try to apply a delay proportional to their</h1><h1 id="offset-rank"><a href="#offset-rank" class="headerlink" title="offset rank)."></a>offset rank).</h1><p>#</p>
<h1 id="Zero-is-the-only-value-able-to-guarantee-that-when-all-the-partitions-heal"><a href="#Zero-is-the-only-value-able-to-guarantee-that-when-all-the-partitions-heal" class="headerlink" title="Zero is the only value able to guarantee that when all the partitions heal"></a>Zero is the only value able to guarantee that when all the partitions heal</h1><h1 id="the-cluster-will-always-be-able-to-continue"><a href="#the-cluster-will-always-be-able-to-continue" class="headerlink" title="the cluster will always be able to continue."></a>the cluster will always be able to continue.</h1><p>#</p>
<h1 id="cluster-replica-validity-factor-10"><a href="#cluster-replica-validity-factor-10" class="headerlink" title="cluster-replica-validity-factor 10"></a>cluster-replica-validity-factor 10</h1><h1 id="Cluster-replicas-are-able-to-migrate-to-orphaned-masters-that-are-masters"><a href="#Cluster-replicas-are-able-to-migrate-to-orphaned-masters-that-are-masters" class="headerlink" title="Cluster replicas are able to migrate to orphaned masters, that are masters"></a>Cluster replicas are able to migrate to orphaned masters, that are masters</h1><h1 id="that-are-left-without-working-replicas-This-improves-the-cluster-ability"><a href="#that-are-left-without-working-replicas-This-improves-the-cluster-ability" class="headerlink" title="that are left without working replicas. This improves the cluster ability"></a>that are left without working replicas. This improves the cluster ability</h1><h1 id="to-resist-to-failures-as-otherwise-an-orphaned-master-can’t-be-failed-over"><a href="#to-resist-to-failures-as-otherwise-an-orphaned-master-can’t-be-failed-over" class="headerlink" title="to resist to failures as otherwise an orphaned master can’t be failed over"></a>to resist to failures as otherwise an orphaned master can’t be failed over</h1><h1 id="in-case-of-failure-if-it-has-no-working-replicas"><a href="#in-case-of-failure-if-it-has-no-working-replicas" class="headerlink" title="in case of failure if it has no working replicas."></a>in case of failure if it has no working replicas.</h1><p>#</p>
<h1 id="Replicas-migrate-to-orphaned-masters-only-if-there-are-still-at-least-a"><a href="#Replicas-migrate-to-orphaned-masters-only-if-there-are-still-at-least-a" class="headerlink" title="Replicas migrate to orphaned masters only if there are still at least a"></a>Replicas migrate to orphaned masters only if there are still at least a</h1><h1 id="given-number-of-other-working-replicas-for-their-old-master-This-number"><a href="#given-number-of-other-working-replicas-for-their-old-master-This-number" class="headerlink" title="given number of other working replicas for their old master. This number"></a>given number of other working replicas for their old master. This number</h1><h1 id="is-the-“migration-barrier”-A-migration-barrier-of-1-means-that-a-replica"><a href="#is-the-“migration-barrier”-A-migration-barrier-of-1-means-that-a-replica" class="headerlink" title="is the “migration barrier”. A migration barrier of 1 means that a replica"></a>is the “migration barrier”. A migration barrier of 1 means that a replica</h1><h1 id="will-migrate-only-if-there-is-at-least-1-other-working-replica-for-its-master"><a href="#will-migrate-only-if-there-is-at-least-1-other-working-replica-for-its-master" class="headerlink" title="will migrate only if there is at least 1 other working replica for its master"></a>will migrate only if there is at least 1 other working replica for its master</h1><h1 id="and-so-forth-It-usually-reflects-the-number-of-replicas-you-want-for-every"><a href="#and-so-forth-It-usually-reflects-the-number-of-replicas-you-want-for-every" class="headerlink" title="and so forth. It usually reflects the number of replicas you want for every"></a>and so forth. It usually reflects the number of replicas you want for every</h1><h1 id="master-in-your-cluster"><a href="#master-in-your-cluster" class="headerlink" title="master in your cluster."></a>master in your cluster.</h1><p>#</p>
<h1 id="Default-is-1-replicas-migrate-only-if-their-masters-remain-with-at-least"><a href="#Default-is-1-replicas-migrate-only-if-their-masters-remain-with-at-least" class="headerlink" title="Default is 1 (replicas migrate only if their masters remain with at least"></a>Default is 1 (replicas migrate only if their masters remain with at least</h1><h1 id="one-replica-To-disable-migration-just-set-it-to-a-very-large-value"><a href="#one-replica-To-disable-migration-just-set-it-to-a-very-large-value" class="headerlink" title="one replica). To disable migration just set it to a very large value."></a>one replica). To disable migration just set it to a very large value.</h1><h1 id="A-value-of-0-can-be-set-but-is-useful-only-for-debugging-and-dangerous"><a href="#A-value-of-0-can-be-set-but-is-useful-only-for-debugging-and-dangerous" class="headerlink" title="A value of 0 can be set but is useful only for debugging and dangerous"></a>A value of 0 can be set but is useful only for debugging and dangerous</h1><h1 id="in-production"><a href="#in-production" class="headerlink" title="in production."></a>in production.</h1><p>#</p>
<h1 id="cluster-migration-barrier-1"><a href="#cluster-migration-barrier-1" class="headerlink" title="cluster-migration-barrier 1"></a>cluster-migration-barrier 1</h1><h1 id="By-default-Redis-Cluster-nodes-stop-accepting-queries-if-they-detect-there"><a href="#By-default-Redis-Cluster-nodes-stop-accepting-queries-if-they-detect-there" class="headerlink" title="By default Redis Cluster nodes stop accepting queries if they detect there"></a>By default Redis Cluster nodes stop accepting queries if they detect there</h1><h1 id="is-at-least-an-hash-slot-uncovered-no-available-node-is-serving-it"><a href="#is-at-least-an-hash-slot-uncovered-no-available-node-is-serving-it" class="headerlink" title="is at least an hash slot uncovered (no available node is serving it)."></a>is at least an hash slot uncovered (no available node is serving it).</h1><h1 id="This-way-if-the-cluster-is-partially-down-for-example-a-range-of-hash-slots"><a href="#This-way-if-the-cluster-is-partially-down-for-example-a-range-of-hash-slots" class="headerlink" title="This way if the cluster is partially down (for example a range of hash slots"></a>This way if the cluster is partially down (for example a range of hash slots</h1><h1 id="are-no-longer-covered-all-the-cluster-becomes-eventually-unavailable"><a href="#are-no-longer-covered-all-the-cluster-becomes-eventually-unavailable" class="headerlink" title="are no longer covered) all the cluster becomes, eventually, unavailable."></a>are no longer covered) all the cluster becomes, eventually, unavailable.</h1><h1 id="It-automatically-returns-available-as-soon-as-all-the-slots-are-covered-again"><a href="#It-automatically-returns-available-as-soon-as-all-the-slots-are-covered-again" class="headerlink" title="It automatically returns available as soon as all the slots are covered again."></a>It automatically returns available as soon as all the slots are covered again.</h1><p>#</p>
<h1 id="However-sometimes-you-want-the-subset-of-the-cluster-which-is-working"><a href="#However-sometimes-you-want-the-subset-of-the-cluster-which-is-working" class="headerlink" title="However sometimes you want the subset of the cluster which is working,"></a>However sometimes you want the subset of the cluster which is working,</h1><h1 id="to-continue-to-accept-queries-for-the-part-of-the-key-space-that-is-still"><a href="#to-continue-to-accept-queries-for-the-part-of-the-key-space-that-is-still" class="headerlink" title="to continue to accept queries for the part of the key space that is still"></a>to continue to accept queries for the part of the key space that is still</h1><h1 id="covered-In-order-to-do-so-just-set-the-cluster-require-full-coverage"><a href="#covered-In-order-to-do-so-just-set-the-cluster-require-full-coverage" class="headerlink" title="covered. In order to do so, just set the cluster-require-full-coverage"></a>covered. In order to do so, just set the cluster-require-full-coverage</h1><h1 id="option-to-no"><a href="#option-to-no" class="headerlink" title="option to no."></a>option to no.</h1><p>#</p>
<h1 id="cluster-require-full-coverage-yes"><a href="#cluster-require-full-coverage-yes" class="headerlink" title="cluster-require-full-coverage yes"></a>cluster-require-full-coverage yes</h1><h1 id="This-option-when-set-to-yes-prevents-replicas-from-trying-to-failover-its"><a href="#This-option-when-set-to-yes-prevents-replicas-from-trying-to-failover-its" class="headerlink" title="This option, when set to yes, prevents replicas from trying to failover its"></a>This option, when set to yes, prevents replicas from trying to failover its</h1><h1 id="master-during-master-failures-However-the-master-can-still-perform-a"><a href="#master-during-master-failures-However-the-master-can-still-perform-a" class="headerlink" title="master during master failures. However the master can still perform a"></a>master during master failures. However the master can still perform a</h1><h1 id="manual-failover-if-forced-to-do-so"><a href="#manual-failover-if-forced-to-do-so" class="headerlink" title="manual failover, if forced to do so."></a>manual failover, if forced to do so.</h1><p>#</p>
<h1 id="This-is-useful-in-different-scenarios-especially-in-the-case-of-multiple"><a href="#This-is-useful-in-different-scenarios-especially-in-the-case-of-multiple" class="headerlink" title="This is useful in different scenarios, especially in the case of multiple"></a>This is useful in different scenarios, especially in the case of multiple</h1><h1 id="data-center-operations-where-we-want-one-side-to-never-be-promoted-if-not"><a href="#data-center-operations-where-we-want-one-side-to-never-be-promoted-if-not" class="headerlink" title="data center operations, where we want one side to never be promoted if not"></a>data center operations, where we want one side to never be promoted if not</h1><h1 id="in-the-case-of-a-total-DC-failure"><a href="#in-the-case-of-a-total-DC-failure" class="headerlink" title="in the case of a total DC failure."></a>in the case of a total DC failure.</h1><p>#</p>
<h1 id="cluster-replica-no-failover-no"><a href="#cluster-replica-no-failover-no" class="headerlink" title="cluster-replica-no-failover no"></a>cluster-replica-no-failover no</h1><h1 id="In-order-to-setup-your-cluster-make-sure-to-read-the-documentation"><a href="#In-order-to-setup-your-cluster-make-sure-to-read-the-documentation" class="headerlink" title="In order to setup your cluster make sure to read the documentation"></a>In order to setup your cluster make sure to read the documentation</h1><h1 id="available-at-http-redis-io-web-site"><a href="#available-at-http-redis-io-web-site" class="headerlink" title="available at http://redis.io web site."></a>available at <a href="http://redis.io" target="_blank" rel="noopener">http://redis.io</a> web site.</h1><p>########################## CLUSTER DOCKER/NAT support  ########################</p>
<h1 id="In-certain-deployments-Redis-Cluster-nodes-address-discovery-fails-because"><a href="#In-certain-deployments-Redis-Cluster-nodes-address-discovery-fails-because" class="headerlink" title="In certain deployments, Redis Cluster nodes address discovery fails, because"></a>In certain deployments, Redis Cluster nodes address discovery fails, because</h1><h1 id="addresses-are-NAT-ted-or-because-ports-are-forwarded-the-typical-case-is"><a href="#addresses-are-NAT-ted-or-because-ports-are-forwarded-the-typical-case-is" class="headerlink" title="addresses are NAT-ted or because ports are forwarded (the typical case is"></a>addresses are NAT-ted or because ports are forwarded (the typical case is</h1><h1 id="Docker-and-other-containers"><a href="#Docker-and-other-containers" class="headerlink" title="Docker and other containers)."></a>Docker and other containers).</h1><p>#</p>
<h1 id="In-order-to-make-Redis-Cluster-working-in-such-environments-a-static"><a href="#In-order-to-make-Redis-Cluster-working-in-such-environments-a-static" class="headerlink" title="In order to make Redis Cluster working in such environments, a static"></a>In order to make Redis Cluster working in such environments, a static</h1><h1 id="configuration-where-each-node-knows-its-public-address-is-needed-The"><a href="#configuration-where-each-node-knows-its-public-address-is-needed-The" class="headerlink" title="configuration where each node knows its public address is needed. The"></a>configuration where each node knows its public address is needed. The</h1><h1 id="following-two-options-are-used-for-this-scope-and-are"><a href="#following-two-options-are-used-for-this-scope-and-are" class="headerlink" title="following two options are used for this scope, and are:"></a>following two options are used for this scope, and are:</h1><p>#</p>
<h1 id="cluster-announce-ip"><a href="#cluster-announce-ip" class="headerlink" title="* cluster-announce-ip"></a>* cluster-announce-ip</h1><h1 id="cluster-announce-port"><a href="#cluster-announce-port" class="headerlink" title="* cluster-announce-port"></a>* cluster-announce-port</h1><h1 id="cluster-announce-bus-port"><a href="#cluster-announce-bus-port" class="headerlink" title="* cluster-announce-bus-port"></a>* cluster-announce-bus-port</h1><p>#</p>
<h1 id="Each-instruct-the-node-about-its-address-client-port-and-cluster-message"><a href="#Each-instruct-the-node-about-its-address-client-port-and-cluster-message" class="headerlink" title="Each instruct the node about its address, client port, and cluster message"></a>Each instruct the node about its address, client port, and cluster message</h1><h1 id="bus-port-The-information-is-then-published-in-the-header-of-the-bus-packets"><a href="#bus-port-The-information-is-then-published-in-the-header-of-the-bus-packets" class="headerlink" title="bus port. The information is then published in the header of the bus packets"></a>bus port. The information is then published in the header of the bus packets</h1><h1 id="so-that-other-nodes-will-be-able-to-correctly-map-the-address-of-the-node"><a href="#so-that-other-nodes-will-be-able-to-correctly-map-the-address-of-the-node" class="headerlink" title="so that other nodes will be able to correctly map the address of the node"></a>so that other nodes will be able to correctly map the address of the node</h1><h1 id="publishing-the-information"><a href="#publishing-the-information" class="headerlink" title="publishing the information."></a>publishing the information.</h1><p>#</p>
<h1 id="If-the-above-options-are-not-used-the-normal-Redis-Cluster-auto-detection"><a href="#If-the-above-options-are-not-used-the-normal-Redis-Cluster-auto-detection" class="headerlink" title="If the above options are not used, the normal Redis Cluster auto-detection"></a>If the above options are not used, the normal Redis Cluster auto-detection</h1><h1 id="will-be-used-instead"><a href="#will-be-used-instead" class="headerlink" title="will be used instead."></a>will be used instead.</h1><p>#</p>
<h1 id="Note-that-when-remapped-the-bus-port-may-not-be-at-the-fixed-offset-of"><a href="#Note-that-when-remapped-the-bus-port-may-not-be-at-the-fixed-offset-of" class="headerlink" title="Note that when remapped, the bus port may not be at the fixed offset of"></a>Note that when remapped, the bus port may not be at the fixed offset of</h1><h1 id="clients-port-10000-so-you-can-specify-any-port-and-bus-port-depending"><a href="#clients-port-10000-so-you-can-specify-any-port-and-bus-port-depending" class="headerlink" title="clients port + 10000, so you can specify any port and bus-port depending"></a>clients port + 10000, so you can specify any port and bus-port depending</h1><h1 id="on-how-they-get-remapped-If-the-bus-port-is-not-set-a-fixed-offset-of"><a href="#on-how-they-get-remapped-If-the-bus-port-is-not-set-a-fixed-offset-of" class="headerlink" title="on how they get remapped. If the bus-port is not set, a fixed offset of"></a>on how they get remapped. If the bus-port is not set, a fixed offset of</h1><h1 id="10000-will-be-used-as-usually"><a href="#10000-will-be-used-as-usually" class="headerlink" title="10000 will be used as usually."></a>10000 will be used as usually.</h1><p>#</p>
<h1 id="Example-1"><a href="#Example-1" class="headerlink" title="Example:"></a>Example:</h1><p>#</p>
<h1 id="cluster-announce-ip-10-1-1-5"><a href="#cluster-announce-ip-10-1-1-5" class="headerlink" title="cluster-announce-ip 10.1.1.5"></a>cluster-announce-ip 10.1.1.5</h1><h1 id="cluster-announce-port-6379"><a href="#cluster-announce-port-6379" class="headerlink" title="cluster-announce-port 6379"></a>cluster-announce-port 6379</h1><h1 id="cluster-announce-bus-port-6380"><a href="#cluster-announce-bus-port-6380" class="headerlink" title="cluster-announce-bus-port 6380"></a>cluster-announce-bus-port 6380</h1><p>################################## SLOW LOG ###################################</p>
<h1 id="The-Redis-Slow-Log-is-a-system-to-log-queries-that-exceeded-a-specified"><a href="#The-Redis-Slow-Log-is-a-system-to-log-queries-that-exceeded-a-specified" class="headerlink" title="The Redis Slow Log is a system to log queries that exceeded a specified"></a>The Redis Slow Log is a system to log queries that exceeded a specified</h1><h1 id="execution-time-The-execution-time-does-not-include-the-I-O-operations"><a href="#execution-time-The-execution-time-does-not-include-the-I-O-operations" class="headerlink" title="execution time. The execution time does not include the I/O operations"></a>execution time. The execution time does not include the I/O operations</h1><h1 id="like-talking-with-the-client-sending-the-reply-and-so-forth"><a href="#like-talking-with-the-client-sending-the-reply-and-so-forth" class="headerlink" title="like talking with the client, sending the reply and so forth,"></a>like talking with the client, sending the reply and so forth,</h1><h1 id="but-just-the-time-needed-to-actually-execute-the-command-this-is-the-only"><a href="#but-just-the-time-needed-to-actually-execute-the-command-this-is-the-only" class="headerlink" title="but just the time needed to actually execute the command (this is the only"></a>but just the time needed to actually execute the command (this is the only</h1><h1 id="stage-of-command-execution-where-the-thread-is-blocked-and-can-not-serve"><a href="#stage-of-command-execution-where-the-thread-is-blocked-and-can-not-serve" class="headerlink" title="stage of command execution where the thread is blocked and can not serve"></a>stage of command execution where the thread is blocked and can not serve</h1><h1 id="other-requests-in-the-meantime"><a href="#other-requests-in-the-meantime" class="headerlink" title="other requests in the meantime)."></a>other requests in the meantime).</h1><p>#</p>
<h1 id="You-can-configure-the-slow-log-with-two-parameters-one-tells-Redis"><a href="#You-can-configure-the-slow-log-with-two-parameters-one-tells-Redis" class="headerlink" title="You can configure the slow log with two parameters: one tells Redis"></a>You can configure the slow log with two parameters: one tells Redis</h1><h1 id="what-is-the-execution-time-in-microseconds-to-exceed-in-order-for-the"><a href="#what-is-the-execution-time-in-microseconds-to-exceed-in-order-for-the" class="headerlink" title="what is the execution time, in microseconds, to exceed in order for the"></a>what is the execution time, in microseconds, to exceed in order for the</h1><h1 id="command-to-get-logged-and-the-other-parameter-is-the-length-of-the"><a href="#command-to-get-logged-and-the-other-parameter-is-the-length-of-the" class="headerlink" title="command to get logged, and the other parameter is the length of the"></a>command to get logged, and the other parameter is the length of the</h1><h1 id="slow-log-When-a-new-command-is-logged-the-oldest-one-is-removed-from-the"><a href="#slow-log-When-a-new-command-is-logged-the-oldest-one-is-removed-from-the" class="headerlink" title="slow log. When a new command is logged the oldest one is removed from the"></a>slow log. When a new command is logged the oldest one is removed from the</h1><h1 id="queue-of-logged-commands"><a href="#queue-of-logged-commands" class="headerlink" title="queue of logged commands."></a>queue of logged commands.</h1><h1 id="The-following-time-is-expressed-in-microseconds-so-1000000-is-equivalent"><a href="#The-following-time-is-expressed-in-microseconds-so-1000000-is-equivalent" class="headerlink" title="The following time is expressed in microseconds, so 1000000 is equivalent"></a>The following time is expressed in microseconds, so 1000000 is equivalent</h1><h1 id="to-one-second-Note-that-a-negative-number-disables-the-slow-log-while"><a href="#to-one-second-Note-that-a-negative-number-disables-the-slow-log-while" class="headerlink" title="to one second. Note that a negative number disables the slow log, while"></a>to one second. Note that a negative number disables the slow log, while</h1><h1 id="a-value-of-zero-forces-the-logging-of-every-command"><a href="#a-value-of-zero-forces-the-logging-of-every-command" class="headerlink" title="a value of zero forces the logging of every command."></a>a value of zero forces the logging of every command.</h1><p>slowlog-log-slower-than 10000</p>
<h1 id="There-is-no-limit-to-this-length-Just-be-aware-that-it-will-consume-memory"><a href="#There-is-no-limit-to-this-length-Just-be-aware-that-it-will-consume-memory" class="headerlink" title="There is no limit to this length. Just be aware that it will consume memory."></a>There is no limit to this length. Just be aware that it will consume memory.</h1><h1 id="You-can-reclaim-memory-used-by-the-slow-log-with-SLOWLOG-RESET"><a href="#You-can-reclaim-memory-used-by-the-slow-log-with-SLOWLOG-RESET" class="headerlink" title="You can reclaim memory used by the slow log with SLOWLOG RESET."></a>You can reclaim memory used by the slow log with SLOWLOG RESET.</h1><p>slowlog-max-len 128</p>
<p>################################ LATENCY MONITOR ##############################</p>
<h1 id="The-Redis-latency-monitoring-subsystem-samples-different-operations"><a href="#The-Redis-latency-monitoring-subsystem-samples-different-operations" class="headerlink" title="The Redis latency monitoring subsystem samples different operations"></a>The Redis latency monitoring subsystem samples different operations</h1><h1 id="at-runtime-in-order-to-collect-data-related-to-possible-sources-of"><a href="#at-runtime-in-order-to-collect-data-related-to-possible-sources-of" class="headerlink" title="at runtime in order to collect data related to possible sources of"></a>at runtime in order to collect data related to possible sources of</h1><h1 id="latency-of-a-Redis-instance"><a href="#latency-of-a-Redis-instance" class="headerlink" title="latency of a Redis instance."></a>latency of a Redis instance.</h1><p>#</p>
<h1 id="Via-the-LATENCY-command-this-information-is-available-to-the-user-that-can"><a href="#Via-the-LATENCY-command-this-information-is-available-to-the-user-that-can" class="headerlink" title="Via the LATENCY command this information is available to the user that can"></a>Via the LATENCY command this information is available to the user that can</h1><h1 id="print-graphs-and-obtain-reports"><a href="#print-graphs-and-obtain-reports" class="headerlink" title="print graphs and obtain reports."></a>print graphs and obtain reports.</h1><p>#</p>
<h1 id="The-system-only-logs-operations-that-were-performed-in-a-time-equal-or"><a href="#The-system-only-logs-operations-that-were-performed-in-a-time-equal-or" class="headerlink" title="The system only logs operations that were performed in a time equal or"></a>The system only logs operations that were performed in a time equal or</h1><h1 id="greater-than-the-amount-of-milliseconds-specified-via-the"><a href="#greater-than-the-amount-of-milliseconds-specified-via-the" class="headerlink" title="greater than the amount of milliseconds specified via the"></a>greater than the amount of milliseconds specified via the</h1><h1 id="latency-monitor-threshold-configuration-directive-When-its-value-is-set"><a href="#latency-monitor-threshold-configuration-directive-When-its-value-is-set" class="headerlink" title="latency-monitor-threshold configuration directive. When its value is set"></a>latency-monitor-threshold configuration directive. When its value is set</h1><h1 id="to-zero-the-latency-monitor-is-turned-off"><a href="#to-zero-the-latency-monitor-is-turned-off" class="headerlink" title="to zero, the latency monitor is turned off."></a>to zero, the latency monitor is turned off.</h1><p>#</p>
<h1 id="By-default-latency-monitoring-is-disabled-since-it-is-mostly-not-needed"><a href="#By-default-latency-monitoring-is-disabled-since-it-is-mostly-not-needed" class="headerlink" title="By default latency monitoring is disabled since it is mostly not needed"></a>By default latency monitoring is disabled since it is mostly not needed</h1><h1 id="if-you-don’t-have-latency-issues-and-collecting-data-has-a-performance"><a href="#if-you-don’t-have-latency-issues-and-collecting-data-has-a-performance" class="headerlink" title="if you don’t have latency issues, and collecting data has a performance"></a>if you don’t have latency issues, and collecting data has a performance</h1><h1 id="impact-that-while-very-small-can-be-measured-under-big-load-Latency"><a href="#impact-that-while-very-small-can-be-measured-under-big-load-Latency" class="headerlink" title="impact, that while very small, can be measured under big load. Latency"></a>impact, that while very small, can be measured under big load. Latency</h1><h1 id="monitoring-can-easily-be-enabled-at-runtime-using-the-command"><a href="#monitoring-can-easily-be-enabled-at-runtime-using-the-command" class="headerlink" title="monitoring can easily be enabled at runtime using the command"></a>monitoring can easily be enabled at runtime using the command</h1><h1 id="“CONFIG-SET-latency-monitor-threshold-“-if-needed"><a href="#“CONFIG-SET-latency-monitor-threshold-“-if-needed" class="headerlink" title="“CONFIG SET latency-monitor-threshold “ if needed."></a>“CONFIG SET latency-monitor-threshold <milliseconds>“ if needed.</milliseconds></h1><p>latency-monitor-threshold 0</p>
<p>############################# EVENT NOTIFICATION ##############################</p>
<h1 id="Redis-can-notify-Pub-Sub-clients-about-events-happening-in-the-key-space"><a href="#Redis-can-notify-Pub-Sub-clients-about-events-happening-in-the-key-space" class="headerlink" title="Redis can notify Pub/Sub clients about events happening in the key space."></a>Redis can notify Pub/Sub clients about events happening in the key space.</h1><h1 id="This-feature-is-documented-at-http-redis-io-topics-notifications"><a href="#This-feature-is-documented-at-http-redis-io-topics-notifications" class="headerlink" title="This feature is documented at http://redis.io/topics/notifications"></a>This feature is documented at <a href="http://redis.io/topics/notifications" target="_blank" rel="noopener">http://redis.io/topics/notifications</a></h1><p>#</p>
<h1 id="For-instance-if-keyspace-events-notification-is-enabled-and-a-client"><a href="#For-instance-if-keyspace-events-notification-is-enabled-and-a-client" class="headerlink" title="For instance if keyspace events notification is enabled, and a client"></a>For instance if keyspace events notification is enabled, and a client</h1><h1 id="performs-a-DEL-operation-on-key-“foo”-stored-in-the-Database-0-two"><a href="#performs-a-DEL-operation-on-key-“foo”-stored-in-the-Database-0-two" class="headerlink" title="performs a DEL operation on key “foo” stored in the Database 0, two"></a>performs a DEL operation on key “foo” stored in the Database 0, two</h1><h1 id="messages-will-be-published-via-Pub-Sub"><a href="#messages-will-be-published-via-Pub-Sub" class="headerlink" title="messages will be published via Pub/Sub:"></a>messages will be published via Pub/Sub:</h1><p>#</p>
<h1 id="PUBLISH-keyspace-0-foo-del"><a href="#PUBLISH-keyspace-0-foo-del" class="headerlink" title="PUBLISH keyspace@0:foo del"></a>PUBLISH <strong>keyspace@0</strong>:foo del</h1><h1 id="PUBLISH-keyevent-0-del-foo"><a href="#PUBLISH-keyevent-0-del-foo" class="headerlink" title="PUBLISH keyevent@0:del foo"></a>PUBLISH <strong>keyevent@0</strong>:del foo</h1><p>#</p>
<h1 id="It-is-possible-to-select-the-events-that-Redis-will-notify-among-a-set"><a href="#It-is-possible-to-select-the-events-that-Redis-will-notify-among-a-set" class="headerlink" title="It is possible to select the events that Redis will notify among a set"></a>It is possible to select the events that Redis will notify among a set</h1><h1 id="of-classes-Every-class-is-identified-by-a-single-character"><a href="#of-classes-Every-class-is-identified-by-a-single-character" class="headerlink" title="of classes. Every class is identified by a single character:"></a>of classes. Every class is identified by a single character:</h1><p>#</p>
<h1 id="K-Keyspace-events-published-with-keyspace-prefix"><a href="#K-Keyspace-events-published-with-keyspace-prefix" class="headerlink" title="K     Keyspace events, published with keyspace@ prefix."></a>K     Keyspace events, published with <strong>keyspace@<db></db></strong> prefix.</h1><h1 id="E-Keyevent-events-published-with-keyevent-prefix"><a href="#E-Keyevent-events-published-with-keyevent-prefix" class="headerlink" title="E     Keyevent events, published with keyevent@ prefix."></a>E     Keyevent events, published with <strong>keyevent@<db></db></strong> prefix.</h1><h1 id="g-Generic-commands-non-type-specific-like-DEL-EXPIRE-RENAME-…"><a href="#g-Generic-commands-non-type-specific-like-DEL-EXPIRE-RENAME-…" class="headerlink" title="g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, …"></a>g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, …</h1><h1 id="String-commands"><a href="#String-commands" class="headerlink" title="$     String commands"></a>$     String commands</h1><h1 id="l-List-commands"><a href="#l-List-commands" class="headerlink" title="l     List commands"></a>l     List commands</h1><h1 id="s-Set-commands"><a href="#s-Set-commands" class="headerlink" title="s     Set commands"></a>s     Set commands</h1><h1 id="h-Hash-commands"><a href="#h-Hash-commands" class="headerlink" title="h     Hash commands"></a>h     Hash commands</h1><h1 id="z-Sorted-set-commands"><a href="#z-Sorted-set-commands" class="headerlink" title="z     Sorted set commands"></a>z     Sorted set commands</h1><h1 id="x-Expired-events-events-generated-every-time-a-key-expires"><a href="#x-Expired-events-events-generated-every-time-a-key-expires" class="headerlink" title="x     Expired events (events generated every time a key expires)"></a>x     Expired events (events generated every time a key expires)</h1><h1 id="e-Evicted-events-events-generated-when-a-key-is-evicted-for-maxmemory"><a href="#e-Evicted-events-events-generated-when-a-key-is-evicted-for-maxmemory" class="headerlink" title="e     Evicted events (events generated when a key is evicted for maxmemory)"></a>e     Evicted events (events generated when a key is evicted for maxmemory)</h1><h1 id="A-Alias-for-g-lshzxe-so-that-the-“AKE”-string-means-all-the-events"><a href="#A-Alias-for-g-lshzxe-so-that-the-“AKE”-string-means-all-the-events" class="headerlink" title="A     Alias for g$lshzxe, so that the “AKE” string means all the events."></a>A     Alias for g$lshzxe, so that the “AKE” string means all the events.</h1><p>#</p>
<h1 id="The-“notify-keyspace-events”-takes-as-argument-a-string-that-is-composed"><a href="#The-“notify-keyspace-events”-takes-as-argument-a-string-that-is-composed" class="headerlink" title="The “notify-keyspace-events” takes as argument a string that is composed"></a>The “notify-keyspace-events” takes as argument a string that is composed</h1><h1 id="of-zero-or-multiple-characters-The-empty-string-means-that-notifications"><a href="#of-zero-or-multiple-characters-The-empty-string-means-that-notifications" class="headerlink" title="of zero or multiple characters. The empty string means that notifications"></a>of zero or multiple characters. The empty string means that notifications</h1><h1 id="are-disabled"><a href="#are-disabled" class="headerlink" title="are disabled."></a>are disabled.</h1><p>#</p>
<h1 id="Example-to-enable-list-and-generic-events-from-the-point-of-view-of-the"><a href="#Example-to-enable-list-and-generic-events-from-the-point-of-view-of-the" class="headerlink" title="Example: to enable list and generic events, from the point of view of the"></a>Example: to enable list and generic events, from the point of view of the</h1><h1 id="event-name-use"><a href="#event-name-use" class="headerlink" title="event name, use:"></a>event name, use:</h1><p>#</p>
<h1 id="notify-keyspace-events-Elg"><a href="#notify-keyspace-events-Elg" class="headerlink" title="notify-keyspace-events Elg"></a>notify-keyspace-events Elg</h1><p>#</p>
<h1 id="Example-2-to-get-the-stream-of-the-expired-keys-subscribing-to-channel"><a href="#Example-2-to-get-the-stream-of-the-expired-keys-subscribing-to-channel" class="headerlink" title="Example 2: to get the stream of the expired keys subscribing to channel"></a>Example 2: to get the stream of the expired keys subscribing to channel</h1><h1 id="name-keyevent-0-expired-use"><a href="#name-keyevent-0-expired-use" class="headerlink" title="name keyevent@0:expired use:"></a>name <strong>keyevent@0</strong>:expired use:</h1><p>#</p>
<h1 id="notify-keyspace-events-Ex"><a href="#notify-keyspace-events-Ex" class="headerlink" title="notify-keyspace-events Ex"></a>notify-keyspace-events Ex</h1><p>#</p>
<h1 id="By-default-all-notifications-are-disabled-because-most-users-don’t-need"><a href="#By-default-all-notifications-are-disabled-because-most-users-don’t-need" class="headerlink" title="By default all notifications are disabled because most users don’t need"></a>By default all notifications are disabled because most users don’t need</h1><h1 id="this-feature-and-the-feature-has-some-overhead-Note-that-if-you-don’t"><a href="#this-feature-and-the-feature-has-some-overhead-Note-that-if-you-don’t" class="headerlink" title="this feature and the feature has some overhead. Note that if you don’t"></a>this feature and the feature has some overhead. Note that if you don’t</h1><h1 id="specify-at-least-one-of-K-or-E-no-events-will-be-delivered"><a href="#specify-at-least-one-of-K-or-E-no-events-will-be-delivered" class="headerlink" title="specify at least one of K or E, no events will be delivered."></a>specify at least one of K or E, no events will be delivered.</h1><p>notify-keyspace-events “”</p>
<p>############################### ADVANCED CONFIG ###############################</p>
<h1 id="Hashes-are-encoded-using-a-memory-efficient-data-structure-when-they-have-a"><a href="#Hashes-are-encoded-using-a-memory-efficient-data-structure-when-they-have-a" class="headerlink" title="Hashes are encoded using a memory efficient data structure when they have a"></a>Hashes are encoded using a memory efficient data structure when they have a</h1><h1 id="small-number-of-entries-and-the-biggest-entry-does-not-exceed-a-given"><a href="#small-number-of-entries-and-the-biggest-entry-does-not-exceed-a-given" class="headerlink" title="small number of entries, and the biggest entry does not exceed a given"></a>small number of entries, and the biggest entry does not exceed a given</h1><h1 id="threshold-These-thresholds-can-be-configured-using-the-following-directives"><a href="#threshold-These-thresholds-can-be-configured-using-the-following-directives" class="headerlink" title="threshold. These thresholds can be configured using the following directives."></a>threshold. These thresholds can be configured using the following directives.</h1><p>hash-max-ziplist-entries 512<br>hash-max-ziplist-value 64</p>
<h1 id="Lists-are-also-encoded-in-a-special-way-to-save-a-lot-of-space"><a href="#Lists-are-also-encoded-in-a-special-way-to-save-a-lot-of-space" class="headerlink" title="Lists are also encoded in a special way to save a lot of space."></a>Lists are also encoded in a special way to save a lot of space.</h1><h1 id="The-number-of-entries-allowed-per-internal-list-node-can-be-specified"><a href="#The-number-of-entries-allowed-per-internal-list-node-can-be-specified" class="headerlink" title="The number of entries allowed per internal list node can be specified"></a>The number of entries allowed per internal list node can be specified</h1><h1 id="as-a-fixed-maximum-size-or-a-maximum-number-of-elements"><a href="#as-a-fixed-maximum-size-or-a-maximum-number-of-elements" class="headerlink" title="as a fixed maximum size or a maximum number of elements."></a>as a fixed maximum size or a maximum number of elements.</h1><h1 id="For-a-fixed-maximum-size-use-5-through-1-meaning"><a href="#For-a-fixed-maximum-size-use-5-through-1-meaning" class="headerlink" title="For a fixed maximum size, use -5 through -1, meaning:"></a>For a fixed maximum size, use -5 through -1, meaning:</h1><h1 id="5-max-size-64-Kb-lt-–-not-recommended-for-normal-workloads"><a href="#5-max-size-64-Kb-lt-–-not-recommended-for-normal-workloads" class="headerlink" title="-5: max size: 64 Kb  &lt;– not recommended for normal workloads"></a>-5: max size: 64 Kb  &lt;– not recommended for normal workloads</h1><h1 id="4-max-size-32-Kb-lt-–-not-recommended"><a href="#4-max-size-32-Kb-lt-–-not-recommended" class="headerlink" title="-4: max size: 32 Kb  &lt;– not recommended"></a>-4: max size: 32 Kb  &lt;– not recommended</h1><h1 id="3-max-size-16-Kb-lt-–-probably-not-recommended"><a href="#3-max-size-16-Kb-lt-–-probably-not-recommended" class="headerlink" title="-3: max size: 16 Kb  &lt;– probably not recommended"></a>-3: max size: 16 Kb  &lt;– probably not recommended</h1><h1 id="2-max-size-8-Kb-lt-–-good"><a href="#2-max-size-8-Kb-lt-–-good" class="headerlink" title="-2: max size: 8 Kb   &lt;– good"></a>-2: max size: 8 Kb   &lt;– good</h1><h1 id="1-max-size-4-Kb-lt-–-good"><a href="#1-max-size-4-Kb-lt-–-good" class="headerlink" title="-1: max size: 4 Kb   &lt;– good"></a>-1: max size: 4 Kb   &lt;– good</h1><h1 id="Positive-numbers-mean-store-up-to-exactly-that-number-of-elements"><a href="#Positive-numbers-mean-store-up-to-exactly-that-number-of-elements" class="headerlink" title="Positive numbers mean store up to exactly that number of elements"></a>Positive numbers mean store up to <em>exactly</em> that number of elements</h1><h1 id="per-list-node"><a href="#per-list-node" class="headerlink" title="per list node."></a>per list node.</h1><h1 id="The-highest-performing-option-is-usually-2-8-Kb-size-or-1-4-Kb-size"><a href="#The-highest-performing-option-is-usually-2-8-Kb-size-or-1-4-Kb-size" class="headerlink" title="The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),"></a>The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</h1><h1 id="but-if-your-use-case-is-unique-adjust-the-settings-as-necessary"><a href="#but-if-your-use-case-is-unique-adjust-the-settings-as-necessary" class="headerlink" title="but if your use case is unique, adjust the settings as necessary."></a>but if your use case is unique, adjust the settings as necessary.</h1><p>list-max-ziplist-size -2</p>
<h1 id="Lists-may-also-be-compressed"><a href="#Lists-may-also-be-compressed" class="headerlink" title="Lists may also be compressed."></a>Lists may also be compressed.</h1><h1 id="Compress-depth-is-the-number-of-quicklist-ziplist-nodes-from-each-side-of"><a href="#Compress-depth-is-the-number-of-quicklist-ziplist-nodes-from-each-side-of" class="headerlink" title="Compress depth is the number of quicklist ziplist nodes from each side of"></a>Compress depth is the number of quicklist ziplist nodes from <em>each</em> side of</h1><h1 id="the-list-to-exclude-from-compression-The-head-and-tail-of-the-list"><a href="#the-list-to-exclude-from-compression-The-head-and-tail-of-the-list" class="headerlink" title="the list to exclude from compression.  The head and tail of the list"></a>the list to <em>exclude</em> from compression.  The head and tail of the list</h1><h1 id="are-always-uncompressed-for-fast-push-pop-operations-Settings-are"><a href="#are-always-uncompressed-for-fast-push-pop-operations-Settings-are" class="headerlink" title="are always uncompressed for fast push/pop operations.  Settings are:"></a>are always uncompressed for fast push/pop operations.  Settings are:</h1><h1 id="0-disable-all-list-compression"><a href="#0-disable-all-list-compression" class="headerlink" title="0: disable all list compression"></a>0: disable all list compression</h1><h1 id="1-depth-1-means-“don’t-start-compressing-until-after-1-node-into-the-list"><a href="#1-depth-1-means-“don’t-start-compressing-until-after-1-node-into-the-list" class="headerlink" title="1: depth 1 means “don’t start compressing until after 1 node into the list,"></a>1: depth 1 means “don’t start compressing until after 1 node into the list,</h1><h1 id="going-from-either-the-head-or-tail”"><a href="#going-from-either-the-head-or-tail”" class="headerlink" title="going from either the head or tail”"></a>going from either the head or tail”</h1><h1 id="So-head-gt-node-gt-node-gt-…-gt-node-gt-tail"><a href="#So-head-gt-node-gt-node-gt-…-gt-node-gt-tail" class="headerlink" title="So: [head]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[tail]"></a>So: [head]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[tail]</h1><h1 id="head-tail-will-always-be-uncompressed-inner-nodes-will-compress"><a href="#head-tail-will-always-be-uncompressed-inner-nodes-will-compress" class="headerlink" title="[head], [tail] will always be uncompressed; inner nodes will compress."></a>[head], [tail] will always be uncompressed; inner nodes will compress.</h1><h1 id="2-head-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-tail"><a href="#2-head-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-tail" class="headerlink" title="2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[tail]"></a>2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[tail]</h1><h1 id="2-here-means-don’t-compress-head-or-head-gt-next-or-tail-gt-prev-or-tail"><a href="#2-here-means-don’t-compress-head-or-head-gt-next-or-tail-gt-prev-or-tail" class="headerlink" title="2 here means: don’t compress head or head-&gt;next or tail-&gt;prev or tail,"></a>2 here means: don’t compress head or head-&gt;next or tail-&gt;prev or tail,</h1><h1 id="but-compress-all-nodes-between-them"><a href="#but-compress-all-nodes-between-them" class="headerlink" title="but compress all nodes between them."></a>but compress all nodes between them.</h1><h1 id="3-head-gt-next-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-prev-gt-tail"><a href="#3-head-gt-next-gt-next-gt-node-gt-node-gt-…-gt-node-gt-prev-gt-prev-gt-tail" class="headerlink" title="3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]"></a>3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;…-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</h1><h1 id="etc"><a href="#etc" class="headerlink" title="etc."></a>etc.</h1><p>list-compress-depth 0</p>
<h1 id="Sets-have-a-special-encoding-in-just-one-case-when-a-set-is-composed"><a href="#Sets-have-a-special-encoding-in-just-one-case-when-a-set-is-composed" class="headerlink" title="Sets have a special encoding in just one case: when a set is composed"></a>Sets have a special encoding in just one case: when a set is composed</h1><h1 id="of-just-strings-that-happen-to-be-integers-in-radix-10-in-the-range"><a href="#of-just-strings-that-happen-to-be-integers-in-radix-10-in-the-range" class="headerlink" title="of just strings that happen to be integers in radix 10 in the range"></a>of just strings that happen to be integers in radix 10 in the range</h1><h1 id="of-64-bit-signed-integers"><a href="#of-64-bit-signed-integers" class="headerlink" title="of 64 bit signed integers."></a>of 64 bit signed integers.</h1><h1 id="The-following-configuration-setting-sets-the-limit-in-the-size-of-the"><a href="#The-following-configuration-setting-sets-the-limit-in-the-size-of-the" class="headerlink" title="The following configuration setting sets the limit in the size of the"></a>The following configuration setting sets the limit in the size of the</h1><h1 id="set-in-order-to-use-this-special-memory-saving-encoding"><a href="#set-in-order-to-use-this-special-memory-saving-encoding" class="headerlink" title="set in order to use this special memory saving encoding."></a>set in order to use this special memory saving encoding.</h1><p>set-max-intset-entries 512</p>
<h1 id="Similarly-to-hashes-and-lists-sorted-sets-are-also-specially-encoded-in"><a href="#Similarly-to-hashes-and-lists-sorted-sets-are-also-specially-encoded-in" class="headerlink" title="Similarly to hashes and lists, sorted sets are also specially encoded in"></a>Similarly to hashes and lists, sorted sets are also specially encoded in</h1><h1 id="order-to-save-a-lot-of-space-This-encoding-is-only-used-when-the-length-and"><a href="#order-to-save-a-lot-of-space-This-encoding-is-only-used-when-the-length-and" class="headerlink" title="order to save a lot of space. This encoding is only used when the length and"></a>order to save a lot of space. This encoding is only used when the length and</h1><h1 id="elements-of-a-sorted-set-are-below-the-following-limits"><a href="#elements-of-a-sorted-set-are-below-the-following-limits" class="headerlink" title="elements of a sorted set are below the following limits:"></a>elements of a sorted set are below the following limits:</h1><p>zset-max-ziplist-entries 128<br>zset-max-ziplist-value 64</p>
<h1 id="HyperLogLog-sparse-representation-bytes-limit-The-limit-includes-the"><a href="#HyperLogLog-sparse-representation-bytes-limit-The-limit-includes-the" class="headerlink" title="HyperLogLog sparse representation bytes limit. The limit includes the"></a>HyperLogLog sparse representation bytes limit. The limit includes the</h1><h1 id="16-bytes-header-When-an-HyperLogLog-using-the-sparse-representation-crosses"><a href="#16-bytes-header-When-an-HyperLogLog-using-the-sparse-representation-crosses" class="headerlink" title="16 bytes header. When an HyperLogLog using the sparse representation crosses"></a>16 bytes header. When an HyperLogLog using the sparse representation crosses</h1><h1 id="this-limit-it-is-converted-into-the-dense-representation"><a href="#this-limit-it-is-converted-into-the-dense-representation" class="headerlink" title="this limit, it is converted into the dense representation."></a>this limit, it is converted into the dense representation.</h1><p>#</p>
<h1 id="A-value-greater-than-16000-is-totally-useless-since-at-that-point-the"><a href="#A-value-greater-than-16000-is-totally-useless-since-at-that-point-the" class="headerlink" title="A value greater than 16000 is totally useless, since at that point the"></a>A value greater than 16000 is totally useless, since at that point the</h1><h1 id="dense-representation-is-more-memory-efficient"><a href="#dense-representation-is-more-memory-efficient" class="headerlink" title="dense representation is more memory efficient."></a>dense representation is more memory efficient.</h1><p>#</p>
<h1 id="The-suggested-value-is-3000-in-order-to-have-the-benefits-of"><a href="#The-suggested-value-is-3000-in-order-to-have-the-benefits-of" class="headerlink" title="The suggested value is ~ 3000 in order to have the benefits of"></a>The suggested value is ~ 3000 in order to have the benefits of</h1><h1 id="the-space-efficient-encoding-without-slowing-down-too-much-PFADD"><a href="#the-space-efficient-encoding-without-slowing-down-too-much-PFADD" class="headerlink" title="the space efficient encoding without slowing down too much PFADD,"></a>the space efficient encoding without slowing down too much PFADD,</h1><h1 id="which-is-O-N-with-the-sparse-encoding-The-value-can-be-raised-to"><a href="#which-is-O-N-with-the-sparse-encoding-The-value-can-be-raised-to" class="headerlink" title="which is O(N) with the sparse encoding. The value can be raised to"></a>which is O(N) with the sparse encoding. The value can be raised to</h1><h1 id="10000-when-CPU-is-not-a-concern-but-space-is-and-the-data-set-is"><a href="#10000-when-CPU-is-not-a-concern-but-space-is-and-the-data-set-is" class="headerlink" title="~ 10000 when CPU is not a concern, but space is, and the data set is"></a>~ 10000 when CPU is not a concern, but space is, and the data set is</h1><h1 id="composed-of-many-HyperLogLogs-with-cardinality-in-the-0-15000-range"><a href="#composed-of-many-HyperLogLogs-with-cardinality-in-the-0-15000-range" class="headerlink" title="composed of many HyperLogLogs with cardinality in the 0 - 15000 range."></a>composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</h1><p>hll-sparse-max-bytes 3000</p>
<h1 id="Streams-macro-node-max-size-items-The-stream-data-structure-is-a-radix"><a href="#Streams-macro-node-max-size-items-The-stream-data-structure-is-a-radix" class="headerlink" title="Streams macro node max size / items. The stream data structure is a radix"></a>Streams macro node max size / items. The stream data structure is a radix</h1><h1 id="tree-of-big-nodes-that-encode-multiple-items-inside-Using-this-configuration"><a href="#tree-of-big-nodes-that-encode-multiple-items-inside-Using-this-configuration" class="headerlink" title="tree of big nodes that encode multiple items inside. Using this configuration"></a>tree of big nodes that encode multiple items inside. Using this configuration</h1><h1 id="it-is-possible-to-configure-how-big-a-single-node-can-be-in-bytes-and-the"><a href="#it-is-possible-to-configure-how-big-a-single-node-can-be-in-bytes-and-the" class="headerlink" title="it is possible to configure how big a single node can be in bytes, and the"></a>it is possible to configure how big a single node can be in bytes, and the</h1><h1 id="maximum-number-of-items-it-may-contain-before-switching-to-a-new-node-when"><a href="#maximum-number-of-items-it-may-contain-before-switching-to-a-new-node-when" class="headerlink" title="maximum number of items it may contain before switching to a new node when"></a>maximum number of items it may contain before switching to a new node when</h1><h1 id="appending-new-stream-entries-If-any-of-the-following-settings-are-set-to"><a href="#appending-new-stream-entries-If-any-of-the-following-settings-are-set-to" class="headerlink" title="appending new stream entries. If any of the following settings are set to"></a>appending new stream entries. If any of the following settings are set to</h1><h1 id="zero-the-limit-is-ignored-so-for-instance-it-is-possible-to-set-just-a"><a href="#zero-the-limit-is-ignored-so-for-instance-it-is-possible-to-set-just-a" class="headerlink" title="zero, the limit is ignored, so for instance it is possible to set just a"></a>zero, the limit is ignored, so for instance it is possible to set just a</h1><h1 id="max-entires-limit-by-setting-max-bytes-to-0-and-max-entries-to-the-desired"><a href="#max-entires-limit-by-setting-max-bytes-to-0-and-max-entries-to-the-desired" class="headerlink" title="max entires limit by setting max-bytes to 0 and max-entries to the desired"></a>max entires limit by setting max-bytes to 0 and max-entries to the desired</h1><h1 id="value"><a href="#value" class="headerlink" title="value."></a>value.</h1><p>stream-node-max-bytes 4096<br>stream-node-max-entries 100</p>
<h1 id="Active-rehashing-uses-1-millisecond-every-100-milliseconds-of-CPU-time-in"><a href="#Active-rehashing-uses-1-millisecond-every-100-milliseconds-of-CPU-time-in" class="headerlink" title="Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in"></a>Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</h1><h1 id="order-to-help-rehashing-the-main-Redis-hash-table-the-one-mapping-top-level"><a href="#order-to-help-rehashing-the-main-Redis-hash-table-the-one-mapping-top-level" class="headerlink" title="order to help rehashing the main Redis hash table (the one mapping top-level"></a>order to help rehashing the main Redis hash table (the one mapping top-level</h1><h1 id="keys-to-values-The-hash-table-implementation-Redis-uses-see-dict-c"><a href="#keys-to-values-The-hash-table-implementation-Redis-uses-see-dict-c" class="headerlink" title="keys to values). The hash table implementation Redis uses (see dict.c)"></a>keys to values). The hash table implementation Redis uses (see dict.c)</h1><h1 id="performs-a-lazy-rehashing-the-more-operation-you-run-into-a-hash-table"><a href="#performs-a-lazy-rehashing-the-more-operation-you-run-into-a-hash-table" class="headerlink" title="performs a lazy rehashing: the more operation you run into a hash table"></a>performs a lazy rehashing: the more operation you run into a hash table</h1><h1 id="that-is-rehashing-the-more-rehashing-“steps”-are-performed-so-if-the"><a href="#that-is-rehashing-the-more-rehashing-“steps”-are-performed-so-if-the" class="headerlink" title="that is rehashing, the more rehashing “steps” are performed, so if the"></a>that is rehashing, the more rehashing “steps” are performed, so if the</h1><h1 id="server-is-idle-the-rehashing-is-never-complete-and-some-more-memory-is-used"><a href="#server-is-idle-the-rehashing-is-never-complete-and-some-more-memory-is-used" class="headerlink" title="server is idle the rehashing is never complete and some more memory is used"></a>server is idle the rehashing is never complete and some more memory is used</h1><h1 id="by-the-hash-table"><a href="#by-the-hash-table" class="headerlink" title="by the hash table."></a>by the hash table.</h1><p>#</p>
<h1 id="The-default-is-to-use-this-millisecond-10-times-every-second-in-order-to"><a href="#The-default-is-to-use-this-millisecond-10-times-every-second-in-order-to" class="headerlink" title="The default is to use this millisecond 10 times every second in order to"></a>The default is to use this millisecond 10 times every second in order to</h1><h1 id="actively-rehash-the-main-dictionaries-freeing-memory-when-possible"><a href="#actively-rehash-the-main-dictionaries-freeing-memory-when-possible" class="headerlink" title="actively rehash the main dictionaries, freeing memory when possible."></a>actively rehash the main dictionaries, freeing memory when possible.</h1><p>#</p>
<h1 id="If-unsure"><a href="#If-unsure" class="headerlink" title="If unsure:"></a>If unsure:</h1><h1 id="use-“activerehashing-no”-if-you-have-hard-latency-requirements-and-it-is"><a href="#use-“activerehashing-no”-if-you-have-hard-latency-requirements-and-it-is" class="headerlink" title="use “activerehashing no” if you have hard latency requirements and it is"></a>use “activerehashing no” if you have hard latency requirements and it is</h1><h1 id="not-a-good-thing-in-your-environment-that-Redis-can-reply-from-time-to-time"><a href="#not-a-good-thing-in-your-environment-that-Redis-can-reply-from-time-to-time" class="headerlink" title="not a good thing in your environment that Redis can reply from time to time"></a>not a good thing in your environment that Redis can reply from time to time</h1><h1 id="to-queries-with-2-milliseconds-delay"><a href="#to-queries-with-2-milliseconds-delay" class="headerlink" title="to queries with 2 milliseconds delay."></a>to queries with 2 milliseconds delay.</h1><p>#</p>
<h1 id="use-“activerehashing-yes”-if-you-don’t-have-such-hard-requirements-but"><a href="#use-“activerehashing-yes”-if-you-don’t-have-such-hard-requirements-but" class="headerlink" title="use “activerehashing yes” if you don’t have such hard requirements but"></a>use “activerehashing yes” if you don’t have such hard requirements but</h1><h1 id="want-to-free-memory-asap-when-possible"><a href="#want-to-free-memory-asap-when-possible" class="headerlink" title="want to free memory asap when possible."></a>want to free memory asap when possible.</h1><p>activerehashing yes</p>
<h1 id="The-client-output-buffer-limits-can-be-used-to-force-disconnection-of-clients"><a href="#The-client-output-buffer-limits-can-be-used-to-force-disconnection-of-clients" class="headerlink" title="The client output buffer limits can be used to force disconnection of clients"></a>The client output buffer limits can be used to force disconnection of clients</h1><h1 id="that-are-not-reading-data-from-the-server-fast-enough-for-some-reason-a"><a href="#that-are-not-reading-data-from-the-server-fast-enough-for-some-reason-a" class="headerlink" title="that are not reading data from the server fast enough for some reason (a"></a>that are not reading data from the server fast enough for some reason (a</h1><h1 id="common-reason-is-that-a-Pub-Sub-client-can’t-consume-messages-as-fast-as-the"><a href="#common-reason-is-that-a-Pub-Sub-client-can’t-consume-messages-as-fast-as-the" class="headerlink" title="common reason is that a Pub/Sub client can’t consume messages as fast as the"></a>common reason is that a Pub/Sub client can’t consume messages as fast as the</h1><h1 id="publisher-can-produce-them"><a href="#publisher-can-produce-them" class="headerlink" title="publisher can produce them)."></a>publisher can produce them).</h1><p>#</p>
<h1 id="The-limit-can-be-set-differently-for-the-three-different-classes-of-clients"><a href="#The-limit-can-be-set-differently-for-the-three-different-classes-of-clients" class="headerlink" title="The limit can be set differently for the three different classes of clients:"></a>The limit can be set differently for the three different classes of clients:</h1><p>#</p>
<h1 id="normal-gt-normal-clients-including-MONITOR-clients"><a href="#normal-gt-normal-clients-including-MONITOR-clients" class="headerlink" title="normal -&gt; normal clients including MONITOR clients"></a>normal -&gt; normal clients including MONITOR clients</h1><h1 id="replica-gt-replica-clients"><a href="#replica-gt-replica-clients" class="headerlink" title="replica  -&gt; replica clients"></a>replica  -&gt; replica clients</h1><h1 id="pubsub-gt-clients-subscribed-to-at-least-one-pubsub-channel-or-pattern"><a href="#pubsub-gt-clients-subscribed-to-at-least-one-pubsub-channel-or-pattern" class="headerlink" title="pubsub -&gt; clients subscribed to at least one pubsub channel or pattern"></a>pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</h1><p>#</p>
<h1 id="The-syntax-of-every-client-output-buffer-limit-directive-is-the-following"><a href="#The-syntax-of-every-client-output-buffer-limit-directive-is-the-following" class="headerlink" title="The syntax of every client-output-buffer-limit directive is the following:"></a>The syntax of every client-output-buffer-limit directive is the following:</h1><p>#</p>
<h1 id="client-output-buffer-limit"><a href="#client-output-buffer-limit" class="headerlink" title="client-output-buffer-limit    "></a>client-output-buffer-limit <class> <hard limit=""> <soft limit=""> <soft seconds=""></soft></soft></hard></class></h1><p>#</p>
<h1 id="A-client-is-immediately-disconnected-once-the-hard-limit-is-reached-or-if"><a href="#A-client-is-immediately-disconnected-once-the-hard-limit-is-reached-or-if" class="headerlink" title="A client is immediately disconnected once the hard limit is reached, or if"></a>A client is immediately disconnected once the hard limit is reached, or if</h1><h1 id="the-soft-limit-is-reached-and-remains-reached-for-the-specified-number-of"><a href="#the-soft-limit-is-reached-and-remains-reached-for-the-specified-number-of" class="headerlink" title="the soft limit is reached and remains reached for the specified number of"></a>the soft limit is reached and remains reached for the specified number of</h1><h1 id="seconds-continuously"><a href="#seconds-continuously" class="headerlink" title="seconds (continuously)."></a>seconds (continuously).</h1><h1 id="So-for-instance-if-the-hard-limit-is-32-megabytes-and-the-soft-limit-is"><a href="#So-for-instance-if-the-hard-limit-is-32-megabytes-and-the-soft-limit-is" class="headerlink" title="So for instance if the hard limit is 32 megabytes and the soft limit is"></a>So for instance if the hard limit is 32 megabytes and the soft limit is</h1><h1 id="16-megabytes-10-seconds-the-client-will-get-disconnected-immediately"><a href="#16-megabytes-10-seconds-the-client-will-get-disconnected-immediately" class="headerlink" title="16 megabytes / 10 seconds, the client will get disconnected immediately"></a>16 megabytes / 10 seconds, the client will get disconnected immediately</h1><h1 id="if-the-size-of-the-output-buffers-reach-32-megabytes-but-will-also-get"><a href="#if-the-size-of-the-output-buffers-reach-32-megabytes-but-will-also-get" class="headerlink" title="if the size of the output buffers reach 32 megabytes, but will also get"></a>if the size of the output buffers reach 32 megabytes, but will also get</h1><h1 id="disconnected-if-the-client-reaches-16-megabytes-and-continuously-overcomes"><a href="#disconnected-if-the-client-reaches-16-megabytes-and-continuously-overcomes" class="headerlink" title="disconnected if the client reaches 16 megabytes and continuously overcomes"></a>disconnected if the client reaches 16 megabytes and continuously overcomes</h1><h1 id="the-limit-for-10-seconds"><a href="#the-limit-for-10-seconds" class="headerlink" title="the limit for 10 seconds."></a>the limit for 10 seconds.</h1><p>#</p>
<h1 id="By-default-normal-clients-are-not-limited-because-they-don’t-receive-data"><a href="#By-default-normal-clients-are-not-limited-because-they-don’t-receive-data" class="headerlink" title="By default normal clients are not limited because they don’t receive data"></a>By default normal clients are not limited because they don’t receive data</h1><h1 id="without-asking-in-a-push-way-but-just-after-a-request-so-only"><a href="#without-asking-in-a-push-way-but-just-after-a-request-so-only" class="headerlink" title="without asking (in a push way), but just after a request, so only"></a>without asking (in a push way), but just after a request, so only</h1><h1 id="asynchronous-clients-may-create-a-scenario-where-data-is-requested-faster"><a href="#asynchronous-clients-may-create-a-scenario-where-data-is-requested-faster" class="headerlink" title="asynchronous clients may create a scenario where data is requested faster"></a>asynchronous clients may create a scenario where data is requested faster</h1><h1 id="than-it-can-read"><a href="#than-it-can-read" class="headerlink" title="than it can read."></a>than it can read.</h1><p>#</p>
<h1 id="Instead-there-is-a-default-limit-for-pubsub-and-replica-clients-since"><a href="#Instead-there-is-a-default-limit-for-pubsub-and-replica-clients-since" class="headerlink" title="Instead there is a default limit for pubsub and replica clients, since"></a>Instead there is a default limit for pubsub and replica clients, since</h1><h1 id="subscribers-and-replicas-receive-data-in-a-push-fashion"><a href="#subscribers-and-replicas-receive-data-in-a-push-fashion" class="headerlink" title="subscribers and replicas receive data in a push fashion."></a>subscribers and replicas receive data in a push fashion.</h1><p>#</p>
<h1 id="Both-the-hard-or-the-soft-limit-can-be-disabled-by-setting-them-to-zero"><a href="#Both-the-hard-or-the-soft-limit-can-be-disabled-by-setting-them-to-zero" class="headerlink" title="Both the hard or the soft limit can be disabled by setting them to zero."></a>Both the hard or the soft limit can be disabled by setting them to zero.</h1><p>client-output-buffer-limit normal 0 0 0<br>client-output-buffer-limit replica 256mb 64mb 60<br>client-output-buffer-limit pubsub 32mb 8mb 60</p>
<h1 id="Client-query-buffers-accumulate-new-commands-They-are-limited-to-a-fixed"><a href="#Client-query-buffers-accumulate-new-commands-They-are-limited-to-a-fixed" class="headerlink" title="Client query buffers accumulate new commands. They are limited to a fixed"></a>Client query buffers accumulate new commands. They are limited to a fixed</h1><h1 id="amount-by-default-in-order-to-avoid-that-a-protocol-desynchronization-for"><a href="#amount-by-default-in-order-to-avoid-that-a-protocol-desynchronization-for" class="headerlink" title="amount by default in order to avoid that a protocol desynchronization (for"></a>amount by default in order to avoid that a protocol desynchronization (for</h1><h1 id="instance-due-to-a-bug-in-the-client-will-lead-to-unbound-memory-usage-in"><a href="#instance-due-to-a-bug-in-the-client-will-lead-to-unbound-memory-usage-in" class="headerlink" title="instance due to a bug in the client) will lead to unbound memory usage in"></a>instance due to a bug in the client) will lead to unbound memory usage in</h1><h1 id="the-query-buffer-However-you-can-configure-it-here-if-you-have-very-special"><a href="#the-query-buffer-However-you-can-configure-it-here-if-you-have-very-special" class="headerlink" title="the query buffer. However you can configure it here if you have very special"></a>the query buffer. However you can configure it here if you have very special</h1><h1 id="needs-such-us-huge-multi-exec-requests-or-alike"><a href="#needs-such-us-huge-multi-exec-requests-or-alike" class="headerlink" title="needs, such us huge multi/exec requests or alike."></a>needs, such us huge multi/exec requests or alike.</h1><p>#</p>
<h1 id="client-query-buffer-limit-1gb"><a href="#client-query-buffer-limit-1gb" class="headerlink" title="client-query-buffer-limit 1gb"></a>client-query-buffer-limit 1gb</h1><h1 id="In-the-Redis-protocol-bulk-requests-that-are-elements-representing-single"><a href="#In-the-Redis-protocol-bulk-requests-that-are-elements-representing-single" class="headerlink" title="In the Redis protocol, bulk requests, that are, elements representing single"></a>In the Redis protocol, bulk requests, that are, elements representing single</h1><h1 id="strings-are-normally-limited-ot-512-mb-However-you-can-change-this-limit"><a href="#strings-are-normally-limited-ot-512-mb-However-you-can-change-this-limit" class="headerlink" title="strings, are normally limited ot 512 mb. However you can change this limit"></a>strings, are normally limited ot 512 mb. However you can change this limit</h1><h1 id="here"><a href="#here" class="headerlink" title="here."></a>here.</h1><p>#</p>
<h1 id="proto-max-bulk-len-512mb"><a href="#proto-max-bulk-len-512mb" class="headerlink" title="proto-max-bulk-len 512mb"></a>proto-max-bulk-len 512mb</h1><h1 id="Redis-calls-an-internal-function-to-perform-many-background-tasks-like"><a href="#Redis-calls-an-internal-function-to-perform-many-background-tasks-like" class="headerlink" title="Redis calls an internal function to perform many background tasks, like"></a>Redis calls an internal function to perform many background tasks, like</h1><h1 id="closing-connections-of-clients-in-timeout-purging-expired-keys-that-are"><a href="#closing-connections-of-clients-in-timeout-purging-expired-keys-that-are" class="headerlink" title="closing connections of clients in timeout, purging expired keys that are"></a>closing connections of clients in timeout, purging expired keys that are</h1><h1 id="never-requested-and-so-forth"><a href="#never-requested-and-so-forth" class="headerlink" title="never requested, and so forth."></a>never requested, and so forth.</h1><p>#</p>
<h1 id="Not-all-tasks-are-performed-with-the-same-frequency-but-Redis-checks-for"><a href="#Not-all-tasks-are-performed-with-the-same-frequency-but-Redis-checks-for" class="headerlink" title="Not all tasks are performed with the same frequency, but Redis checks for"></a>Not all tasks are performed with the same frequency, but Redis checks for</h1><h1 id="tasks-to-perform-according-to-the-specified-“hz”-value"><a href="#tasks-to-perform-according-to-the-specified-“hz”-value" class="headerlink" title="tasks to perform according to the specified “hz” value."></a>tasks to perform according to the specified “hz” value.</h1><p>#</p>
<h1 id="By-default-“hz”-is-set-to-10-Raising-the-value-will-use-more-CPU-when"><a href="#By-default-“hz”-is-set-to-10-Raising-the-value-will-use-more-CPU-when" class="headerlink" title="By default “hz” is set to 10. Raising the value will use more CPU when"></a>By default “hz” is set to 10. Raising the value will use more CPU when</h1><h1 id="Redis-is-idle-but-at-the-same-time-will-make-Redis-more-responsive-when"><a href="#Redis-is-idle-but-at-the-same-time-will-make-Redis-more-responsive-when" class="headerlink" title="Redis is idle, but at the same time will make Redis more responsive when"></a>Redis is idle, but at the same time will make Redis more responsive when</h1><h1 id="there-are-many-keys-expiring-at-the-same-time-and-timeouts-may-be"><a href="#there-are-many-keys-expiring-at-the-same-time-and-timeouts-may-be" class="headerlink" title="there are many keys expiring at the same time, and timeouts may be"></a>there are many keys expiring at the same time, and timeouts may be</h1><h1 id="handled-with-more-precision"><a href="#handled-with-more-precision" class="headerlink" title="handled with more precision."></a>handled with more precision.</h1><p>#</p>
<h1 id="The-range-is-between-1-and-500-however-a-value-over-100-is-usually-not"><a href="#The-range-is-between-1-and-500-however-a-value-over-100-is-usually-not" class="headerlink" title="The range is between 1 and 500, however a value over 100 is usually not"></a>The range is between 1 and 500, however a value over 100 is usually not</h1><h1 id="a-good-idea-Most-users-should-use-the-default-of-10-and-raise-this-up-to"><a href="#a-good-idea-Most-users-should-use-the-default-of-10-and-raise-this-up-to" class="headerlink" title="a good idea. Most users should use the default of 10 and raise this up to"></a>a good idea. Most users should use the default of 10 and raise this up to</h1><h1 id="100-only-in-environments-where-very-low-latency-is-required"><a href="#100-only-in-environments-where-very-low-latency-is-required" class="headerlink" title="100 only in environments where very low latency is required."></a>100 only in environments where very low latency is required.</h1><p>hz 10</p>
<h1 id="Normally-it-is-useful-to-have-an-HZ-value-which-is-proportional-to-the"><a href="#Normally-it-is-useful-to-have-an-HZ-value-which-is-proportional-to-the" class="headerlink" title="Normally it is useful to have an HZ value which is proportional to the"></a>Normally it is useful to have an HZ value which is proportional to the</h1><h1 id="number-of-clients-connected-This-is-useful-in-order-for-instance-to"><a href="#number-of-clients-connected-This-is-useful-in-order-for-instance-to" class="headerlink" title="number of clients connected. This is useful in order, for instance, to"></a>number of clients connected. This is useful in order, for instance, to</h1><h1 id="avoid-too-many-clients-are-processed-for-each-background-task-invocation"><a href="#avoid-too-many-clients-are-processed-for-each-background-task-invocation" class="headerlink" title="avoid too many clients are processed for each background task invocation"></a>avoid too many clients are processed for each background task invocation</h1><h1 id="in-order-to-avoid-latency-spikes"><a href="#in-order-to-avoid-latency-spikes" class="headerlink" title="in order to avoid latency spikes."></a>in order to avoid latency spikes.</h1><p>#</p>
<h1 id="Since-the-default-HZ-value-by-default-is-conservatively-set-to-10-Redis"><a href="#Since-the-default-HZ-value-by-default-is-conservatively-set-to-10-Redis" class="headerlink" title="Since the default HZ value by default is conservatively set to 10, Redis"></a>Since the default HZ value by default is conservatively set to 10, Redis</h1><h1 id="offers-and-enables-by-default-the-ability-to-use-an-adaptive-HZ-value"><a href="#offers-and-enables-by-default-the-ability-to-use-an-adaptive-HZ-value" class="headerlink" title="offers, and enables by default, the ability to use an adaptive HZ value"></a>offers, and enables by default, the ability to use an adaptive HZ value</h1><h1 id="which-will-temporary-raise-when-there-are-many-connected-clients"><a href="#which-will-temporary-raise-when-there-are-many-connected-clients" class="headerlink" title="which will temporary raise when there are many connected clients."></a>which will temporary raise when there are many connected clients.</h1><p>#</p>
<h1 id="When-dynamic-HZ-is-enabled-the-actual-configured-HZ-will-be-used-as"><a href="#When-dynamic-HZ-is-enabled-the-actual-configured-HZ-will-be-used-as" class="headerlink" title="When dynamic HZ is enabled, the actual configured HZ will be used as"></a>When dynamic HZ is enabled, the actual configured HZ will be used as</h1><h1 id="as-a-baseline-but-multiples-of-the-configured-HZ-value-will-be-actually"><a href="#as-a-baseline-but-multiples-of-the-configured-HZ-value-will-be-actually" class="headerlink" title="as a baseline, but multiples of the configured HZ value will be actually"></a>as a baseline, but multiples of the configured HZ value will be actually</h1><h1 id="used-as-needed-once-more-clients-are-connected-In-this-way-an-idle"><a href="#used-as-needed-once-more-clients-are-connected-In-this-way-an-idle" class="headerlink" title="used as needed once more clients are connected. In this way an idle"></a>used as needed once more clients are connected. In this way an idle</h1><h1 id="instance-will-use-very-little-CPU-time-while-a-busy-instance-will-be"><a href="#instance-will-use-very-little-CPU-time-while-a-busy-instance-will-be" class="headerlink" title="instance will use very little CPU time while a busy instance will be"></a>instance will use very little CPU time while a busy instance will be</h1><h1 id="more-responsive"><a href="#more-responsive" class="headerlink" title="more responsive."></a>more responsive.</h1><p>dynamic-hz yes</p>
<h1 id="When-a-child-rewrites-the-AOF-file-if-the-following-option-is-enabled"><a href="#When-a-child-rewrites-the-AOF-file-if-the-following-option-is-enabled" class="headerlink" title="When a child rewrites the AOF file, if the following option is enabled"></a>When a child rewrites the AOF file, if the following option is enabled</h1><h1 id="the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful"><a href="#the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful" class="headerlink" title="the file will be fsync-ed every 32 MB of data generated. This is useful"></a>the file will be fsync-ed every 32 MB of data generated. This is useful</h1><h1 id="in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid"><a href="#in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid" class="headerlink" title="in order to commit the file to the disk more incrementally and avoid"></a>in order to commit the file to the disk more incrementally and avoid</h1><h1 id="big-latency-spikes"><a href="#big-latency-spikes" class="headerlink" title="big latency spikes."></a>big latency spikes.</h1><p>aof-rewrite-incremental-fsync yes</p>
<h1 id="When-redis-saves-RDB-file-if-the-following-option-is-enabled"><a href="#When-redis-saves-RDB-file-if-the-following-option-is-enabled" class="headerlink" title="When redis saves RDB file, if the following option is enabled"></a>When redis saves RDB file, if the following option is enabled</h1><h1 id="the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful-1"><a href="#the-file-will-be-fsync-ed-every-32-MB-of-data-generated-This-is-useful-1" class="headerlink" title="the file will be fsync-ed every 32 MB of data generated. This is useful"></a>the file will be fsync-ed every 32 MB of data generated. This is useful</h1><h1 id="in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid-1"><a href="#in-order-to-commit-the-file-to-the-disk-more-incrementally-and-avoid-1" class="headerlink" title="in order to commit the file to the disk more incrementally and avoid"></a>in order to commit the file to the disk more incrementally and avoid</h1><h1 id="big-latency-spikes-1"><a href="#big-latency-spikes-1" class="headerlink" title="big latency spikes."></a>big latency spikes.</h1><p>rdb-save-incremental-fsync yes</p>
<h1 id="Redis-LFU-eviction-see-maxmemory-setting-can-be-tuned-However-it-is-a-good"><a href="#Redis-LFU-eviction-see-maxmemory-setting-can-be-tuned-However-it-is-a-good" class="headerlink" title="Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good"></a>Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</h1><h1 id="idea-to-start-with-the-default-settings-and-only-change-them-after-investigating"><a href="#idea-to-start-with-the-default-settings-and-only-change-them-after-investigating" class="headerlink" title="idea to start with the default settings and only change them after investigating"></a>idea to start with the default settings and only change them after investigating</h1><h1 id="how-to-improve-the-performances-and-how-the-keys-LFU-change-over-time-which"><a href="#how-to-improve-the-performances-and-how-the-keys-LFU-change-over-time-which" class="headerlink" title="how to improve the performances and how the keys LFU change over time, which"></a>how to improve the performances and how the keys LFU change over time, which</h1><h1 id="is-possible-to-inspect-via-the-OBJECT-FREQ-command"><a href="#is-possible-to-inspect-via-the-OBJECT-FREQ-command" class="headerlink" title="is possible to inspect via the OBJECT FREQ command."></a>is possible to inspect via the OBJECT FREQ command.</h1><p>#</p>
<h1 id="There-are-two-tunable-parameters-in-the-Redis-LFU-implementation-the"><a href="#There-are-two-tunable-parameters-in-the-Redis-LFU-implementation-the" class="headerlink" title="There are two tunable parameters in the Redis LFU implementation: the"></a>There are two tunable parameters in the Redis LFU implementation: the</h1><h1 id="counter-logarithm-factor-and-the-counter-decay-time-It-is-important-to"><a href="#counter-logarithm-factor-and-the-counter-decay-time-It-is-important-to" class="headerlink" title="counter logarithm factor and the counter decay time. It is important to"></a>counter logarithm factor and the counter decay time. It is important to</h1><h1 id="understand-what-the-two-parameters-mean-before-changing-them"><a href="#understand-what-the-two-parameters-mean-before-changing-them" class="headerlink" title="understand what the two parameters mean before changing them."></a>understand what the two parameters mean before changing them.</h1><p>#</p>
<h1 id="The-LFU-counter-is-just-8-bits-per-key-it’s-maximum-value-is-255-so-Redis"><a href="#The-LFU-counter-is-just-8-bits-per-key-it’s-maximum-value-is-255-so-Redis" class="headerlink" title="The LFU counter is just 8 bits per key, it’s maximum value is 255, so Redis"></a>The LFU counter is just 8 bits per key, it’s maximum value is 255, so Redis</h1><h1 id="uses-a-probabilistic-increment-with-logarithmic-behavior-Given-the-value"><a href="#uses-a-probabilistic-increment-with-logarithmic-behavior-Given-the-value" class="headerlink" title="uses a probabilistic increment with logarithmic behavior. Given the value"></a>uses a probabilistic increment with logarithmic behavior. Given the value</h1><h1 id="of-the-old-counter-when-a-key-is-accessed-the-counter-is-incremented-in"><a href="#of-the-old-counter-when-a-key-is-accessed-the-counter-is-incremented-in" class="headerlink" title="of the old counter, when a key is accessed, the counter is incremented in"></a>of the old counter, when a key is accessed, the counter is incremented in</h1><h1 id="this-way"><a href="#this-way" class="headerlink" title="this way:"></a>this way:</h1><p>#</p>
<h1 id="1-A-random-number-R-between-0-and-1-is-extracted"><a href="#1-A-random-number-R-between-0-and-1-is-extracted" class="headerlink" title="1. A random number R between 0 and 1 is extracted."></a>1. A random number R between 0 and 1 is extracted.</h1><h1 id="2-A-probability-P-is-calculated-as-1-old-value-lfu-log-factor-1"><a href="#2-A-probability-P-is-calculated-as-1-old-value-lfu-log-factor-1" class="headerlink" title="2. A probability P is calculated as 1/(old_value*lfu_log_factor+1)."></a>2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</h1><h1 id="3-The-counter-is-incremented-only-if-R-lt-P"><a href="#3-The-counter-is-incremented-only-if-R-lt-P" class="headerlink" title="3. The counter is incremented only if R &lt; P."></a>3. The counter is incremented only if R &lt; P.</h1><p>#</p>
<h1 id="The-default-lfu-log-factor-is-10-This-is-a-table-of-how-the-frequency"><a href="#The-default-lfu-log-factor-is-10-This-is-a-table-of-how-the-frequency" class="headerlink" title="The default lfu-log-factor is 10. This is a table of how the frequency"></a>The default lfu-log-factor is 10. This is a table of how the frequency</h1><h1 id="counter-changes-with-a-different-number-of-accesses-with-different"><a href="#counter-changes-with-a-different-number-of-accesses-with-different" class="headerlink" title="counter changes with a different number of accesses with different"></a>counter changes with a different number of accesses with different</h1><h1 id="logarithmic-factors"><a href="#logarithmic-factors" class="headerlink" title="logarithmic factors:"></a>logarithmic factors:</h1><p>#</p>
<h1 id="——–-————-————-————-————-————"><a href="#——–-————-————-————-————-————" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><h1 id="factor-100-hits-1000-hits-100K-hits-1M-hits-10M-hits"><a href="#factor-100-hits-1000-hits-100K-hits-1M-hits-10M-hits" class="headerlink" title="| factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |"></a>| factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</h1><h1 id="——–-————-————-————-————-————-1"><a href="#——–-————-————-————-————-————-1" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><h1 id="0-104-255-255-255-255"><a href="#0-104-255-255-255-255" class="headerlink" title="| 0      | 104        | 255        | 255        | 255        | 255        |"></a>| 0      | 104        | 255        | 255        | 255        | 255        |</h1><h1 id="——–-————-————-————-————-————-2"><a href="#——–-————-————-————-————-————-2" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><h1 id="1-18-49-255-255-255"><a href="#1-18-49-255-255-255" class="headerlink" title="| 1      | 18         | 49         | 255        | 255        | 255        |"></a>| 1      | 18         | 49         | 255        | 255        | 255        |</h1><h1 id="——–-————-————-————-————-————-3"><a href="#——–-————-————-————-————-————-3" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><h1 id="10-10-18-142-255-255"><a href="#10-10-18-142-255-255" class="headerlink" title="| 10     | 10         | 18         | 142        | 255        | 255        |"></a>| 10     | 10         | 18         | 142        | 255        | 255        |</h1><h1 id="——–-————-————-————-————-————-4"><a href="#——–-————-————-————-————-————-4" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><h1 id="100-8-11-49-143-255"><a href="#100-8-11-49-143-255" class="headerlink" title="| 100    | 8          | 11         | 49         | 143        | 255        |"></a>| 100    | 8          | 11         | 49         | 143        | 255        |</h1><h1 id="——–-————-————-————-————-————-5"><a href="#——–-————-————-————-————-————-5" class="headerlink" title="+——–+————+————+————+————+————+"></a>+——–+————+————+————+————+————+</h1><p>#</p>
<h1 id="NOTE-The-above-table-was-obtained-by-running-the-following-commands"><a href="#NOTE-The-above-table-was-obtained-by-running-the-following-commands" class="headerlink" title="NOTE: The above table was obtained by running the following commands:"></a>NOTE: The above table was obtained by running the following commands:</h1><p>#</p>
<h1 id="redis-benchmark-n-1000000-incr-foo"><a href="#redis-benchmark-n-1000000-incr-foo" class="headerlink" title="redis-benchmark -n 1000000 incr foo"></a>redis-benchmark -n 1000000 incr foo</h1><h1 id="redis-cli-object-freq-foo"><a href="#redis-cli-object-freq-foo" class="headerlink" title="redis-cli object freq foo"></a>redis-cli object freq foo</h1><p>#</p>
<h1 id="NOTE-2-The-counter-initial-value-is-5-in-order-to-give-new-objects-a-chance"><a href="#NOTE-2-The-counter-initial-value-is-5-in-order-to-give-new-objects-a-chance" class="headerlink" title="NOTE 2: The counter initial value is 5 in order to give new objects a chance"></a>NOTE 2: The counter initial value is 5 in order to give new objects a chance</h1><h1 id="to-accumulate-hits"><a href="#to-accumulate-hits" class="headerlink" title="to accumulate hits."></a>to accumulate hits.</h1><p>#</p>
<h1 id="The-counter-decay-time-is-the-time-in-minutes-that-must-elapse-in-order"><a href="#The-counter-decay-time-is-the-time-in-minutes-that-must-elapse-in-order" class="headerlink" title="The counter decay time is the time, in minutes, that must elapse in order"></a>The counter decay time is the time, in minutes, that must elapse in order</h1><h1 id="for-the-key-counter-to-be-divided-by-two-or-decremented-if-it-has-a-value"><a href="#for-the-key-counter-to-be-divided-by-two-or-decremented-if-it-has-a-value" class="headerlink" title="for the key counter to be divided by two (or decremented if it has a value"></a>for the key counter to be divided by two (or decremented if it has a value</h1><h1 id="less-lt-10"><a href="#less-lt-10" class="headerlink" title="less &lt;= 10)."></a>less &lt;= 10).</h1><p>#</p>
<h1 id="The-default-value-for-the-lfu-decay-time-is-1-A-Special-value-of-0-means-to"><a href="#The-default-value-for-the-lfu-decay-time-is-1-A-Special-value-of-0-means-to" class="headerlink" title="The default value for the lfu-decay-time is 1. A Special value of 0 means to"></a>The default value for the lfu-decay-time is 1. A Special value of 0 means to</h1><h1 id="decay-the-counter-every-time-it-happens-to-be-scanned"><a href="#decay-the-counter-every-time-it-happens-to-be-scanned" class="headerlink" title="decay the counter every time it happens to be scanned."></a>decay the counter every time it happens to be scanned.</h1><p>#</p>
<h1 id="lfu-log-factor-10"><a href="#lfu-log-factor-10" class="headerlink" title="lfu-log-factor 10"></a>lfu-log-factor 10</h1><h1 id="lfu-decay-time-1"><a href="#lfu-decay-time-1" class="headerlink" title="lfu-decay-time 1"></a>lfu-decay-time 1</h1><p>########################### ACTIVE DEFRAGMENTATION #######################<br>#</p>
<h1 id="WARNING-THIS-FEATURE-IS-EXPERIMENTAL-However-it-was-stress-tested"><a href="#WARNING-THIS-FEATURE-IS-EXPERIMENTAL-However-it-was-stress-tested" class="headerlink" title="WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested"></a>WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested</h1><h1 id="even-in-production-and-manually-tested-by-multiple-engineers-for-some"><a href="#even-in-production-and-manually-tested-by-multiple-engineers-for-some" class="headerlink" title="even in production and manually tested by multiple engineers for some"></a>even in production and manually tested by multiple engineers for some</h1><h1 id="time"><a href="#time" class="headerlink" title="time."></a>time.</h1><p>#</p>
<h1 id="What-is-active-defragmentation"><a href="#What-is-active-defragmentation" class="headerlink" title="What is active defragmentation?"></a>What is active defragmentation?</h1><h1 id="——————————"><a href="#——————————" class="headerlink" title="——————————-"></a>——————————-</h1><p>#</p>
<h1 id="Active-online-defragmentation-allows-a-Redis-server-to-compact-the"><a href="#Active-online-defragmentation-allows-a-Redis-server-to-compact-the" class="headerlink" title="Active (online) defragmentation allows a Redis server to compact the"></a>Active (online) defragmentation allows a Redis server to compact the</h1><h1 id="spaces-left-between-small-allocations-and-deallocations-of-data-in-memory"><a href="#spaces-left-between-small-allocations-and-deallocations-of-data-in-memory" class="headerlink" title="spaces left between small allocations and deallocations of data in memory,"></a>spaces left between small allocations and deallocations of data in memory,</h1><h1 id="thus-allowing-to-reclaim-back-memory"><a href="#thus-allowing-to-reclaim-back-memory" class="headerlink" title="thus allowing to reclaim back memory."></a>thus allowing to reclaim back memory.</h1><p>#</p>
<h1 id="Fragmentation-is-a-natural-process-that-happens-with-every-allocator-but"><a href="#Fragmentation-is-a-natural-process-that-happens-with-every-allocator-but" class="headerlink" title="Fragmentation is a natural process that happens with every allocator (but"></a>Fragmentation is a natural process that happens with every allocator (but</h1><h1 id="less-so-with-Jemalloc-fortunately-and-certain-workloads-Normally-a-server"><a href="#less-so-with-Jemalloc-fortunately-and-certain-workloads-Normally-a-server" class="headerlink" title="less so with Jemalloc, fortunately) and certain workloads. Normally a server"></a>less so with Jemalloc, fortunately) and certain workloads. Normally a server</h1><h1 id="restart-is-needed-in-order-to-lower-the-fragmentation-or-at-least-to-flush"><a href="#restart-is-needed-in-order-to-lower-the-fragmentation-or-at-least-to-flush" class="headerlink" title="restart is needed in order to lower the fragmentation, or at least to flush"></a>restart is needed in order to lower the fragmentation, or at least to flush</h1><h1 id="away-all-the-data-and-create-it-again-However-thanks-to-this-feature"><a href="#away-all-the-data-and-create-it-again-However-thanks-to-this-feature" class="headerlink" title="away all the data and create it again. However thanks to this feature"></a>away all the data and create it again. However thanks to this feature</h1><h1 id="implemented-by-Oran-Agra-for-Redis-4-0-this-process-can-happen-at-runtime"><a href="#implemented-by-Oran-Agra-for-Redis-4-0-this-process-can-happen-at-runtime" class="headerlink" title="implemented by Oran Agra for Redis 4.0 this process can happen at runtime"></a>implemented by Oran Agra for Redis 4.0 this process can happen at runtime</h1><h1 id="in-an-“hot”-way-while-the-server-is-running"><a href="#in-an-“hot”-way-while-the-server-is-running" class="headerlink" title="in an “hot” way, while the server is running."></a>in an “hot” way, while the server is running.</h1><p>#</p>
<h1 id="Basically-when-the-fragmentation-is-over-a-certain-level-see-the"><a href="#Basically-when-the-fragmentation-is-over-a-certain-level-see-the" class="headerlink" title="Basically when the fragmentation is over a certain level (see the"></a>Basically when the fragmentation is over a certain level (see the</h1><h1 id="configuration-options-below-Redis-will-start-to-create-new-copies-of-the"><a href="#configuration-options-below-Redis-will-start-to-create-new-copies-of-the" class="headerlink" title="configuration options below) Redis will start to create new copies of the"></a>configuration options below) Redis will start to create new copies of the</h1><h1 id="values-in-contiguous-memory-regions-by-exploiting-certain-specific-Jemalloc"><a href="#values-in-contiguous-memory-regions-by-exploiting-certain-specific-Jemalloc" class="headerlink" title="values in contiguous memory regions by exploiting certain specific Jemalloc"></a>values in contiguous memory regions by exploiting certain specific Jemalloc</h1><h1 id="features-in-order-to-understand-if-an-allocation-is-causing-fragmentation"><a href="#features-in-order-to-understand-if-an-allocation-is-causing-fragmentation" class="headerlink" title="features (in order to understand if an allocation is causing fragmentation"></a>features (in order to understand if an allocation is causing fragmentation</h1><h1 id="and-to-allocate-it-in-a-better-place-and-at-the-same-time-will-release-the"><a href="#and-to-allocate-it-in-a-better-place-and-at-the-same-time-will-release-the" class="headerlink" title="and to allocate it in a better place), and at the same time, will release the"></a>and to allocate it in a better place), and at the same time, will release the</h1><h1 id="old-copies-of-the-data-This-process-repeated-incrementally-for-all-the-keys"><a href="#old-copies-of-the-data-This-process-repeated-incrementally-for-all-the-keys" class="headerlink" title="old copies of the data. This process, repeated incrementally for all the keys"></a>old copies of the data. This process, repeated incrementally for all the keys</h1><h1 id="will-cause-the-fragmentation-to-drop-back-to-normal-values"><a href="#will-cause-the-fragmentation-to-drop-back-to-normal-values" class="headerlink" title="will cause the fragmentation to drop back to normal values."></a>will cause the fragmentation to drop back to normal values.</h1><p>#</p>
<h1 id="Important-things-to-understand"><a href="#Important-things-to-understand" class="headerlink" title="Important things to understand:"></a>Important things to understand:</h1><p>#</p>
<h1 id="1-This-feature-is-disabled-by-default-and-only-works-if-you-compiled-Redis"><a href="#1-This-feature-is-disabled-by-default-and-only-works-if-you-compiled-Redis" class="headerlink" title="1. This feature is disabled by default, and only works if you compiled Redis"></a>1. This feature is disabled by default, and only works if you compiled Redis</h1><h1 id="to-use-the-copy-of-Jemalloc-we-ship-with-the-source-code-of-Redis"><a href="#to-use-the-copy-of-Jemalloc-we-ship-with-the-source-code-of-Redis" class="headerlink" title="to use the copy of Jemalloc we ship with the source code of Redis."></a>to use the copy of Jemalloc we ship with the source code of Redis.</h1><h1 id="This-is-the-default-with-Linux-builds"><a href="#This-is-the-default-with-Linux-builds" class="headerlink" title="This is the default with Linux builds."></a>This is the default with Linux builds.</h1><p>#</p>
<h1 id="2-You-never-need-to-enable-this-feature-if-you-don’t-have-fragmentation"><a href="#2-You-never-need-to-enable-this-feature-if-you-don’t-have-fragmentation" class="headerlink" title="2. You never need to enable this feature if you don’t have fragmentation"></a>2. You never need to enable this feature if you don’t have fragmentation</h1><h1 id="issues"><a href="#issues" class="headerlink" title="issues."></a>issues.</h1><p>#</p>
<h1 id="3-Once-you-experience-fragmentation-you-can-enable-this-feature-when"><a href="#3-Once-you-experience-fragmentation-you-can-enable-this-feature-when" class="headerlink" title="3. Once you experience fragmentation, you can enable this feature when"></a>3. Once you experience fragmentation, you can enable this feature when</h1><h1 id="needed-with-the-command-“CONFIG-SET-activedefrag-yes”"><a href="#needed-with-the-command-“CONFIG-SET-activedefrag-yes”" class="headerlink" title="needed with the command “CONFIG SET activedefrag yes”."></a>needed with the command “CONFIG SET activedefrag yes”.</h1><p>#</p>
<h1 id="The-configuration-parameters-are-able-to-fine-tune-the-behavior-of-the"><a href="#The-configuration-parameters-are-able-to-fine-tune-the-behavior-of-the" class="headerlink" title="The configuration parameters are able to fine tune the behavior of the"></a>The configuration parameters are able to fine tune the behavior of the</h1><h1 id="defragmentation-process-If-you-are-not-sure-about-what-they-mean-it-is"><a href="#defragmentation-process-If-you-are-not-sure-about-what-they-mean-it-is" class="headerlink" title="defragmentation process. If you are not sure about what they mean it is"></a>defragmentation process. If you are not sure about what they mean it is</h1><h1 id="a-good-idea-to-leave-the-defaults-untouched"><a href="#a-good-idea-to-leave-the-defaults-untouched" class="headerlink" title="a good idea to leave the defaults untouched."></a>a good idea to leave the defaults untouched.</h1><h1 id="Enabled-active-defragmentation"><a href="#Enabled-active-defragmentation" class="headerlink" title="Enabled active defragmentation"></a>Enabled active defragmentation</h1><h1 id="activedefrag-yes"><a href="#activedefrag-yes" class="headerlink" title="activedefrag yes"></a>activedefrag yes</h1><h1 id="Minimum-amount-of-fragmentation-waste-to-start-active-defrag"><a href="#Minimum-amount-of-fragmentation-waste-to-start-active-defrag" class="headerlink" title="Minimum amount of fragmentation waste to start active defrag"></a>Minimum amount of fragmentation waste to start active defrag</h1><h1 id="active-defrag-ignore-bytes-100mb"><a href="#active-defrag-ignore-bytes-100mb" class="headerlink" title="active-defrag-ignore-bytes 100mb"></a>active-defrag-ignore-bytes 100mb</h1><h1 id="Minimum-percentage-of-fragmentation-to-start-active-defrag"><a href="#Minimum-percentage-of-fragmentation-to-start-active-defrag" class="headerlink" title="Minimum percentage of fragmentation to start active defrag"></a>Minimum percentage of fragmentation to start active defrag</h1><h1 id="active-defrag-threshold-lower-10"><a href="#active-defrag-threshold-lower-10" class="headerlink" title="active-defrag-threshold-lower 10"></a>active-defrag-threshold-lower 10</h1><h1 id="Maximum-percentage-of-fragmentation-at-which-we-use-maximum-effort"><a href="#Maximum-percentage-of-fragmentation-at-which-we-use-maximum-effort" class="headerlink" title="Maximum percentage of fragmentation at which we use maximum effort"></a>Maximum percentage of fragmentation at which we use maximum effort</h1><h1 id="active-defrag-threshold-upper-100"><a href="#active-defrag-threshold-upper-100" class="headerlink" title="active-defrag-threshold-upper 100"></a>active-defrag-threshold-upper 100</h1><h1 id="Minimal-effort-for-defrag-in-CPU-percentage"><a href="#Minimal-effort-for-defrag-in-CPU-percentage" class="headerlink" title="Minimal effort for defrag in CPU percentage"></a>Minimal effort for defrag in CPU percentage</h1><h1 id="active-defrag-cycle-min-5"><a href="#active-defrag-cycle-min-5" class="headerlink" title="active-defrag-cycle-min 5"></a>active-defrag-cycle-min 5</h1><h1 id="Maximal-effort-for-defrag-in-CPU-percentage"><a href="#Maximal-effort-for-defrag-in-CPU-percentage" class="headerlink" title="Maximal effort for defrag in CPU percentage"></a>Maximal effort for defrag in CPU percentage</h1><h1 id="active-defrag-cycle-max-75"><a href="#active-defrag-cycle-max-75" class="headerlink" title="active-defrag-cycle-max 75"></a>active-defrag-cycle-max 75</h1><h1 id="Maximum-number-of-set-hash-zset-list-fields-that-will-be-processed-from"><a href="#Maximum-number-of-set-hash-zset-list-fields-that-will-be-processed-from" class="headerlink" title="Maximum number of set/hash/zset/list fields that will be processed from"></a>Maximum number of set/hash/zset/list fields that will be processed from</h1><h1 id="the-main-dictionary-scan"><a href="#the-main-dictionary-scan" class="headerlink" title="the main dictionary scan"></a>the main dictionary scan</h1><h1 id="active-defrag-max-scan-fields-1000"><a href="#active-defrag-max-scan-fields-1000" class="headerlink" title="active-defrag-max-scan-fields 1000"></a>active-defrag-max-scan-fields 1000</h1>  
	</div>
		<div style="padding: 10px 44px 30px 44px;" >
<div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
<div style="float:left;margin-top:0px;">
<img src="/img/weixin.jpg" width="125px" height="125px" style="border:1px solid #ccc; margin: 6px 5px 0px 0px"/>
</div>
<div>
 <p style="margin-top:0px;">作者署名：<b><a target="_blank" href="http://researchlab.github.io/">朴实的一线攻城狮</a></b>
<br />本文标题：<b><a href="/2018/10/26/redis-22-configuration/" target="_blank" title="redis-22-configuration">redis-22-configuration</a></b> 
<br />本文出处：<b><a href="/2018/10/26/redis-22-configuration/" target="_blank" title="redis-22-configuration">http://researchlab.github.io/2018/10/26/redis-22-configuration/</a></b>
<br />版权声明：本文由<b><a href="/about" target="_blank" title="Lee Hong">Lee Hong</a></b>创作和发表,采用<b>署名(BY)</b>-<b>非商业性使用(NC)</b>-<b>相同方式共享(SA)</b>国际许可协议进行许可,转载请注明作者及出处, 否则保留追究法律责任的权利。 </p>
</div>
</div>
</div>

   	       
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
2084050" charset="utf-8"></script>      


	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/11/07/mysql-16-transaction-isolation-level-and-acid-review/" title="mysql专题16 事务隔离级别及ACID知识回顾">
  <strong>上一篇：</strong><br/>
  <span>
  mysql专题16 事务隔离级别及ACID知识回顾</span>
</a>
</div>


<div class="next">
<a href="/2018/10/15/redis-17-replication/"  title="redis专题17 主从同步系列问题">
 <strong>下一篇：</strong><br/> 
 <span>redis专题17 主从同步系列问题
</span>
</a>
</div>

</nav>

	
<!-- gitment评论框 start -->
	<div id="gitment" class="ds-thread"></div>
	<link rel="stylesheet" href="https://github.com/researchlab/gitment/blob/master/style/default.css">
	<script src="https://github.com/researchlab/gitment/blob/master/dist/gitment.browser.js"></script>
	<script>
	  var gitment = new Gitment({
	    id: 'lFri Oct 26 2018 14:06:46 GMT+0800', // 可选。建议为Fri Oct 26 2018 14:06:46 GMT+0800
	    owner: 'researchlab', // 可以是你的GitHub用户名，也可以是github id
	    repo: 'researchlab.github.io', //可以是你的任意一个repo，推荐使用githubpage所在的repo
	    oauth: {
	      client_id: 'e4971ec4c4fdbefb392f',
	      client_secret: 'e5001b2dda2dcb9a9c66417991be57836c17a72b',
	    },
	  })
	  gitment.render('gitment')
</script>


</div>  

      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>
<div id="asidepart">

  <div class="widget tag">
<!--<hr noshade color="#ccc">-->
<!-- <p style="text-align:center">Mike.Lee</p> -->
<p margin="0" style="text-align:center">
<a class="ahref" href="http://researchlab.github.io/about/">
<img id="aboutpic"  src="/img/qzly.png" alt="@一线攻城狮" height="200" width="200" style="box-shadow: 0px 0px 2px 2px #9edeff;border-radius: 8px;" >
</a></p>
<p style="text-align:center"><font size="2" color="grey">关注微信公众号 @一线攻城狮</font></p>
<div style="display:block; margin-top:10px; padding: 0px 4px 4px 0; border-top: dashed 1px #ccc; text-align:left;"></div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div style="float:left;position:absolute;"><font size="2" >总访问:<span id="busuanzi_value_site_pv"></span>次</font></div>
<div style="float:right;"><font size="2" >总访客:<span id="busuanzi_value_site_uv"></span>人</font></div>

<div style="margin-top:30px; padding: 5px 4px 4px 0; border-top: dashed 1px #ccc; text-align:left;"></div>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/DevOps/" title="DevOps">DevOps<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/MQ/" title="MQ">MQ<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/algorithm/" title="algorithm">algorithm<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/docker-practice/" title="docker-practice">docker-practice<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/go-bootcamp/" title="go-bootcamp">go-bootcamp<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/go-pattern/" title="go-pattern">go-pattern<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/golang/" title="golang">golang<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/java/" title="java">java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/javascript/" title="javascript">javascript<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/k8s/" title="k8s">k8s<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/mysql专题/" title="mysql专题">mysql专题<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/php/" title="php">php<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/redis专题/" title="redis专题">redis专题<sup>17</sup></a></li>
		  
		
		</ul>
</div>



  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/golang/" title="golang">golang<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/redis/" title="redis">redis<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/setcookie/" title="setcookie">setcookie<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tcp/" title="tcp">tcp<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/cache/" title="cache">cache<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/concurrency/" title="concurrency">concurrency<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Blog/" title="Blog">Blog<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/minikube/" title="minikube">minikube<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/getcookie/" title="getcookie">getcookie<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/cache-invalid/" title="cache-invalid">cache-invalid<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/rpc/" title="rpc">rpc<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/vendoring/" title="vendoring">vendoring<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/godep/" title="godep">godep<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/govendor/" title="govendor">govendor<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/glide/" title="glide">glide<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ticker/" title="ticker">ticker<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hash/" title="hash">hash<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.csdn.net/xiaolongwang2010" target="_blank" title="小龙王2010csdn技术博客">Linux/c/c++</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=5141203275&verifier=a533edf5&dpc=1"></iframe>


</aside>
</div>

    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/researchlab/lightman" target="_blank" title="lightman">lightman</a> ©2016 - 2020 
		
		<a href="/about" target="_blank" title="Lee Hong">Lee Hong</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"gamedp"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
